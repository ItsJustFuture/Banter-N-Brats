/* public/styles.css */
:root {
  --bg: #1f1f24;
  --bg2: #19191d;
  --panel: #2b2d31;
  --panel2: #1e1f22;
  --text: #e3e5e8;
  --muted: #9da3ad;
  --border: #00000033;
  --shadowColor: rgba(0, 0, 0, 0.45);
  --accent: #5865f2;
  --accent2: #8892f6;
  --danger: #ed4245;
  --success: #23a55a;
  --warning: #f0b132;
  --link: #8cb4ff;
  --messageSelfBg: #5865f2;
  --messageSelfText: #ffffff;
  --messageOtherBg: #3a3c43;
  --messageOtherText: #e3e5e8;
  --messageSystemBg: rgba(0, 0, 0, 0.12);
  --messageSystemText: #c9ced6;
  --mentionBg: rgba(88, 101, 242, 0.15);
  --mentionText: #e3e5e8;
  --btnPrimaryBg: #5865f2;
  --kb: 0px;
  --btnPrimaryText: #ffffff;
  --btnSecondaryBg: #4e5058;
  --btnSecondaryText: #ffffff;
  --inputBg: #2b2d31;
  --inputText: #e3e5e8;
  --inputPlaceholder: #9da3ad;
  --focusRing: 0 0 0 2px rgba(88, 101, 242, 0.35);
  --radiusSm: 10px;
  --radiusMd: 12px;
  --radiusLg: 16px;
  --panel-scrim: rgba(0, 0, 0, 0.45);
  --panel-scrim-strong: rgba(0, 0, 0, 0.60);
  --glass-blur: 10px;
  --text-shadow-soft: 0 1px 2px rgba(0, 0, 0, 0.75);
  --text-shadow-strong: 0 2px 10px rgba(0, 0, 0, 0.70);
  --border-soft: rgba(255,255,255,0.08);
  --shadowSm: 0 4px 12px rgba(0, 0, 0, 0.22);
  --shadowMd: 0 10px 30px rgba(0, 0, 0, 0.35);
  --shadowLg: 0 18px 60px rgba(0, 0, 0, 0.45);
  --aura-online: 0 220 130;
  --aura-typing: 105 157 255;
  --aura-idle: 255 204 102;
  --aura-dnd: 255 92 92;
  --aura-strength: 0.28;
  --aura-strength-vip: 0.45;

  /* legacy aliases so existing rules consume theme tokens */
  --soft: rgba(0, 0, 0, 0.13);
  --avatar-bg: #444444;
  --dm-bg: var(--panel2);
  --dm-neon: var(--accent);
  --overlay-scrim: rgba(0, 0, 0, 0.6);
  --bubble: var(--messageOtherBg);
  --bubbleSelf: var(--messageSelfBg);
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --ok: var(--success);
  --warn: var(--warning);
  --gray: var(--muted);
  --line: var(--border);
  --shadow: var(--shadowLg);
}

.hidden {
  display: none !important;
}

:root[data-theme="Minimal Dark"],
[data-theme="Minimal Dark"] {
  --bg: #1f1f24;
  --bg2: #19191d;
  --panel: #2b2d31;
  --panel2: #1e1f22;
  --text: #e3e5e8;
  --muted: #9da3ad;
  --border: #00000033;
  --shadowColor: rgba(0, 0, 0, 0.45);
  --accent: #5865f2;
  --accent2: #8892f6;
  --danger: #ed4245;
  --success: #23a55a;
  --warning: #f0b132;
  --link: #8cb4ff;
  --messageSelfBg: #5865f2;
  --messageSelfText: #ffffff;
  --messageOtherBg: #3a3c43;
  --messageOtherText: #e3e5e8;
  --messageSystemBg: rgba(0, 0, 0, 0.12);
  --messageSystemText: #c9ced6;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(88, 101, 242, 0.15);
  --mentionText: #e3e5e8;
  --btnPrimaryBg: #5865f2;
  --btnPrimaryText: #ffffff;
  --btnSecondaryBg: #4e5058;
  --btnSecondaryText: #ffffff;
  --inputBg: #2b2d31;
  --inputText: #e3e5e8;
  --inputPlaceholder: #9da3ad;
  --focusRing: 0 0 0 2px rgba(88, 101, 242, 0.35);
  --radiusSm: 10px;
  --radiusMd: 12px;
  --radiusLg: 16px;
  --shadowSm: 0 4px 12px rgba(0, 0, 0, 0.22);
  --shadowMd: 0 10px 30px rgba(0, 0, 0, 0.35);
  --shadowLg: 0 18px 60px rgba(0, 0, 0, 0.45);
  color-scheme: dark;
}

:root[data-theme="Minimal Dark (High Contrast)"],
[data-theme="Minimal Dark (High Contrast)"] {
  --bg: #0f1014;
  --bg2: #0a0b0f;
  --panel: #191b22;
  --panel2: #0f1219;
  --text: #f6f8fb;
  --muted: #b3b9c6;
  --border: #4b5563;
  --shadowColor: rgba(0, 0, 0, 0.55);
  --accent: #8cb4ff;
  --accent2: #a2c5ff;
  --danger: #ff6b6b;
  --success: #5be09c;
  --warning: #ffd166;
  --link: #8cb4ff;
  --messageSelfBg: #8cb4ff;
  --messageSelfText: #0a0b0f;
  --messageOtherBg: #20242e;
  --messageOtherText: #f6f8fb;
  --messageSystemBg: rgba(255, 255, 255, 0.1);
  --messageSystemText: #d9dce5;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(140, 180, 255, 0.2);
  --mentionText: #f6f8fb;
  --btnPrimaryBg: #8cb4ff;
  --btnPrimaryText: #0f1117;
  --btnSecondaryBg: #2d3340;
  --btnSecondaryText: #f6f8fb;
  --inputBg: #141821;
  --inputText: #f6f8fb;
  --inputPlaceholder: #cbd5e1;
  --focusRing: 0 0 0 2px rgba(140, 180, 255, 0.6);
  --radiusSm: 10px;
  --radiusMd: 12px;
  --radiusLg: 16px;
  --shadowSm: 0 4px 12px rgba(0, 0, 0, 0.32);
  --shadowMd: 0 10px 30px rgba(0, 0, 0, 0.48);
  --shadowLg: 0 18px 60px rgba(0, 0, 0, 0.55);
  color-scheme: dark;
}

:root[data-theme="Cyberpunk Neon"],
[data-theme="Cyberpunk Neon"] {
  --bg: #0a0c14;
  --bg2: #05060b;
  --panel: #121424;
  --panel2: #0c0f1a;
  --text: #e7e9ff;
  --muted: #9ca2c9;
  --border: #1f2240;
  --shadowColor: rgba(0, 0, 0, 0.6);
  --accent: #ff3cac;
  --accent2: #6e7dff;
  --danger: #ff6b6b;
  --success: #29ffa0;
  --warning: #ffd166;
  --link: #7ad7ff;
  --messageSelfBg: linear-gradient(135deg, #ff3cac 0%, #784ba0 50%, #2b86c5 100%);
  --messageSelfText: #0a0c14;
  --messageOtherBg: #1a1f34;
  --messageOtherText: #e7e9ff;
  --messageSystemBg: rgba(122, 215, 255, 0.12);
  --messageSystemText: #cfe4ff;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(255, 60, 172, 0.15);
  --mentionText: #ffe3f4;
  --btnPrimaryBg: #ff3cac;
  --btnPrimaryText: #0a0c14;
  --btnSecondaryBg: #1f2640;
  --btnSecondaryText: #e7e9ff;
  --inputBg: #161a2b;
  --inputText: #e7e9ff;
  --inputPlaceholder: #a3add6;
  --focusRing: 0 0 0 2px rgba(122, 215, 255, 0.45);
  --radiusSm: 10px;
  --radiusMd: 12px;
  --radiusLg: 16px;
  --shadowSm: 0 4px 12px rgba(0, 0, 0, 0.35);
  --shadowMd: 0 10px 30px rgba(0, 0, 0, 0.55);
  --shadowLg: 0 18px 60px rgba(0, 0, 0, 0.6);
  color-scheme: dark;
}

:root[data-theme="Cyberpunk Neon (Midnight)"],
[data-theme="Cyberpunk Neon (Midnight)"] {
  --bg: #05060b;
  --bg2: #030308;
  --panel: #0c0f1c;
  --panel2: #060915;
  --text: #d9e0ff;
  --muted: #8b93c4;
  --border: #131735;
  --shadowColor: rgba(0, 0, 0, 0.7);
  --accent: #6e7dff;
  --accent2: #5ffbf1;
  --danger: #ff6b6b;
  --success: #2af598;
  --warning: #ffd166;
  --link: #9ad5ff;
  --messageSelfBg: linear-gradient(135deg, #5ffbf1 0%, #6e7dff 100%);
  --messageSelfText: #05060b;
  --messageOtherBg: #12172d;
  --messageOtherText: #d9e0ff;
  --messageSystemBg: rgba(111, 126, 255, 0.18);
  --messageSystemText: #d0d7ff;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(111, 126, 255, 0.22);
  --mentionText: #f7f8ff;
  --btnPrimaryBg: #6e7dff;
  --btnPrimaryText: #05060b;
  --btnSecondaryBg: #161b33;
  --btnSecondaryText: #d9e0ff;
  --inputBg: #0d1224;
  --inputText: #d9e0ff;
  --inputPlaceholder: #9da5cc;
  --focusRing: 0 0 0 2px rgba(111, 126, 255, 0.55);
  --radiusSm: 10px;
  --radiusMd: 12px;
  --radiusLg: 16px;
  --shadowSm: 0 4px 12px rgba(0, 0, 0, 0.4);
  --shadowMd: 0 10px 30px rgba(0, 0, 0, 0.6);
  --shadowLg: 0 18px 60px rgba(0, 0, 0, 0.7);
  color-scheme: dark;
}

:root[data-theme="Fantasy Tavern"],
[data-theme="Fantasy Tavern"] {
  --bg: #1b140f;
  --bg2: #120d0a;
  --panel: #241913;
  --panel2: #1a130f;
  --text: #f0e6d8;
  --muted: #c9b8a3;
  --border: #3b271b;
  --shadowColor: rgba(0, 0, 0, 0.55);
  --accent: #d4a55a;
  --accent2: #f4c980;
  --danger: #f0745a;
  --success: #7ac087;
  --warning: #e7b65e;
  --link: #f4c980;
  --messageSelfBg: #d4a55a;
  --messageSelfText: #1a120c;
  --messageOtherBg: #2b1c13;
  --messageOtherText: #f0e6d8;
  --messageSystemBg: rgba(212, 165, 90, 0.14);
  --messageSystemText: #f0e6d8;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(240, 194, 125, 0.2);
  --mentionText: #fdf6ea;
  --btnPrimaryBg: #d4a55a;
  --btnPrimaryText: #1b140f;
  --btnSecondaryBg: #3a291c;
  --btnSecondaryText: #f0e6d8;
  --inputBg: #20160f;
  --inputText: #f0e6d8;
  --inputPlaceholder: #cebca6;
  --focusRing: 0 0 0 2px rgba(212, 165, 90, 0.45);
  --radiusSm: 10px;
  --radiusMd: 12px;
  --radiusLg: 16px;
  --shadowSm: 0 4px 12px rgba(0, 0, 0, 0.32);
  --shadowMd: 0 10px 30px rgba(0, 0, 0, 0.5);
  --shadowLg: 0 18px 60px rgba(0, 0, 0, 0.55);
  color-scheme: dark;
}

:root[data-theme="Fantasy Tavern (Ember)"],
[data-theme="Fantasy Tavern (Ember)"] {
  --bg: #23110f;
  --bg2: #180c0a;
  --panel: #2f1713;
  --panel2: #20100d;
  --text: #ffe9dc;
  --muted: #d8b9aa;
  --border: #3f1b14;
  --shadowColor: rgba(0, 0, 0, 0.6);
  --accent: #f28c52;
  --accent2: #ffb37a;
  --danger: #ff6b6b;
  --success: #a3e08f;
  --warning: #f7c46c;
  --link: #ffb37a;
  --messageSelfBg: linear-gradient(135deg, #f28c52, #ffb37a);
  --messageSelfText: #1c0d0b;
  --messageOtherBg: #3b1d15;
  --messageOtherText: #ffe9dc;
  --messageSystemBg: rgba(242, 140, 82, 0.16);
  --messageSystemText: #ffe9dc;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(255, 179, 122, 0.18);
  --mentionText: #fff3e8;
  --btnPrimaryBg: #f28c52;
  --btnPrimaryText: #1c0d0b;
  --btnSecondaryBg: #47261b;
  --btnSecondaryText: #ffe9dc;
  --inputBg: #251410;
  --inputText: #ffe9dc;
  --inputPlaceholder: #e2c2b4;
  --focusRing: 0 0 0 2px rgba(242, 140, 82, 0.45);
  --radiusSm: 10px;
  --radiusMd: 12px;
  --radiusLg: 16px;
  --shadowSm: 0 4px 12px rgba(0, 0, 0, 0.35);
  --shadowMd: 0 10px 30px rgba(0, 0, 0, 0.55);
  --shadowLg: 0 18px 60px rgba(0, 0, 0, 0.6);
  color-scheme: dark;
}

:root[data-theme="Space Explorer"],
[data-theme="Space Explorer"] {
  --bg: #0d1320;
  --bg2: #090f1a;
  --panel: #111a2b;
  --panel2: #0c1524;
  --text: #dfe7ff;
  --muted: #9fb3d9;
  --border: #1c2940;
  --shadowColor: rgba(0, 0, 0, 0.6);
  --accent: #5dd6ff;
  --accent2: #9f7aea;
  --danger: #ff7b7b;
  --success: #7de0b4;
  --warning: #ffd166;
  --link: #9ad5ff;
  --messageSelfBg: linear-gradient(135deg, #5dd6ff, #9f7aea);
  --messageSelfText: #0d1320;
  --messageOtherBg: #162033;
  --messageOtherText: #dfe7ff;
  --messageSystemBg: rgba(93, 214, 255, 0.14);
  --messageSystemText: #dfe7ff;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(159, 122, 234, 0.18);
  --mentionText: #f6f0ff;
  --btnPrimaryBg: #5dd6ff;
  --btnPrimaryText: #0d1320;
  --btnSecondaryBg: #1c2940;
  --btnSecondaryText: #dfe7ff;
  --inputBg: #0f1828;
  --inputText: #dfe7ff;
  --inputPlaceholder: #b3c5e5;
  --focusRing: 0 0 0 2px rgba(93, 214, 255, 0.45);
  --radiusSm: 10px;
  --radiusMd: 12px;
  --radiusLg: 16px;
  --shadowSm: 0 4px 12px rgba(0, 0, 0, 0.35);
  --shadowMd: 0 10px 30px rgba(0, 0, 0, 0.55);
  --shadowLg: 0 18px 60px rgba(0, 0, 0, 0.6);
  color-scheme: dark;
}

:root[data-theme="Space Explorer (Nebula)"],
[data-theme="Space Explorer (Nebula)"] {
  --bg: #0c0a16;
  --bg2: #080612;
  --panel: #141128;
  --panel2: #0e0c1c;
  --text: #eae7ff;
  --muted: #b7b2d9;
  --border: #1e1a33;
  --shadowColor: rgba(0, 0, 0, 0.6);
  --accent: #c084fc;
  --accent2: #7dd3fc;
  --danger: #ff7b7b;
  --success: #7de0b4;
  --warning: #ffd166;
  --link: #c084fc;
  --messageSelfBg: linear-gradient(135deg, #c084fc, #7dd3fc);
  --messageSelfText: #0c0a16;
  --messageOtherBg: #1b1830;
  --messageOtherText: #eae7ff;
  --messageSystemBg: rgba(192, 132, 252, 0.16);
  --messageSystemText: #f0ecff;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(125, 211, 252, 0.15);
  --mentionText: #f5f9ff;
  --btnPrimaryBg: #c084fc;
  --btnPrimaryText: #0c0a16;
  --btnSecondaryBg: #211d38;
  --btnSecondaryText: #eae7ff;
  --inputBg: #141128;
  --inputText: #eae7ff;
  --inputPlaceholder: #c8c2e7;
  --focusRing: 0 0 0 2px rgba(192, 132, 252, 0.5);
  --radiusSm: 10px;
  --radiusMd: 12px;
  --radiusLg: 16px;
  --shadowSm: 0 4px 12px rgba(0, 0, 0, 0.35);
  --shadowMd: 0 10px 30px rgba(0, 0, 0, 0.55);
  --shadowLg: 0 18px 60px rgba(0, 0, 0, 0.6);
  color-scheme: dark;
}

:root[data-theme="Minimal Light"],
[data-theme="Minimal Light"] {
  --bg: #f7f8fa;
  --bg2: #eef0f4;
  --panel: #ffffff;
  --panel2: #f3f5f9;
  --text: #16171b;
  --muted: #4b5563;
  --border: #d8dde7;
  --shadowColor: rgba(0, 0, 0, 0.12);
  --accent: #2563eb;
  --accent2: #3b82f6;
  --danger: #dc2626;
  --success: #16a34a;
  --warning: #f59e0b;
  --link: #2563eb;
  --messageSelfBg: #2563eb;
  --messageSelfText: #ffffff;
  --messageOtherBg: #eef0f4;
  --messageOtherText: #16171b;
  --messageSystemBg: rgba(37, 99, 235, 0.12);
  --messageSystemText: #1f2937;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(37, 99, 235, 0.16);
  --mentionText: #111827;
  --btnPrimaryBg: #2563eb;
  --btnPrimaryText: #ffffff;
  --btnSecondaryBg: #e5e7eb;
  --btnSecondaryText: #111827;
  --inputBg: #ffffff;
  --inputText: #111827;
  --inputPlaceholder: #6b7280;
  --focusRing: 0 0 0 2px rgba(37, 99, 235, 0.35);
  --radiusSm: 10px;
  --radiusMd: 12px;
  --radiusLg: 16px;
  --shadowSm: 0 4px 12px rgba(0, 0, 0, 0.08);
  --shadowMd: 0 10px 30px rgba(0, 0, 0, 0.12);
  --shadowLg: 0 18px 60px rgba(0, 0, 0, 0.14);
  color-scheme: light;
}

:root[data-theme="Minimal Light (High Contrast)"],
[data-theme="Minimal Light (High Contrast)"] {
  --bg: #fdfdfd;
  --bg2: #f5f6f8;
  --panel: #ffffff;
  --panel2: #f7f8fb;
  --text: #0b0c10;
  --muted: #374151;
  --border: #cbd5e1;
  --shadowColor: rgba(0, 0, 0, 0.16);
  --accent: #111827;
  --accent2: #2563eb;
  --danger: #b91c1c;
  --success: #15803d;
  --warning: #d97706;
  --link: #1d4ed8;
  --messageSelfBg: #0b0c10;
  --messageSelfText: #ffffff;
  --messageOtherBg: #f5f6f8;
  --messageOtherText: #0b0c10;
  --messageSystemBg: rgba(17, 24, 39, 0.08);
  --messageSystemText: #111827;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(17, 24, 39, 0.08);
  --mentionText: #0b0c10;
  --btnPrimaryBg: #0b0c10;
  --btnPrimaryText: #ffffff;
  --btnSecondaryBg: #e5e7eb;
  --btnSecondaryText: #0b0c10;
  --inputBg: #ffffff;
  --inputText: #0b0c10;
  --inputPlaceholder: #4b5563;
  --focusRing: 0 0 0 2px rgba(17, 24, 39, 0.3);
  --radiusSm: 10px;
  --radiusMd: 12px;
  --radiusLg: 16px;
  --shadowSm: 0 4px 12px rgba(0, 0, 0, 0.1);
  --shadowMd: 0 10px 30px rgba(0, 0, 0, 0.16);
  --shadowLg: 0 18px 60px rgba(0, 0, 0, 0.2);
  color-scheme: light;
}

:root[data-theme="Pastel Light"],
[data-theme="Pastel Light"] {
  --bg: #fdf6ff;
  --bg2: #f6f0ff;
  --panel: #ffffff;
  --panel2: #f7f2ff;
  --text: #2d1b3d;
  --muted: #5b4769;
  --border: #e7def2;
  --shadowColor: rgba(0, 0, 0, 0.1);
  --accent: #a78bfa;
  --accent2: #f9a8d4;
  --danger: #e11d48;
  --success: #10b981;
  --warning: #f59e0b;
  --link: #7c3aed;
  --messageSelfBg: linear-gradient(135deg, #a78bfa, #f9a8d4);
  --messageSelfText: #2d1b3d;
  --messageOtherBg: #f1e8ff;
  --messageOtherText: #2d1b3d;
  --messageSystemBg: rgba(167, 139, 250, 0.2);
  --messageSystemText: #3b3050;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(249, 168, 212, 0.2);
  --mentionText: #2d1b3d;
  --btnPrimaryBg: #a78bfa;
  --btnPrimaryText: #2d1b3d;
  --btnSecondaryBg: #ede9fe;
  --btnSecondaryText: #2d1b3d;
  --inputBg: #ffffff;
  --inputText: #2d1b3d;
  --inputPlaceholder: #6b556f;
  --focusRing: 0 0 0 2px rgba(167, 139, 250, 0.4);
  --radiusSm: 10px;
  --radiusMd: 12px;
  --radiusLg: 16px;
  --shadowSm: 0 4px 12px rgba(0, 0, 0, 0.08);
  --shadowMd: 0 10px 30px rgba(0, 0, 0, 0.12);
  --shadowLg: 0 18px 60px rgba(0, 0, 0, 0.16);
  color-scheme: light;
}

:root[data-theme="Paper / Parchment"],
[data-theme="Paper / Parchment"] {
  --bg: #f5f0e6;
  --bg2: #e9e1d2;
  --panel: #ffffff;
  --panel2: #f2ebe0;
  --text: #2f2615;
  --muted: #6b5a3c;
  --border: #d7cbb8;
  --shadowColor: rgba(0, 0, 0, 0.12);
  --accent: #c58b4b;
  --accent2: #9c7c5b;
  --danger: #b91c1c;
  --success: #198754;
  --warning: #d97706;
  --link: #9c7c5b;
  --messageSelfBg: #c58b4b;
  --messageSelfText: #2f2615;
  --messageOtherBg: #f2ebe0;
  --messageOtherText: #2f2615;
  --messageSystemBg: rgba(197, 139, 75, 0.18);
  --messageSystemText: #3a2f1b;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(156, 124, 91, 0.18);
  --mentionText: #2f2615;
  --btnPrimaryBg: #c58b4b;
  --btnPrimaryText: #2f2615;
  --btnSecondaryBg: #e9e1d2;
  --btnSecondaryText: #2f2615;
  --inputBg: #ffffff;
  --inputText: #2f2615;
  --inputPlaceholder: #6b5a3c;
  --focusRing: 0 0 0 2px rgba(197, 139, 75, 0.35);
  --radiusSm: 10px;
  --radiusMd: 12px;
  --radiusLg: 16px;
  --shadowSm: 0 4px 12px rgba(0, 0, 0, 0.08);
  --shadowMd: 0 10px 30px rgba(0, 0, 0, 0.12);
  --shadowLg: 0 18px 60px rgba(0, 0, 0, 0.14);
  color-scheme: light;
}

:root[data-theme="Sky Light"],
[data-theme="Sky Light"] {
  --bg: #e8f3ff;
  --bg2: #d9e9ff;
  --panel: #ffffff;
  --panel2: #edf4ff;
  --text: #0f172a;
  --muted: #334155;
  --border: #cbd5e1;
  --shadowColor: rgba(0, 0, 0, 0.1);
  --accent: #38bdf8;
  --accent2: #0ea5e9;
  --danger: #dc2626;
  --success: #16a34a;
  --warning: #f59e0b;
  --link: #0ea5e9;
  --messageSelfBg: linear-gradient(135deg, #38bdf8, #0ea5e9);
  --messageSelfText: #0f172a;
  --messageOtherBg: #edf4ff;
  --messageOtherText: #0f172a;
  --messageSystemBg: rgba(56, 189, 248, 0.2);
  --messageSystemText: #0f172a;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(14, 165, 233, 0.18);
  --mentionText: #0f172a;
  --btnPrimaryBg: #0ea5e9;
  --btnPrimaryText: #ffffff;
  --btnSecondaryBg: #e2e8f0;
  --btnSecondaryText: #0f172a;
  --inputBg: #ffffff;
  --inputText: #0f172a;
  --inputPlaceholder: #475569;
  --focusRing: 0 0 0 2px rgba(14, 165, 233, 0.4);
  --radiusSm: 10px;
  --radiusMd: 12px;
  --radiusLg: 16px;
  --shadowSm: 0 4px 12px rgba(0, 0, 0, 0.08);
  --shadowMd: 0 10px 30px rgba(0, 0, 0, 0.12);
  --shadowLg: 0 18px 60px rgba(0, 0, 0, 0.14);
  color-scheme: light;
}

/* Cherry Blossom (Dark) */
[data-theme="Cherry Blossom (Dark)"],
[data-theme="Cherry Blossom (Dark)"] {
  --bg: #1b121a;
  --bg2: #140e14;
  --panel: #2a1d29;
  --panel2: #1f161e;
  --text: #f3eef2;
  --muted: #c6b3c0;
  --border: #00000033;
  --shadowColor: rgba(0, 0, 0, 0.45);
  --accent: #ff6fae;
  --accent2: #ff9dc8;
  --danger: #ed4245;
  --success: #23a55a;
  --warning: #f0b132;
  --link: #ff9dc8;
  --messageSelfBg: #ff6fae;
  --messageSelfText: #1b121a;
  --messageOtherBg: #342335;
  --messageOtherText: #f3eef2;
  --messageSystemBg: rgba(255, 111, 174, 0.10);
  --messageSystemText: #f3eef2;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(255, 111, 174, 0.14);
  --mentionText: #f3eef2;
}

/* Cherry Blossom (Light) */
[data-theme="Cherry Blossom (Light)"],
[data-theme="Cherry Blossom (Light)"] {
  --bg: #fff7fb;
  --bg2: #ffeaf3;
  --panel: #ffffff;
  --panel2: #fff0f7;
  --text: #2b1f2a;
  --muted: #6b5a68;
  --border: #0000001f;
  --shadowColor: rgba(0, 0, 0, 0.14);
  --accent: #e94e8f;
  --accent2: #ff6fae;
  --danger: #d7373a;
  --success: #1f8a4c;
  --warning: #b87410;
  --link: #c63a78;
  --messageSelfBg: #e94e8f;
  --messageSelfText: #ffffff;
  --messageOtherBg: #ffffff;
  --messageOtherText: #2b1f2a;
  --messageSystemBg: rgba(233, 78, 143, 0.10);
  --messageSystemText: #2b1f2a;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(233, 78, 143, 0.12);
  --mentionText: #2b1f2a;
}

/* 420 Friendly (Light) */
:root[data-theme="420 Friendly (Light)"],
[data-theme="420 Friendly (Light)"] {
  --bg: #f6fff6;
  --bg2: #e7ffe9;
  --panel: #ffffff;
  --panel2: #f0fff1;
  --text: #102014;
  --muted: #2f4a35;
  --border: #d7e9da;
  --shadowColor: rgba(0,0,0,.10);
  --accent: #22c55e;
  --accent2: #16a34a;
  --danger: #dc2626;
  --warn: #d97706;
  --ok: #16a34a;
  --radius: 14px;
  --radiusLg: 18px;
  --radiusMd: 14px;

  --inputBg: rgba(255,255,255,0.90);
  --inputText: #102014;

  --btnBg: #16a34a;
  --btnText: #ffffff;
  --btnBg2: #14532d;
  --btnText2: #ffffff;

  --btnSecondaryBg: #e7ffe9;
  --btnSecondaryText: #102014;
  --btnSecondaryBorder: #cfe6d3;

  --link: #15803d;

  --roomActiveBg: rgba(34,197,94,0.18);
  --roomActiveText: #102014;

  --badgeBg: rgba(34,197,94,0.22);
  --badgeText: #102014;

  --messageMeBg: rgba(34,197,94,0.18);
  --messageMeText: #102014;
  --messageOtherBg: rgba(16,32,20,0.06);
  --messageOtherText: #102014;

  --messageSystemBg: rgba(34,197,94,0.12);
  --messageSystemText: #102014;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);

  --mentionBg: rgba(34,197,94,0.16);
  --mentionText: #102014;

  --scrollbarThumb: rgba(16,32,20,0.22);
  --scrollbarTrack: rgba(16,32,20,0.08);

  --cardBg: rgba(255,255,255,0.92);
  --cardBorder: rgba(16,32,20,0.10);
  --cardShadow: 0 10px 30px rgba(0,0,0,0.10);

  --btnSecondaryHoverBg: #d8ffdf;

  --focusRing: 0 0 0 2px rgba(34,197,94,0.28);
  color-scheme: light;
}

/* 420 Friendly (Dark) */
:root[data-theme="420 Friendly (Dark)"],
[data-theme="420 Friendly (Dark)"] {
  --bg: #07130a;
  --bg2: #050e07;
  --panel: #0d1d11;
  --panel2: #0a160d;
  --text: #eaffef;
  --muted: #b6d4be;
  --border: #00000033;
  --shadowColor: rgba(0,0,0,.45);
  --accent: #53d76a;
  --accent2: #22c55e;
  --danger: #ef4444;
  --warn: #f59e0b;
  --ok: #22c55e;
  --radius: 14px;
  --radiusLg: 18px;
  --radiusMd: 14px;

  --inputBg: rgba(255,255,255,0.06);
  --inputText: #eaffef;

  --btnBg: #22c55e;
  --btnText: #07130a;
  --btnBg2: #16a34a;
  --btnText2: #07130a;

  --btnSecondaryBg: rgba(255,255,255,0.08);
  --btnSecondaryText: #eaffef;
  --btnSecondaryBorder: rgba(255,255,255,0.12);

  --link: #7CFF8A;

  --roomActiveBg: rgba(83,215,106,0.16);
  --roomActiveText: #eaffef;

  --badgeBg: rgba(83,215,106,0.22);
  --badgeText: #07130a;

  --messageMeBg: rgba(83,215,106,0.16);
  --messageMeText: #eaffef;
  --messageOtherBg: rgba(255,255,255,0.06);
  --messageOtherText: #eaffef;

  --messageSystemBg: rgba(83,215,106,0.10);
  --messageSystemText: #eaffef;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);

  --mentionBg: rgba(83,215,106,0.14);
  --mentionText: #eaffef;

  --scrollbarThumb: rgba(234,255,239,0.22);
  --scrollbarTrack: rgba(234,255,239,0.08);

  --cardBg: rgba(13,29,17,0.92);
  --cardBorder: rgba(234,255,239,0.10);
  --cardShadow: 0 10px 30px rgba(0,0,0,0.45);

  --btnSecondaryHoverBg: rgba(255,255,255,0.12);

  --focusRing: 0 0 0 2px rgba(83,215,106,0.26);
  color-scheme: dark;
}

/* Aurora Night */
[data-theme="Aurora Night"],
[data-theme="Aurora Night"] {
  --bg: #071018;
  --bg2: #050b10;
  --panel: #0e1b26;
  --panel2: #0a141d;
  --text: #e7f6ff;
  --muted: #9ac7d9;
  --border: #00000033;
  --shadowColor: rgba(0, 0, 0, 0.55);
  --accent: #3df1c2;
  --accent2: #7aa7ff;
  --danger: #ed4245;
  --success: #23a55a;
  --warning: #f0b132;
  --link: #7aa7ff;
  --messageSelfBg: #3df1c2;
  --messageSelfText: #071018;
  --messageOtherBg: #132433;
  --messageOtherText: #e7f6ff;
  --messageSystemBg: rgba(61, 241, 194, 0.10);
  --messageSystemText: #cfefff;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(122, 167, 255, 0.14);
  --mentionText: #e7f6ff;
}

/* Mint Soda */
[data-theme="Mint Soda"],
[data-theme="Mint Soda"] {
  --bg: #f5fffb;
  --bg2: #e7fff6;
  --panel: #ffffff;
  --panel2: #eafff6;
  --text: #13312a;
  --muted: #4f6f66;
  --border: #0000001f;
  --shadowColor: rgba(0, 0, 0, 0.14);
  --accent: #1fbf9a;
  --accent2: #57d7be;
  --danger: #d7373a;
  --success: #1f8a4c;
  --warning: #b87410;
  --link: #118a72;
  --messageSelfBg: #1fbf9a;
  --messageSelfText: #ffffff;
  --messageOtherBg: #ffffff;
  --messageOtherText: #13312a;
  --messageSystemBg: rgba(31, 191, 154, 0.10);
  --messageSystemText: #13312a;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(31, 191, 154, 0.12);
  --mentionText: #13312a;
}

/* ===============================
   VIP Gradient Pack (VIP locked)
   =============================== */

/* Sunrise Sorbet (Light) */
[data-theme="Sunrise Sorbet"] {
  --bg: linear-gradient(135deg, #fff3e6 0%, #ffd6e7 40%, #d9e8ff 100%);
  --bg2: rgba(255, 255, 255, 0.65);
  --panel: rgba(255, 255, 255, 0.78);
  --panel2: rgba(255, 255, 255, 0.65);
  --text: #2a1f2a;
  --muted: #5d4f66;
  --border: #0000001a;
  --shadowColor: rgba(0, 0, 0, 0.12);
  --accent: #ff5ca8;
  --accent2: #5aa7ff;
  --danger: #d7373a;
  --success: #1f8a4c;
  --warning: #b87410;
  --link: #b0105f;
  --messageSelfBg: #ff5ca8;
  --messageSelfText: #ffffff;
  --messageOtherBg: rgba(255, 255, 255, 0.84);
  --messageOtherText: #2a1f2a;
  --messageSystemBg: rgba(255, 92, 168, 0.12);
  --messageSystemText: #2a1f2a;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(90, 167, 255, 0.14);
  --mentionText: #2a1f2a;
  color-scheme: light;
}

/* Cotton Candy Sky (Light) */
[data-theme="Cotton Candy Sky"] {
  --bg: linear-gradient(145deg, #e8fbff 0%, #ffe3f1 35%, #f7e7ff 70%, #fff6d9 100%);
  --bg2: rgba(255, 255, 255, 0.70);
  --panel: rgba(255, 255, 255, 0.80);
  --panel2: rgba(255, 255, 255, 0.66);
  --text: #1f2937;
  --muted: #556172;
  --border: #0000001a;
  --shadowColor: rgba(0, 0, 0, 0.12);
  --accent: #7c5cff;
  --accent2: #ff63b6;
  --danger: #d7373a;
  --success: #1f8a4c;
  --warning: #b87410;
  --link: #5a33ff;
  --messageSelfBg: #7c5cff;
  --messageSelfText: #ffffff;
  --messageOtherBg: rgba(255, 255, 255, 0.86);
  --messageOtherText: #1f2937;
  --messageSystemBg: rgba(124, 92, 255, 0.12);
  --messageSystemText: #1f2937;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(255, 99, 182, 0.14);
  --mentionText: #1f2937;
  color-scheme: light;
}

/* Prismatic Pearl (Light) */
[data-theme="Prismatic Pearl"] {
  --bg: linear-gradient(135deg, #f7fbff 0%, #e9fff7 30%, #fff3fb 60%, #fff9e6 100%);
  --bg2: rgba(255, 255, 255, 0.70);
  --panel: rgba(255, 255, 255, 0.82);
  --panel2: rgba(255, 255, 255, 0.66);
  --text: #12212c;
  --muted: #4a6573;
  --border: #0000001a;
  --shadowColor: rgba(0, 0, 0, 0.12);
  --accent: #00b3ff;
  --accent2: #00d3a7;
  --danger: #d7373a;
  --success: #1f8a4c;
  --warning: #b87410;
  --link: #0077b6;
  --messageSelfBg: #00b3ff;
  --messageSelfText: #001018;
  --messageOtherBg: rgba(255, 255, 255, 0.86);
  --messageOtherText: #12212c;
  --messageSystemBg: rgba(0, 179, 255, 0.12);
  --messageSystemText: #12212c;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(0, 211, 167, 0.14);
  --mentionText: #12212c;
  color-scheme: light;
}

/* Citrus Splash (Light) */
[data-theme="Citrus Splash"] {
  --bg: linear-gradient(140deg, #fff7d6 0%, #ffe1b6 30%, #ffd0f0 65%, #d9fff1 100%);
  --bg2: rgba(255, 255, 255, 0.68);
  --panel: rgba(255, 255, 255, 0.80);
  --panel2: rgba(255, 255, 255, 0.64);
  --text: #1e2329;
  --muted: #55606b;
  --border: #0000001a;
  --shadowColor: rgba(0, 0, 0, 0.12);
  --accent: #ff8a00;
  --accent2: #00c2a8;
  --danger: #d7373a;
  --success: #1f8a4c;
  --warning: #b87410;
  --link: #b85a00;
  --messageSelfBg: #ff8a00;
  --messageSelfText: #1b1100;
  --messageOtherBg: rgba(255, 255, 255, 0.86);
  --messageOtherText: #1e2329;
  --messageSystemBg: rgba(255, 138, 0, 0.12);
  --messageSystemText: #1e2329;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(0, 194, 168, 0.14);
  --mentionText: #1e2329;
  color-scheme: light;
}

/* Glacier Bloom (Light) */
[data-theme="Glacier Bloom"] {
  --bg: linear-gradient(135deg, #e9f7ff 0%, #e9fff6 35%, #f3e8ff 70%, #fff3e8 100%);
  --bg2: rgba(255, 255, 255, 0.68);
  --panel: rgba(255, 255, 255, 0.80);
  --panel2: rgba(255, 255, 255, 0.64);
  --text: #10212b;
  --muted: #4c6875;
  --border: #0000001a;
  --shadowColor: rgba(0, 0, 0, 0.12);
  --accent: #3b82f6;
  --accent2: #a855f7;
  --danger: #d7373a;
  --success: #1f8a4c;
  --warning: #b87410;
  --link: #1d4ed8;
  --messageSelfBg: #3b82f6;
  --messageSelfText: #ffffff;
  --messageOtherBg: rgba(255, 255, 255, 0.86);
  --messageOtherText: #10212b;
  --messageSystemBg: rgba(59, 130, 246, 0.12);
  --messageSystemText: #10212b;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(168, 85, 247, 0.14);
  --mentionText: #10212b;
  color-scheme: light;
}

/* Aurora Pastel (Light) */
[data-theme="Aurora Pastel"] {
  --bg: linear-gradient(135deg, #e5fff7 0%, #e7f0ff 35%, #ffe6f5 70%, #fffde6 100%);
  --bg2: rgba(255, 255, 255, 0.70);
  --panel: rgba(255, 255, 255, 0.82);
  --panel2: rgba(255, 255, 255, 0.66);
  --text: #0f1f1a;
  --muted: #4a6a61;
  --border: #0000001a;
  --shadowColor: rgba(0, 0, 0, 0.12);
  --accent: #10b981;
  --accent2: #60a5fa;
  --danger: #d7373a;
  --success: #1f8a4c;
  --warning: #b87410;
  --link: #0b7a55;
  --messageSelfBg: #10b981;
  --messageSelfText: #002016;
  --messageOtherBg: rgba(255, 255, 255, 0.86);
  --messageOtherText: #0f1f1a;
  --messageSystemBg: rgba(16, 185, 129, 0.12);
  --messageSystemText: #0f1f1a;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(96, 165, 250, 0.14);
  --mentionText: #0f1f1a;
  color-scheme: light;
}

/* Midnight Mirage (Dark) */
[data-theme="Midnight Mirage"] {
  --bg: linear-gradient(135deg, #0b1020 0%, #1a123a 45%, #052a36 100%);
  --bg2: rgba(0, 0, 0, 0.25);
  --panel: rgba(18, 24, 44, 0.80);
  --panel2: rgba(12, 16, 30, 0.75);
  --text: #eef2ff;
  --muted: #b2b9d6;
  --border: #00000033;
  --shadowColor: rgba(0, 0, 0, 0.60);
  --accent: #a78bfa;
  --accent2: #22d3ee;
  --danger: #ed4245;
  --success: #23a55a;
  --warning: #f0b132;
  --link: #93c5fd;
  --messageSelfBg: #a78bfa;
  --messageSelfText: #0b1020;
  --messageOtherBg: rgba(18, 24, 44, 0.70);
  --messageOtherText: #eef2ff;
  --messageSystemBg: rgba(34, 211, 238, 0.12);
  --messageSystemText: #e6fbff;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(167, 139, 250, 0.14);
  --mentionText: #eef2ff;
  color-scheme: dark;
}

/* Neon Abyss (Dark) */
[data-theme="Neon Abyss"] {
  --bg: linear-gradient(135deg, #05080f 0%, #071a2e 45%, #001b17 100%);
  --bg2: rgba(0, 0, 0, 0.28);
  --panel: rgba(10, 17, 30, 0.82);
  --panel2: rgba(6, 10, 18, 0.76);
  --text: #eaffff;
  --muted: #a2c7d1;
  --border: #00000033;
  --shadowColor: rgba(0, 0, 0, 0.62);
  --accent: #00f5d4;
  --accent2: #ff4dff;
  --danger: #ed4245;
  --success: #23a55a;
  --warning: #f0b132;
  --link: #7aa7ff;
  --messageSelfBg: #00f5d4;
  --messageSelfText: #041012;
  --messageOtherBg: rgba(10, 17, 30, 0.72);
  --messageOtherText: #eaffff;
  --messageSystemBg: rgba(0, 245, 212, 0.12);
  --messageSystemText: #d9ffff;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(255, 77, 255, 0.14);
  --mentionText: #eaffff;
  color-scheme: dark;
}

/* Velvet Galaxy (Dark) */
[data-theme="Velvet Galaxy"] {
  --bg: linear-gradient(135deg, #0a0612 0%, #1b0b2f 45%, #071a2b 100%);
  --bg2: rgba(0, 0, 0, 0.28);
  --panel: rgba(14, 10, 24, 0.84);
  --panel2: rgba(8, 6, 14, 0.78);
  --text: #f3e8ff;
  --muted: #c3b3d6;
  --border: #00000033;
  --shadowColor: rgba(0, 0, 0, 0.62);
  --accent: #ff7bdc;
  --accent2: #7c5cff;
  --danger: #ed4245;
  --success: #23a55a;
  --warning: #f0b132;
  --link: #c4b5fd;
  --messageSelfBg: #ff7bdc;
  --messageSelfText: #150018;
  --messageOtherBg: rgba(14, 10, 24, 0.70);
  --messageOtherText: #f3e8ff;
  --messageSystemBg: rgba(124, 92, 255, 0.12);
  --messageSystemText: #efe7ff;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(255, 123, 220, 0.14);
  --mentionText: #f3e8ff;
  color-scheme: dark;
}

/* Obsidian Aurora (Dark) */
[data-theme="Obsidian Aurora"] {
  --bg: linear-gradient(135deg, #050b10 0%, #06211b 35%, #05102a 70%, #1b0c21 100%);
  --bg2: rgba(0, 0, 0, 0.30);
  --panel: rgba(8, 14, 18, 0.84);
  --panel2: rgba(5, 9, 12, 0.78);
  --text: #e7fff6;
  --muted: #a4d6c4;
  --border: #00000033;
  --shadowColor: rgba(0, 0, 0, 0.64);
  --accent: #3df1c2;
  --accent2: #7aa7ff;
  --danger: #ed4245;
  --success: #23a55a;
  --warning: #f0b132;
  --link: #7aa7ff;
  --messageSelfBg: #3df1c2;
  --messageSelfText: #04110d;
  --messageOtherBg: rgba(8, 14, 18, 0.72);
  --messageOtherText: #e7fff6;
  --messageSystemBg: rgba(61, 241, 194, 0.12);
  --messageSystemText: #d5fff3;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(122, 167, 255, 0.14);
  --mentionText: #e7fff6;
  color-scheme: dark;
}

[data-theme="Iris & Lola Neon"] {
  color-scheme: dark;
  --bg: radial-gradient(circle at 50% 45%,
        rgba(0, 220, 110, 0.58) 0%,
        rgba(0, 220, 110, 0.22) 14%,
        rgba(54, 0, 86, 0.92) 44%,
        #120018 100%);
  --bg2: rgba(18, 0, 24, 0.65);
  --panel: rgba(24, 0, 40, 0.78);
  --panel2: rgba(28, 0, 48, 0.70);
  --text: #f5eaff;
  --muted: rgba(245, 234, 255, 0.70);
  --border: rgba(0, 255, 119, 0.18);

  /* Chat bubbles */
  --messageOtherBg: linear-gradient(135deg, rgba(0, 255, 119, 0.22) 0%, rgba(167, 82, 255, 0.22) 100%);
  --messageSelfBg: linear-gradient(135deg, rgba(0, 255, 119, 0.46) 0%, rgba(167, 82, 255, 0.46) 100%);
  --messageOtherText: #f5eaff;
  --messageSelfText: #ffffff;

    /* DM bubbles */
  --bubble: linear-gradient(135deg, rgba(0, 255, 119, 0.20) 0%, rgba(167, 82, 255, 0.20) 100%);
  --bubbleSelf: linear-gradient(135deg, rgba(0, 255, 119, 0.40) 0%, rgba(167, 82, 255, 0.40) 100%);
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);

  /* Accent/links */
  --accent: #b55dff;
  --accent2: #00ff77;
  --link: #c98cff;

  --danger: #ff4b7a;
  --success: #00ff77;
  --warning: #ffd166;
  --shadow: 0 20px 70px rgba(0,0,0,0.45);
}
/* NOTE: removed stray keyframe fragments that could break CSS parsing */

@keyframes irisLolaNeon {
  0%, 100% {
    opacity: 0.78;
    transform: translate(-50%, -50%) scale(0.99);
    text-shadow:
      0 0 8px rgba(194, 110, 255, 0.55),
      0 0 18px rgba(194, 110, 255, 0.38),
      0 0 34px rgba(0, 255, 119, 0.18);
  }
  50% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1.03);
    text-shadow:
      0 0 12px rgba(194, 110, 255, 0.85),
      0 0 30px rgba(194, 110, 255, 0.62),
      0 0 54px rgba(0, 255, 119, 0.22);
  }
}

/* Reduce motion support */
@media (prefers-reduced-motion: reduce) {
  body[data-theme="Iris & Lola Neon"]::before,
  body[data-theme="Iris & Lola Neon"]::after {
    animation: none !important;
  }
}

/* Cherry Blossom floral overlay */
body[data-theme="Cherry Blossom (Light)"] {
  --sakuraPattern: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22120%22%20height%3D%22120%22%20viewBox%3D%220%200%20120%20120%22%3E%0A%20%20%3Cg%20fill%3D%22%23ff8fc1%22%20fill-opacity%3D%220.18%22%3E%0A%20%20%20%20%3Cpath%20d%3D%22M60%2046c6-14%2022-10%2018%204-2%208-10%2012-18%2014-8-2-16-6-18-14-4-14%2012-18%2018-4z%22%2F%3E%0A%20%20%20%20%3Cpath%20d%3D%22M46%2060c-14-6-10-22%204-18%208%202%2012%2010%2014%2018-2%208-6%2016-14%2018-14%204-18-12-4-18z%22%2F%3E%0A%20%20%20%20%3Cpath%20d%3D%22M60%2074c-6%2014-22%2010-18-4%202-8%2010-12%2018-14%208%202%2016%206%2018%2014%204%2014-12%2018-18%204z%22%2F%3E%0A%20%20%20%20%3Cpath%20d%3D%22M74%2060c14%206%2010%2022-4%2018-8-2-12-10-14-18%202-8%206-16%2014-18%2014-4%2018%2012%204%2018z%22%2F%3E%0A%20%20%20%20%3Ccircle%20cx%3D%2260%22%20cy%3D%2260%22%20r%3D%226%22%20fill%3D%22%23ffd9e8%22%20fill-opacity%3D%220.32999999999999996%22%2F%3E%0A%20%20%3C%2Fg%3E%0A%3C%2Fsvg%3E");
  --sakuraPatternBubble: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22120%22%20height%3D%22120%22%20viewBox%3D%220%200%20120%20120%22%3E%0A%20%20%3Cg%20fill%3D%22%23ff8fc1%22%20fill-opacity%3D%220.1%22%3E%0A%20%20%20%20%3Cpath%20d%3D%22M60%2046c6-14%2022-10%2018%204-2%208-10%2012-18%2014-8-2-16-6-18-14-4-14%2012-18%2018-4z%22%2F%3E%0A%20%20%20%20%3Cpath%20d%3D%22M46%2060c-14-6-10-22%204-18%208%202%2012%2010%2014%2018-2%208-6%2016-14%2018-14%204-18-12-4-18z%22%2F%3E%0A%20%20%20%20%3Cpath%20d%3D%22M60%2074c-6%2014-22%2010-18-4%202-8%2010-12%2018-14%208%202%2016%206%2018%2014%204%2014-12%2018-18%204z%22%2F%3E%0A%20%20%20%20%3Cpath%20d%3D%22M74%2060c14%206%2010%2022-4%2018-8-2-12-10-14-18%202-8%206-16%2014-18%2014-4%2018%2012%204%2018z%22%2F%3E%0A%20%20%20%20%3Ccircle%20cx%3D%2260%22%20cy%3D%2260%22%20r%3D%226%22%20fill%3D%22%23ffd9e8%22%20fill-opacity%3D%220.25%22%2F%3E%0A%20%20%3C%2Fg%3E%0A%3C%2Fsvg%3E");
}
body[data-theme="Cherry Blossom (Dark)"] {
  --sakuraPattern: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22120%22%20height%3D%22120%22%20viewBox%3D%220%200%20120%20120%22%3E%0A%20%20%3Cg%20fill%3D%22%23ff7fb8%22%20fill-opacity%3D%220.16%22%3E%0A%20%20%20%20%3Cpath%20d%3D%22M60%2046c6-14%2022-10%2018%204-2%208-10%2012-18%2014-8-2-16-6-18-14-4-14%2012-18%2018-4z%22%2F%3E%0A%20%20%20%20%3Cpath%20d%3D%22M46%2060c-14-6-10-22%204-18%208%202%2012%2010%2014%2018-2%208-6%2016-14%2018-14%204-18-12-4-18z%22%2F%3E%0A%20%20%20%20%3Cpath%20d%3D%22M60%2074c-6%2014-22%2010-18-4%202-8%2010-12%2018-14%208%202%2016%206%2018%2014%204%2014-12%2018-18%204z%22%2F%3E%0A%20%20%20%20%3Cpath%20d%3D%22M74%2060c14%206%2010%2022-4%2018-8-2-12-10-14-18%202-8%206-16%2014-18%2014-4%2018%2012%204%2018z%22%2F%3E%0A%20%20%20%20%3Ccircle%20cx%3D%2260%22%20cy%3D%2260%22%20r%3D%226%22%20fill%3D%22%23ffd9e8%22%20fill-opacity%3D%220.31%22%2F%3E%0A%20%20%3C%2Fg%3E%0A%3C%2Fsvg%3E");
  --sakuraPatternBubble: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22120%22%20height%3D%22120%22%20viewBox%3D%220%200%20120%20120%22%3E%0A%20%20%3Cg%20fill%3D%22%23ff7fb8%22%20fill-opacity%3D%220.1%22%3E%0A%20%20%20%20%3Cpath%20d%3D%22M60%2046c6-14%2022-10%2018%204-2%208-10%2012-18%2014-8-2-16-6-18-14-4-14%2012-18%2018-4z%22%2F%3E%0A%20%20%20%20%3Cpath%20d%3D%22M46%2060c-14-6-10-22%204-18%208%202%2012%2010%2014%2018-2%208-6%2016-14%2018-14%204-18-12-4-18z%22%2F%3E%0A%20%20%20%20%3Cpath%20d%3D%22M60%2074c-6%2014-22%2010-18-4%202-8%2010-12%2018-14%208%202%2016%206%2018%2014%204%2014-12%2018-18%204z%22%2F%3E%0A%20%20%20%20%3Cpath%20d%3D%22M74%2060c14%206%2010%2022-4%2018-8-2-12-10-14-18%202-8%206-16%2014-18%2014-4%2018%2012%204%2018z%22%2F%3E%0A%20%20%20%20%3Ccircle%20cx%3D%2260%22%20cy%3D%2260%22%20r%3D%226%22%20fill%3D%22%23ffd9e8%22%20fill-opacity%3D%220.25%22%2F%3E%0A%20%20%3C%2Fg%3E%0A%3C%2Fsvg%3E");
}

/* Apply petals subtly across UI (10–40% opacity baked into SVG) */
body[data-theme="Cherry Blossom (Light)"],
body[data-theme="Cherry Blossom (Dark)"] {
  background-image: var(--sakuraPattern);
  background-size: 460px 460px;
  background-repeat: repeat;
}

body[data-theme="Cherry Blossom (Light)"] .panel,
body[data-theme="Cherry Blossom (Light)"] .sidebar,
body[data-theme="Cherry Blossom (Light)"] .modalCard,
body[data-theme="Cherry Blossom (Light)"] .card,
body[data-theme="Cherry Blossom (Light)"] .listPanel,
body[data-theme="Cherry Blossom (Dark)"] .panel,
body[data-theme="Cherry Blossom (Dark)"] .sidebar,
body[data-theme="Cherry Blossom (Dark)"] .modalCard,
body[data-theme="Cherry Blossom (Dark)"] .card,
body[data-theme="Cherry Blossom (Dark)"] .listPanel {
  background-image: var(--sakuraPattern);
  background-size: 460px 460px;
  background-repeat: repeat;
  background-position: 10px 6px;
}

body[data-theme="Cherry Blossom (Light)"] .chat-main .msg--main .bubble,
body[data-theme="Cherry Blossom (Dark)"] .chat-main .msg--main .bubble {
  background-image: var(--sakuraPatternBubble);
  background-size: 420px 420px;
  background-repeat: repeat;
  background-position: 0 0;
}
/* =========================================================
   420 FRIENDLY — SMOKE-ONLY BACKGROUND
   ========================================================= */

:root{
  --weedSmokePattern: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260' viewBox='0 0 260 260'%3E%3Cg opacity='0.22' stroke='%23aaffcc' fill='none' stroke-linecap='round'%3E%3Cpath d='M110 210 C100 180 130 160 118 130 C108 100 140 92 130 64' stroke-width='2.2'/%3E%3Cpath d='M150 220 C170 190 138 170 154 140 C168 110 140 96 152 66' stroke-width='2'/%3E%3Cpath d='M80 230 C70 200 96 178 84 148 C72 120 96 104 88 76' stroke-width='1.8'/%3E%3C/g%3E%3C/svg%3E");
}
/* Apply smoke-only background to 420 themes */
body[data-theme="420 Friendly (Dark)"]{
  background-image: var(--weedSmokePattern);
  background-size: 520px 520px;
  background-repeat: repeat;
  background-position: 120px 160px;
}

body[data-theme="420 Friendly (Light)"]{
  background-image: var(--weedSmokePattern);
  background-size: 620px 620px;
  background-repeat: repeat;
  background-position: 180px 200px;
}

:root[data-theme="Forest Night"],
[data-theme="Forest Night"] {
  --bg: #0b1412;
  --bg2: #07100e;
  --panel: #111f1a;
  --panel2: #0c1813;
  --text: #e7f2ee;
  --muted: #9bb8ae;
  --border: #2a4a3f;
  --shadowColor: rgba(0,0,0,.35);
  --accent: #34d399;
  --accent2: #10b981;
  --danger: #ef4444;
  --warn: #f59e0b;
  --ok: #22c55e;
  --radius: 12px;
  --radiusLg: 16px;
  --radiusMd: 12px;
  --radiusSm: 10px;
  --shadowSm: 0 8px 20px rgba(0,0,0,.22);
  --shadowMd: 0 14px 40px rgba(0,0,0,.28);
  --shadowLg: 0 22px 70px rgba(0,0,0,.32);
  color-scheme: dark;

  --messageSelfBg: rgba(52, 211, 153, 0.16);
  --messageSelfText: var(--text);
  --messageOtherBg: rgba(255,255,255,0.06);
  --messageOtherText: var(--text);
  --messageSystemBg: rgba(52, 211, 153, 0.10);
  --messageSystemText: var(--text);
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(52, 211, 153, 0.18);
  --mentionText: var(--text);

  --btnPrimaryBg: #10b981;
  --btnPrimaryText: #042019;
  --btnSecondaryBg: rgba(255,255,255,0.06);
  --btnSecondaryText: var(--text);
  --inputBg: rgba(255,255,255,0.06);
  --inputText: var(--text);
  --inputPlaceholder: rgba(231,242,238,0.6);
  --focusRing: 0 0 0 2px rgba(16,185,129,0.35);
}

:root[data-theme="Retro Terminal"],
[data-theme="Retro Terminal"] {
  --bg: #051008;
  --bg2: #030b05;
  --panel: #0a1b0e;
  --panel2: #06140a;
  --text: #c7ffb9;
  --muted: #7bdc8a;
  --border: #124b22;
  --shadowColor: rgba(0,0,0,.42);
  --accent: #22c55e;
  --accent2: #a3ff85;
  --danger: #ff4d4d;
  --warn: #f59e0b;
  --ok: #22c55e;
  --radius: 10px;
  --radiusLg: 14px;
  --radiusMd: 10px;
  --radiusSm: 8px;
  --shadowSm: 0 8px 20px rgba(0,0,0,.30);
  --shadowMd: 0 14px 40px rgba(0,0,0,.36);
  --shadowLg: 0 22px 70px rgba(0,0,0,.40);
  color-scheme: dark;

  --messageSelfBg: rgba(34, 197, 94, 0.16);
  --messageSelfText: var(--text);
  --messageOtherBg: rgba(199,255,185,0.06);
  --messageOtherText: var(--text);
  --messageSystemBg: rgba(34, 197, 94, 0.10);
  --messageSystemText: var(--text);
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(34, 197, 94, 0.18);
  --mentionText: var(--text);

  --btnPrimaryBg: #22c55e;
  --btnPrimaryText: #031107;
  --btnSecondaryBg: rgba(199,255,185,0.08);
  --btnSecondaryText: var(--text);
  --inputBg: rgba(199,255,185,0.06);
  --inputText: var(--text);
  --inputPlaceholder: rgba(199,255,185,0.6);
  --focusRing: 0 0 0 2px rgba(34,197,94,0.35);
}

:root[data-theme="Desert Dusk"],
[data-theme="Desert Dusk"] {
  --bg: #1b1210;
  --bg2: #140d0b;
  --panel: #251a17;
  --panel2: #1b1311;
  --text: #f5e9db;
  --muted: #d2b8a5;
  --border: #4b342c;
  --shadowColor: rgba(0,0,0,.34);
  --accent: #fb923c;
  --accent2: #f97316;
  --danger: #ef4444;
  --warn: #f59e0b;
  --ok: #22c55e;
  --radius: 14px;
  --radiusLg: 18px;
  --radiusMd: 14px;
  --radiusSm: 12px;
  --shadowSm: 0 8px 22px rgba(0,0,0,.22);
  --shadowMd: 0 14px 44px rgba(0,0,0,.28);
  --shadowLg: 0 22px 72px rgba(0,0,0,.32);
  color-scheme: dark;

  --messageSelfBg: rgba(251, 146, 60, 0.16);
  --messageSelfText: var(--text);
  --messageOtherBg: rgba(255,255,255,0.06);
  --messageOtherText: var(--text);
  --messageSystemBg: rgba(251, 146, 60, 0.10);
  --messageSystemText: var(--text);
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(251, 146, 60, 0.18);
  --mentionText: var(--text);

  --btnPrimaryBg: #f97316;
  --btnPrimaryText: #1b0b05;
  --btnSecondaryBg: rgba(255,255,255,0.06);
  --btnSecondaryText: var(--text);
  --inputBg: rgba(255,255,255,0.06);
  --inputText: var(--text);
  --inputPlaceholder: rgba(245,233,219,0.62);
  --focusRing: 0 0 0 2px rgba(249,115,22,0.35);
}

:root[data-theme="Arctic Light"],
[data-theme="Arctic Light"] {
  --bg: #f3fbff;
  --bg2: #e7f6ff;
  --panel: #ffffff;
  --panel2: #eff9ff;
  --text: #0b1220;
  --muted: #334155;
  --border: #cbd5e1;
  --shadowColor: rgba(0,0,0,.10);
  --accent: #2563eb;
  --accent2: #38bdf8;
  --danger: #dc2626;
  --warn: #d97706;
  --ok: #16a34a;
  --radius: 14px;
  --radiusLg: 18px;
  --radiusMd: 14px;
  --radiusSm: 12px;
  --shadowSm: 0 10px 28px rgba(0,0,0,.10);
  --shadowMd: 0 16px 44px rgba(0,0,0,.12);
  --shadowLg: 0 22px 66px rgba(0,0,0,.14);
  color-scheme: light;

  --messageSelfBg: rgba(37, 99, 235, 0.10);
  --messageSelfText: #0b1220;
  --messageOtherBg: #ffffff;
  --messageOtherText: #0b1220;
  --messageSystemBg: rgba(56, 189, 248, 0.16);
  --messageSystemText: #0b1220;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(37, 99, 235, 0.12);
  --mentionText: #0b1220;

  --btnPrimaryBg: #2563eb;
  --btnPrimaryText: #ffffff;
  --btnSecondaryBg: #e2e8f0;
  --btnSecondaryText: #0b1220;
  --inputBg: #ffffff;
  --inputText: #0b1220;
  --inputPlaceholder: #475569;
  --focusRing: 0 0 0 2px rgba(37,99,235,0.28);
}

:root[data-theme="Rose Quartz"],
[data-theme="Rose Quartz"] {
  --bg: #fff5f8;
  --bg2: #ffe9f0;
  --panel: #ffffff;
  --panel2: #fff0f5;
  --text: #1f1220;
  --muted: #6b3b59;
  --border: #f3c4d9;
  --shadowColor: rgba(0,0,0,.10);
  --accent: #ec4899;
  --accent2: #fb7185;
  --danger: #dc2626;
  --warn: #d97706;
  --ok: #16a34a;
  --radius: 14px;
  --radiusLg: 18px;
  --radiusMd: 14px;
  --radiusSm: 12px;
  --shadowSm: 0 10px 26px rgba(0,0,0,.10);
  --shadowMd: 0 16px 42px rgba(0,0,0,.12);
  --shadowLg: 0 22px 62px rgba(0,0,0,.14);
  color-scheme: light;

  --messageSelfBg: rgba(236, 72, 153, 0.10);
  --messageSelfText: #1f1220;
  --messageOtherBg: #ffffff;
  --messageOtherText: #1f1220;
  --messageSystemBg: rgba(251, 113, 133, 0.16);
  --messageSystemText: #1f1220;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(236, 72, 153, 0.12);
  --mentionText: #1f1220;

  --btnPrimaryBg: #ec4899;
  --btnPrimaryText: #ffffff;
  --btnSecondaryBg: #ffe4ee;
  --btnSecondaryText: #1f1220;
  --inputBg: #ffffff;
  --inputText: #1f1220;
  --inputPlaceholder: #6b7280;
  --focusRing: 0 0 0 2px rgba(236,72,153,0.25);
}

:root[data-theme="Lemonade"],
[data-theme="Lemonade"] {
  --bg: #fffdf0;
  --bg2: #fff7cc;
  --panel: #ffffff;
  --panel2: #fffbe0;
  --text: #111827;
  --muted: #374151;
  --border: #e5e7eb;
  --shadowColor: rgba(0,0,0,.10);
  --accent: #eab308;
  --accent2: #f59e0b;
  --danger: #dc2626;
  --warn: #d97706;
  --ok: #16a34a;
  --radius: 14px;
  --radiusLg: 18px;
  --radiusMd: 14px;
  --radiusSm: 12px;
  --shadowSm: 0 10px 26px rgba(0,0,0,.10);
  --shadowMd: 0 16px 42px rgba(0,0,0,.12);
  --shadowLg: 0 22px 62px rgba(0,0,0,.14);
  color-scheme: light;

  --messageSelfBg: rgba(234, 179, 8, 0.12);
  --messageSelfText: #111827;
  --messageOtherBg: #ffffff;
  --messageOtherText: #111827;
  --messageSystemBg: rgba(245, 158, 11, 0.16);
  --messageSystemText: #111827;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(234, 179, 8, 0.14);
  --mentionText: #111827;

  --btnPrimaryBg: #eab308;
  --btnPrimaryText: #111827;
  --btnSecondaryBg: #fff7cc;
  --btnSecondaryText: #111827;
  --inputBg: #ffffff;
  --inputText: #111827;
  --inputPlaceholder: #4b5563;
  --focusRing: 0 0 0 2px rgba(234,179,8,0.28);
}

[data-theme] {
  color-scheme: dark;
}

:root{
  /* Visual viewport height (set by JS); use px string so it can be injected directly. */
  --vvh: 100;
  --vvhPx: 100vh;
  --vvTop: 0px;
  --kbInset: 0px;

  /* UI scaling (auto for very small screens; user override via JS sets --uiScale) */
  --uiScaleAuto: 1;
  --uiScale: var(--uiScaleAuto);

  /* Desktop sidebars */
  --membersW: 300px;

  /* Desktop DM dock offset (prevents the DM composer falling off-screen on shorter viewports) */
  --dmDockBottom: 72px;

  /* Dynamic: set by JS for the composer + keyboard safe padding */
  --composerH: 72px;
  --headerH: 54px;
  --playerH: 0px;
  --menuHeaderH: 0px;
  --diceOverlayLift: 0px;
}
@media (max-width: 360px){
  :root{ --uiScaleAuto: 0.92; }
}
@media (max-width: 320px){
  :root{ --uiScaleAuto: 0.88; }
}

html, body { height: 100%; }

[hidden]{
  display:none !important;
}

body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
  height: var(--vvhPx);
  overflow:hidden;
  touch-action: manipulation;
}
.msgs,
.dmMessages,
.channels,
.members{
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}
a{ color:inherit; }
button{ font-family:inherit; }
input::placeholder,
textarea::placeholder{
  color:var(--inputPlaceholder);
  opacity:0.9;
  text-shadow:var(--text-shadow-soft);
}

/* AUTH */
body.auth-pending #loginView,
body.auth-pending #chatView{
  display:none;
}

#authLoading{
  display:none;
  min-height: var(--vvhPx);
  align-items:center;
  justify-content:center;
  text-align:center;
  font-size:14px;
  color:var(--muted);
}

body.auth-pending #authLoading{
  display:flex;
}

#loginView{
  min-height: var(--vvhPx);
  display:flex;
  align-items:center;
  justify-content:center;
  padding: clamp(20px, 4vw, 40px);
  padding-top: calc(clamp(20px, 4vw, 40px) + env(safe-area-inset-top));
  padding-bottom: calc(clamp(20px, 4vw, 40px) + env(safe-area-inset-bottom));
  position:relative;
  overflow:hidden;
  background: radial-gradient(1200px 600px at 15% 5%, rgba(120,120,255,0.22), transparent 60%),
              radial-gradient(900px 520px at 85% 10%, rgba(80,220,255,0.18), transparent 55%),
              radial-gradient(1000px 720px at 50% 90%, rgba(255,120,190,0.16), transparent 65%),
              linear-gradient(180deg, rgba(6,6,12,0.88), rgba(6,6,12,0.96));
}

#passwordUpgradeView{
  position: fixed;
  inset: 0;
  min-height: var(--vvhPx);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: clamp(20px, 4vw, 40px);
  padding-top: calc(clamp(20px, 4vw, 40px) + env(safe-area-inset-top));
  padding-bottom: calc(clamp(20px, 4vw, 40px) + env(safe-area-inset-bottom));
  z-index: 500;
  background: radial-gradient(900px 520px at 15% 10%, rgba(120,120,255,0.18), transparent 60%),
              radial-gradient(900px 520px at 85% 15%, rgba(80,220,255,0.16), transparent 55%),
              linear-gradient(180deg, rgba(6,6,12,0.9), rgba(6,6,12,0.98));
}

.upgradeBackdrop{
  position: absolute;
  inset: 0;
  background: linear-gradient(120deg, rgba(255,255,255,0.04), transparent 40%, rgba(255,255,255,0.03));
  pointer-events: none;
}

.upgradeShell{
  position: relative;
  width: min(560px, 100%);
  z-index: 1;
}

.upgradeCard{
  width: 100%;
}

.upgradeHints{
  margin: 12px 0;
}

.upgradeHintsTitle{
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.16em;
  margin-bottom: 6px;
}

.upgradeHints ul{
  margin: 0;
  padding-left: 18px;
  display: grid;
  gap: 6px;
}

.loginBackdrop{
  position:absolute;
  inset:0;
  background: linear-gradient(120deg, rgba(255,255,255,0.03), transparent 35%, rgba(255,255,255,0.02));
  pointer-events:none;
}

.loginShell{
  width:min(1040px, 100%);
  display:grid;
  grid-template-columns: 1.1fr minmax(0, 420px);
  gap:24px;
  align-items:center;
  position:relative;
  z-index:1;
}

.loginBrand{
  padding:12px 6px;
}

.loginBadge{
  font-size:12px;
  text-transform:uppercase;
  letter-spacing:0.2em;
  color: color-mix(in oklab, var(--muted) 75%, #fff);
}

.loginLogo{
  margin:8px 0 8px;
  font-weight:800;
  font-size: clamp(28px, 4.5vw, 46px);
  line-height:1.05;
  text-shadow: 0 12px 30px rgba(0,0,0,0.4);
}

.loginLogo .amp{
  opacity:0.9;
  filter: drop-shadow(0 0 16px rgba(190,120,255,0.3));
}

.loginTag{
  margin:0 0 14px;
  color: var(--muted);
  font-size:15px;
}

.loginFeatures{
  list-style:none;
  padding:0;
  margin:0;
  display:grid;
  gap:10px;
  color: color-mix(in oklab, var(--text) 80%, #fff);
  font-size:14px;
}

.loginFeatures li{
  padding-left:22px;
  position:relative;
}

.loginFeatures li::before{
  content:"•";
  position:absolute;
  left:0;
  color: rgba(170,200,255,0.9);
}

.loginCard{
  width:100%;
  background: color-mix(in oklab, var(--panel) 90%, rgba(0,0,0,0.35));
  border:1px solid color-mix(in oklab, var(--line) 80%, rgba(255,255,255,0.1));
  border-radius:20px;
  padding:24px;
  box-shadow: 0 24px 60px rgba(0,0,0,0.45);
  backdrop-filter: blur(12px);
}

.loginHeader h2{
  margin:0 0 6px;
  font-size:22px;
}

.loginHeader p{
  margin:0 0 12px;
  color:var(--muted);
  font-size:13px;
}

.loginForm .field{
  margin:12px 0;
}

.loginForm input{
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.loginForm input:focus-visible{
  border-color: rgba(140,180,255,0.8);
  box-shadow: 0 0 0 3px rgba(120,160,255,0.25);
}

.loginValidation{
  min-height:18px;
  font-size:12px;
  color: color-mix(in oklab, #ff8c9a 75%, var(--text));
}

.loginActions{
  margin-top:12px;
}

.loginActions .btn{
  flex:1;
  min-width:140px;
}

.loginHint{
  margin-top:12px;
}

.loginFooter{
  margin-top:16px;
  text-align:center;
}

@media (max-width: 860px){
  .loginShell{
    grid-template-columns: 1fr;
  }
  .loginBrand{
    text-align:center;
  }
  .loginFeatures{
    max-width:520px;
    margin:0 auto;
    text-align:left;
  }
}

@media (max-width: 540px){
  .loginCard{
    padding:20px;
  }
  .loginActions{
    flex-direction:column;
  }
}

/* Shared form primitives */
.field{ display:flex; flex-direction:column; gap:6px; margin:10px 0; }
.field label{ font-size:12px; color:var(--muted); font-weight:600; text-shadow:var(--text-shadow-soft); }
.fieldLabelRow{ display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap; }
.field input, textarea, select{
  padding:11px 12px;
  border-radius:var(--radiusMd);
  border:1px solid var(--border-soft);
  background:color-mix(in srgb, var(--inputBg) 85%, var(--panel-scrim));
  color:var(--inputText);
  outline:none;
}

/* Password show/hide */
.passWrap{ position:relative; display:flex; align-items:center; }
.passWrap > input{ width:100%; padding-right:44px; }
.passToggle{
  position:absolute;
  right:8px;
  top:50%;
  transform: translateY(-50%);
  border:0;
  background:transparent;
  color: var(--muted);
  cursor:pointer;
  width:34px;
  height:34px;
  display:grid;
  place-items:center;
  border-radius:10px;
}
.passToggle:hover{ background: color-mix(in oklab, var(--panel) 70%, rgba(255,255,255,0.08)); color: var(--text); }
.passToggle:active{ transform: translateY(-50%) translateY(1px); }
.passToggle:focus{ outline:none; box-shadow: 0 0 0 3px rgba(120,120,255,0.18); }

.field input:focus, textarea:focus, select:focus{
  border-color: color-mix(in srgb, var(--accent) 55%, var(--border-soft));
  box-shadow: var(--focusRing);
}
.bioHelper{
  margin-top:8px;
  padding:10px;
  border:1px solid var(--border);
  border-radius:var(--radiusMd);
  background:color-mix(in srgb, var(--panel) 85%, transparent);
  box-shadow: var(--shadowSm);
  display:flex;
  flex-direction:column;
  gap:8px;
  max-height:260px;
  overflow:auto;
}
.bioHelperRow{ display:flex; flex-wrap:wrap; gap:6px; }
.bioHelperPreview{
  border:1px dashed var(--border);
  border-radius:var(--radiusSm);
  padding:8px;
  min-height:42px;
  background:var(--panel);
  overflow:auto;
}
.pillBtn.tiny{ padding:4px 8px; font-size:12px; }
textarea{ min-height:90px; resize:vertical; }

.colorInputRow{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
.colorInputRow input[type="text"]{ flex:1; min-width:140px; }
.row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

.btn{
  border:0;
  border-radius:var(--radiusMd);
  padding:10px 12px;
  cursor:pointer;
  color:var(--btnPrimaryText);
  background:var(--btnPrimaryBg);
  font-weight:900;
  line-height:1;
  user-select:none;
  transition: transform 0.08s ease, opacity 0.12s ease, filter 0.12s ease, background 0.12s ease;
}
.btn.secondary{ background:var(--btnSecondaryBg); color:var(--btnSecondaryText); }
.btn.danger{ background:var(--danger); color:var(--btnPrimaryText); }
.btn.btnPrimary{ background:var(--btnPrimaryBg); color:var(--btnPrimaryText); }
.btn.btnSecondary{ background:var(--btnSecondaryBg); color:var(--btnSecondaryText); }
.btn.btnDanger{ background:var(--danger); color:var(--btnPrimaryText); }
.btn.btnTertiary{
  background:transparent;
  color:var(--text);
  border:1px solid var(--border);
}
.btn.btnPrimary:hover,
.btn.btnSecondary:hover,
.btn.btnDanger:hover{ filter: brightness(1.05); }
.btn.btnTertiary:hover{ background:color-mix(in srgb, var(--panel) 75%, transparent); }
.btn.btnTertiary:active{ opacity: 0.8; }
.btn:not(:disabled):active{
  transform: scale(0.96);
  filter: brightness(0.98);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,0.12);
}

.msgline{ margin-top:10px; font-size:12px; color:var(--muted); min-height:16px; white-space:pre-wrap; }

/* APP LAYOUT */
/* iOS keyboard layout invariants: single scroll container, min-height:0, app shell bound to visualViewport + offsetTop */
#app{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height: var(--vvhPx);
  min-height: 0;
  transform: translateY(var(--vvTop));
  overflow:hidden;
  display:flex;
  flex-direction: column;
}
.layout{ height:100%; display:flex; min-height:0; overflow:hidden; }

main.chat{
  display:flex;
  flex-direction:column;
  height:100%;
  min-height:0;
  position: relative;
  height: var(--vvh, 100vh);
}

.chatMain,
.chat{
  display:flex;
  flex-direction:column;
  min-height:0;
  height:100%;
}
body.event-active main.chat{
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 40%, transparent);
}
body.event-active .roomTitle{
  color: var(--accent);
}

.chat-main .msgs{
  flex:1 1 auto;
  min-height:0;
  overflow-y:auto;
  -webkit-overflow-scrolling: touch;
  overflow-anchor: none;
}

.inputBar{
  flex:0 0 auto;
  position: static;
  width:100%;
}

/* Channels */
.channels{
  width:270px;
  background:color-mix(in srgb, var(--panel2) 72%, var(--panel-scrim));
  border-right:1px solid var(--border-soft);
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:10px;
  min-width: 220px;
  height: 100%;
  min-height: 0;
  backdrop-filter: blur(var(--glass-blur));
  -webkit-backdrop-filter: blur(var(--glass-blur));
}
/* Brand neon glow in the room panel */
.neonBrand{
  color: #eafff2; /* readable “near-white” */
  font-weight: 800;
  letter-spacing: 0.4px;

  /* neon green glow */
  text-shadow:
    0 0 4px rgba(0, 255, 150, 0.55),
    0 0 10px rgba(0, 255, 150, 0.35),
    0 0 20px rgba(0, 255, 150, 0.15);
}

.neonBrand .amp{
  opacity: 0.65;
  margin: 0 2px;
}
.brand{
  display:flex; align-items:center; justify-content:space-between;
  padding:10px; background:color-mix(in srgb, var(--panel) 78%, var(--panel-scrim));
  border-radius:var(--radiusLg); border:1px solid var(--border-soft);
}
.brand strong{ font-size:14px; }
.brand .small{ font-size:12px; color:var(--muted); text-shadow:var(--text-shadow-soft); }

.chanList{
  background:color-mix(in srgb, var(--panel) 78%, var(--panel-scrim));
  border-radius:var(--radiusLg);
  border:1px solid var(--border-soft);
  padding:8px;
  display:flex;
  flex-direction:column;
  gap:4px;
  flex:1;
  overflow:auto;
}

/* === Rooms: Site/User pill switcher (below Latest update) === */
.roomModeSwitch{
  display:flex;
  gap:4px;
  margin:8px 10px 10px;
  padding:3px;
  border-radius:999px;
  background: color-mix(in srgb, var(--panel) 55%, var(--panel-scrim));
  backdrop-filter: blur(8px);
}
.roomModeSwitch button{
  flex:1;
  height:28px;
  border:0;
  border-radius:999px;
  background: transparent;
  color: rgba(255,255,255,0.72);
  font-size:12px;
  font-weight:600;
  letter-spacing:0.2px;
  text-shadow:var(--text-shadow-soft);
  cursor:pointer;
  user-select:none;
}
.roomModeSwitch button.active{
  background: rgba(255,255,255,0.14);
  color:#fff;
  box-shadow: 0 0 8px rgba(180,140,255,0.35);
}
.roomModeSwitch button:active{
  transform: translateY(0.5px);
}
.roomsPanel, .menuPanel{
  display:flex;
  flex-direction:column;
  gap:10px;
  flex:1;
  min-height:0;
}
.menuPanel{ display:none; }
.menuNav{
  display:flex;
  gap:6px;
  flex-wrap:wrap;
}
.menuTab{
  padding:8px 10px;
  border-radius:var(--radiusMd);
  border:1px solid var(--border-soft);
  background:color-mix(in srgb, var(--panel) 80%, var(--panel-scrim));
  cursor:pointer;
  color:var(--text);
}
.menuTab.active{ background:var(--panel2); box-shadow:var(--shadowSm); }
.menuContent{ flex:1; display:flex; flex-direction:column; gap:10px; min-height:0; overflow-y:auto; padding:2px 12px 160px; -webkit-overflow-scrolling: touch; touch-action: pan-y; }
body.keyboard-open .menuContent{ padding-bottom: calc(200px + var(--kb, 0px) + env(safe-area-inset-bottom)); }
.menuSection{ display:none; flex-direction:column; gap:10px; min-height:0; }
.menuSection.active{ display:flex; }
.menuSectionHeader{ display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; }
.leaderboardGrid{ display:grid; grid-template-columns:repeat(auto-fit, minmax(240px, 1fr)); gap:12px; }
.leaderboardCard{ display:flex; flex-direction:column; gap:6px; }
.leaderboardList{ display:flex; flex-direction:column; gap:6px; }
.leaderboardItem{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding:8px 10px; border:1px solid var(--line); border-radius:10px; background:var(--panel); }
.leaderboardItem .label{ font-weight:800; }
.leaderboardItem .meta{ color:var(--muted); font-size:12px; }
.menuActions{ display:flex; gap:8px; align-items:center; }
.card{
  background:color-mix(in srgb, var(--panel) 82%, var(--panel-scrim));
  border:1px solid var(--border-soft);
  border-radius:var(--radiusLg);
  padding:10px;
  box-shadow:var(--shadowSm);
}
.latestUpdate{
  display:none;
  padding:10px;
  border-radius:var(--radiusLg);
  border:1px solid var(--border-soft);
  background:color-mix(in srgb, var(--panel) 82%, var(--panel-scrim));
  box-shadow:var(--shadowSm);
  flex-direction:column;
  gap:8px;
  min-height:0;
}
.latestUpdateTop{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; }
.latestUpdateTitle{ font-weight:800; font-size:14px; }
.latestUpdateBody{ margin-top:6px; color:var(--text); white-space:pre-line; max-height: clamp(220px, 55vh, 520px); overflow-y:auto; -webkit-overflow-scrolling: touch; padding-right:2px; }

/* Rooms panel "Latest update" — compact until expanded */
.latestUpdate.compact .latestUpdateBody,
.latestUpdate.compact #latestUpdateDate,
.latestUpdate.compact .latestUpdateTop .muted{
  display:none;
}
.latestUpdate.compact .latestUpdateTop{
  align-items:center;
}
.latestUpdate.compact .latestUpdateTitle{
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
}

.changelogList{ display:flex; flex-direction:column; gap:18px; min-height:0; touch-action: pan-y; }
.changelogEntry{ padding:18px; border-radius:var(--radiusLg); border:1px solid var(--border); background:var(--panel); box-shadow:var(--shadowSm); display:flex; flex-direction:column; gap:12px; min-height:0; overflow:visible; }
.changelogEntry.compact .changelogEntryMetaRow,
.changelogEntry.compact .changelogEntryHint,
.changelogEntry.compact .changelogChevron{ display:none; }
.changelogEntry.compact .changelogSummary{ justify-content:flex-start; }
.changelogEntry.compact .changelogEntryTitle{ font-size:15px; line-height:1.2; }
.changelogEntryHeader{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; flex-wrap:wrap; }
.changelogSummary{ flex:1; display:flex; align-items:center; justify-content:space-between; gap:10px; border:none; background:transparent; padding:0; margin:0; text-align:left; color:inherit; font:inherit; cursor:pointer; min-width:0; }
.changelogEntryTitle{ font-weight:900; white-space:normal; overflow:visible; text-overflow:clip; line-height:1.25; font-size:15px; }
.changelogEntryMeta{ font-size:12px; color:var(--muted); }
.changelogEntryMetaRow{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }

/* Mobile: let the header breathe so titles/meta/actions don't collide */
@media (max-width: 520px){
  .changelogEntryHeader{ flex-direction:column; align-items:stretch; }
  .changelogSummary{ width:100%; }
  .changelogActions{ width:100%; justify-content:flex-end; }
  .changelogActions .btn{ flex:1 1 140px; min-width:0; }
}
.changelogEntryHint{ font-size:12px; color:var(--muted); }
.changelogMeta{ display:flex; flex-direction:column; gap:4px; min-width:0; }
.changelogChevron{ flex:0 0 auto; font-size:14px; transition:transform .15s ease; }
.changelogEntry.is-open .changelogChevron{ transform:rotate(180deg); }
.changelogDetails{ display:flex; flex-direction:column; gap:10px; margin-top:2px; padding-top:8px; border-top:1px solid var(--border); max-height:0; overflow:hidden; opacity:0; transition:max-height .2s ease, opacity .2s ease; }
.changelogEntry.is-open .changelogDetails{ max-height:1600px; opacity:1; }
.changelogBody{ white-space:pre-line; overflow-wrap:anywhere; max-height:clamp(220px, 48vh, 460px); overflow-y:auto; -webkit-overflow-scrolling:touch; line-height:1.4; font-size:14px; }
.changelogActions{ display:flex; gap:6px; flex-wrap:wrap; justify-content:flex-end; }
.changelogReactions{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:2px; }
.changelogReactionBtn{
  display:inline-flex;
  gap:4px;
  align-items:center;
  border-radius:999px;
  border:1px solid var(--border);
  background:color-mix(in srgb, var(--panel) 80%, transparent);
  color:var(--text);
  padding:3px 6px;
  min-height:0;
  min-width:0;
  cursor:pointer;
  font-weight:700;
  font-size:11px;
  line-height:1.1;
}
.changelogReactionEmoji{ font-size:14px; line-height:1; }
.changelogReactionCount{ font-size:12px; opacity:0.85; }
.latestUpdateReactions{ margin-top:6px; }
.changelogReactionBtn.active{ background:color-mix(in srgb, var(--accent) 28%, var(--panel)); border-color: color-mix(in srgb, var(--accent) 40%, var(--border)); box-shadow:var(--shadowSm); }

/* ===== Changelog redesign (native <details>/<summary> accordion) =====
   Reason: iOS Safari can fail to reflow flex + scroll containers when animating max-height,
   causing expanded content to overlay other entries or never become visible.
   Using <details> gives reliable expansion across browsers.
*/
.changelogList{ display:flex; flex-direction:column; gap:14px; min-height:0; }

.clItem{
  border:1px solid var(--border);
  border-radius:var(--radiusLg);
  background:color-mix(in srgb, var(--panel) 92%, transparent);
  box-shadow:var(--shadowSm);
  overflow:visible;
}

.clItem > summary{
  list-style:none;
}
.clItem > summary::-webkit-details-marker{ display:none; }

.clSummary{
  display:flex;
  align-items:center;
  gap:10px;
  padding:14px 14px;
  cursor:pointer;
  user-select:none;
}

.clLeft{
  min-width:0;
  flex:1 1 auto;
  display:flex;
  flex-direction:column;
  gap:4px;
}

.clTitle{
  font-weight:900;
  line-height:1.25;
  font-size:15px;
  overflow:hidden;
  text-overflow:ellipsis;
}

.clMeta{
  font-size:12px;
  color:var(--muted);
  opacity:0.95;
}

.clReactions{
  display:flex;
  align-items:center;
  gap:8px;
  flex:0 0 auto;
  flex-wrap:wrap;
}

.clReactBtn{
  display:inline-flex;
  gap:4px;
  align-items:center;
  border-radius:999px;
  border:1px solid var(--border);
  background:color-mix(in srgb, var(--panel) 80%, transparent);
  color:var(--text);
  padding:3px 6px;
  cursor:pointer;
  font-weight:800;
  font-size:11px;
  line-height:1.1;
}

@keyframes reactBounceAdd{
  0%{ transform:scale(1); opacity:0.6; }
  50%{ transform:scale(1.08); opacity:1; }
  100%{ transform:scale(1); opacity:1; }
}
@keyframes reactBounceRemove{
  0%{ transform:scale(1); opacity:1; }
  100%{ transform:scale(0.96); opacity:0.5; }
}
.react-bounce-add{
  animation: reactBounceAdd 160ms cubic-bezier(.22,.61,.36,1);
}
.react-bounce-remove{
  animation: reactBounceRemove 120ms cubic-bezier(.22,.61,.36,1);
}
@media (prefers-reduced-motion: reduce){
  .react-bounce-add,
  .react-bounce-remove{
    animation:none;
  }
}

.clReactBtn.active{
  background:color-mix(in srgb, var(--accent) 18%, var(--panel));
  border-color:color-mix(in srgb, var(--accent) 40%, var(--border));
  box-shadow:var(--shadowSm);
}

.clReactEmoji{ font-size:14px; line-height:1; }
.clReactCount{ font-size:12px; opacity:0.85; }

.clChevron{
  flex:0 0 auto;
  font-size:14px;
  transition:transform .15s ease;
  opacity:0.9;
}
.clItem[open] .clChevron{ transform:rotate(180deg); }

.clPanel{
  padding:0 14px 14px 14px;
  border-top:1px solid var(--border);
  display:flex;
  flex-direction:column;
  gap:10px;
}

.clBody{
  white-space:pre-line;
  overflow-wrap:anywhere;
  line-height:1.45;
  font-size:14px;
}

.clActions{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  justify-content:flex-end;
}
.clActions .btn{
  flex:1 1 140px;
  min-width:0;
}

/* Mobile: keep summary readable and prevent clipping */
@media (max-width: 520px){
  .clSummary{ align-items:flex-start; flex-wrap:wrap; }
  .clReactions{ width:100%; justify-content:flex-start; }
}
.faqForm{ display:none; flex-direction:column; gap:10px; margin-bottom:10px; position:sticky; bottom: calc(10px + var(--kb, 0px) + env(safe-area-inset-bottom)); z-index:2; background:var(--panel); padding:12px; border-radius:var(--radiusLg); box-shadow:var(--shadowSm); }
/* Questions are title-only (no separate body input). Keep DOM element for compatibility. */
#faqDetailsInput{ display:none; }
.faqList{ display:flex; flex-direction:column; gap:10px; min-height:0; touch-action: pan-y; }
.faqEntry{ padding:12px; border-radius:var(--radiusLg); border:1px solid var(--border); background:var(--panel); box-shadow:var(--shadowSm); display:flex; flex-direction:column; gap:8px; min-height:0; overflow:visible; }
.faqTitleRow{ display:flex; align-items:flex-start; gap:8px; flex-wrap:wrap; }
.faqStatus{ font-size:14px; line-height:1; flex:0 0 auto; }
.faqControls{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end; width:100%; }
.faqAnswerText{ white-space:pre-wrap; overflow-wrap:anywhere; line-height:1.45; }
.faqHeader{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; flex-wrap:wrap; flex-direction:column; }
.faqTitle{ font-weight:800; line-height:1.3; word-break:break-word; }
.faqMetaRow{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
.faqMeta{ font-size:12px; color:var(--muted); }
.faqToggle{ padding:4px 8px; min-height:36px; }
.faqDetails{ display:none; flex-direction:column; gap:8px; margin-top:6px; }
.faqEntry.is-open .faqDetails{ display:flex; }
.faqQuestion{ white-space:pre-line; overflow-wrap:anywhere; color:var(--muted); }
.faqAnswerBlock{ display:flex; flex-direction:column; gap:6px; }
.faqReactions{ display:flex; gap:6px; align-items:center; flex-wrap:wrap; margin-top:4px; }
.faqReactionBtn{ display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:var(--radiusMd); border:1px solid var(--border); background:color-mix(in srgb, var(--panel) 90%, var(--border)); font-size:13px; cursor:pointer; }
.faqReactionBtn:disabled{ opacity:0.6; cursor:default; }
.faqReactionEmoji{ font-size:14px; line-height:1; }
.faqReactionCount{ font-size:12px; opacity:0.85; }
.faqReactionBtn.active{ background:color-mix(in srgb, var(--accent) 28%, var(--panel)); border-color: color-mix(in srgb, var(--accent) 40%, var(--border)); box-shadow:var(--shadowSm); }
.faqAnswerActions{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
.faqAnswerEdit{ width:100%; min-height:120px; }
.faqControls .btn{ min-height:36px; min-width:0; flex:1 0 140px; }
.faqHeader .faqControls{ align-self:stretch; }
.chan{
  padding:9px 10px;
  border-radius:var(--radiusMd);
  cursor:pointer;
  color:var(--muted);
  display:flex;
  align-items:center;
  gap:8px;
  transition: background 0.15s ease, color 0.15s ease;
  text-shadow:var(--text-shadow-soft);
}
.chan:hover{ background:color-mix(in srgb, var(--panel) 80%, transparent); color:var(--text); }
.chan.active{ background:var(--panel); color:var(--text); border:1px solid var(--border); }
.hash{ color:var(--muted); }
.roomMaster,
.roomCategory{
  display:flex;
  flex-direction:column;
  gap:4px;
}
.roomMasterHeader,
.roomCategoryHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  width:100%;
  padding:8px 10px;
  border-radius:var(--radiusMd);
  border:1px solid transparent;
  background:color-mix(in srgb, var(--panel) 85%, transparent);
  color:var(--text);
  font-weight:800;
  text-shadow:var(--text-shadow-soft);
  cursor:pointer;
  text-align:left;
  font:inherit;
  transition: background 0.15s ease, border-color 0.15s ease;
}
.roomCategoryHeader{
  font-weight:700;
  background:color-mix(in srgb, var(--panel) 78%, transparent);
}
.roomMasterHeader:hover,
.roomCategoryHeader:hover{
  border-color:var(--border);
  background:color-mix(in srgb, var(--panel) 92%, transparent);
}
.roomHeaderLabel{
  display:flex;
  align-items:center;
  gap:8px;
  min-width:0;
}
.roomChevron{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:12px;
  transition: transform 0.18s ease;
  opacity:0.8;
}
.roomMaster.collapsed .roomMasterHeader .roomChevron,
.roomCategory.collapsed .roomCategoryHeader .roomChevron{
  transform:rotate(-90deg);
}
.roomMasterBody,
.roomCategoryBody{
  display:flex;
  flex-direction:column;
  gap:4px;
  margin-left:6px;
  padding-left:6px;
  border-left:1px solid color-mix(in srgb, var(--border) 70%, transparent);
}
.roomCategoryBody{
  margin-left:10px;
}
.roomMaster.collapsed .roomMasterBody,
.roomCategory.collapsed .roomCategoryBody{
  display:none;
}
.roomList{
  display:flex;
  flex-direction:column;
  gap:4px;
  padding-left:4px;
}
.roomManageList{
  display:flex;
  flex-direction:column;
  gap:8px;
}
.roomManageSection{ display:none; flex-direction:column; gap:12px; }
.roomManageSection.active{ display:flex; }
.roomManageTabs{ margin-top:0; }
.roomManageRow{
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
  background:color-mix(in srgb, var(--panel) 90%, transparent);
  border:1px solid var(--border);
  border-radius:var(--radiusMd);
  padding:8px;
}
.roomManageRow .label{
  font-weight:800;
  flex:1;
  min-width:120px;
}
.roomManageRow .tag{
  font-size:11px;
  padding:2px 6px;
  border-radius:999px;
  background:color-mix(in srgb, var(--panel) 75%, transparent);
  border:1px solid var(--border);
  color:var(--muted);
}
.roomManageRow .actions{
  display:flex;
  gap:6px;
  flex-wrap:wrap;
}
.roomManageRow .btn{
  min-height:32px;
  padding:6px 10px;
}

.bottomBar{
  background:color-mix(in srgb, var(--panel) 82%, var(--panel-scrim));
  border-radius:var(--radiusLg);
  border:1px solid var(--border-soft);
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:10px;
  box-shadow: var(--shadowSm);
}
.meRow{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
.meLeft{ display:flex; align-items:center; gap:10px; min-width:0; }
.meAvatar{ width:34px; height:34px; border-radius:50%; background:var(--avatar-bg); overflow:hidden; flex:0 0 auto; border:1px solid var(--border); }
.meAvatar img{ width:100%; height:100%; object-fit:cover; display:block; }
.meMeta{ min-width:0; display:flex; flex-direction:column; gap:2px; }
.meName{ font-size:13px; font-weight:900; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.meRole{ font-size:11px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.meRole,
.meStatusText{
  text-shadow:var(--text-shadow-soft);
  font-weight:500;
}
.meStatusText{ font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:140px; padding:0 2px; }
.channels.drawer-typing .bottomBar{ display:none; }
.channels.drawer-typing .roomsPanel,
.channels.drawer-typing .menuPanel{ padding-bottom:0; }

.iconBtn{
  width:36px; height:36px; padding:0;
  border-radius:var(--radiusMd); background:var(--btnSecondaryBg);
  border:1px solid var(--border);
  display:flex; align-items:center; justify-content:center;
  font-size:16px; font-weight:900; cursor:pointer; user-select:none;
  position:relative;
  color:var(--btnSecondaryText);
  transition: transform 0.08s ease, filter 0.12s ease, box-shadow 0.12s ease;
}
.iconBtn.withBadge{ padding:0 2px; }
.notifDot{
  position:absolute;
  width:12px; height:12px;
  border-radius:50%;
  background:var(--danger);
  top:-4px; left:-4px;
  border:2px solid var(--panel2);
  display:none;
  box-shadow: 0 0 0 1px var(--border);
}
.notifDot.right{ left:auto; right:-4px; }
.iconBtn.secondary{ background:var(--panel); color:var(--text); }
.iconBtn:hover{ filter:brightness(1.05); }
.iconBtn:not(:disabled):active{
  transform: scale(0.96);
  filter: brightness(0.98);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,0.16);
}

/* PayPal: tiny support button (opens hosted checkout in a new tab) */
.paypalDonateForm{ display:inline-block; margin:0; padding:0; }
.paypalDonateForm .donateBtn{
  background: rgba(255, 209, 64, 0.16);
  border-color: rgba(255, 209, 64, 0.35);
  color: #ffd140;
}
.paypalDonateForm .donateBtn:hover{ filter: brightness(1.08); }

/* Chat */
.chat{
  flex: 1;
  display: flex;
  flex-direction: column;
  min-width: 0;
  min-height: 0;
  height: 100%;
}
.topbar{
  position:relative;
  height:54px;
  min-height:54px;
  flex: 0 0 54px;
  background:color-mix(in srgb, var(--panel2) 70%, var(--panel-scrim));
  border-bottom:1px solid var(--border-soft);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 14px;
  gap:10px;
  width:100%;
  max-width:100vw;
  box-sizing:border-box;
  overflow:hidden;
  backdrop-filter: blur(var(--glass-blur));
  -webkit-backdrop-filter: blur(var(--glass-blur));
}

/* UI scale popover (topbar) */
.uiScalePanel{
  position:absolute;
  top: 56px;
  right: 10px;
  z-index: 50;
  width: min(260px, 92vw);
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 14px;
  box-shadow: var(--shadowLg);
  padding: 12px;
}
.uiScaleHeader{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px; }
.uiScaleRow{ display:flex; align-items:center; gap:10px; }
.uiScaleRow input[type="range"]{ flex:1; }
.uiScaleActions{ display:flex; justify-content:flex-end; margin-top:10px; }

.roomTitle{ font-weight:900; display:flex; align-items:center; gap:8px; text-shadow:var(--text-shadow-strong); }
.roomTitle span{ color:var(--muted); text-shadow:var(--text-shadow-soft); }
.searchWrap{ display:flex; gap:8px; align-items:center; }
.searchWrap input{
  width:260px; max-width:40vw;
  padding:10px 12px; border-radius:12px;
  border:1px solid var(--border-soft);
  background:color-mix(in srgb, var(--panel) 70%, var(--panel-scrim));
  color:var(--text);
  outline:none;
  text-shadow:var(--text-shadow-soft);
}
.searchWrap input:focus{
  border-color: color-mix(in srgb, var(--accent) 55%, var(--border-soft));
  box-shadow: var(--focusRing);
}

.chat-main .msgs{
  flex:1;
  overflow:auto;
  padding:14px 14px 12px;
  display:flex;
  flex-direction:column;
  gap:var(--msg-stack-gap, 8px);
  min-height:0;
  justify-content:flex-start;
  position:relative;
}
.chat-main .msgs::before{
  content:"";
  position:absolute;
  inset:0;
  background:color-mix(in srgb, var(--panel-scrim) 45%, transparent);
  pointer-events:none;
  z-index:0;
}
.chat-main .msgs > *{
  position:relative;
  z-index:1;
}
.chat-main .sys{
  align-self:center;
  color:var(--messageSystemText);
  font-size:var(--sys-msg-font-size, 11px);
  padding:var(--sys-msg-pad-y, 6px) calc(var(--sys-msg-pad-x, 10px) + 6px);
  border-radius:10px;
  background:color-mix(in srgb, var(--messageSystemBg) 80%, transparent);
  border:1px solid color-mix(in srgb, var(--border) 65%, transparent);
  max-width:min(90%, 640px);
  overflow-wrap:anywhere;
  word-break:break-word;
  margin:2px 0;
  position:relative;
  z-index:2;
  opacity:var(--sys-msg-opacity, 1);
  --sys-rail: color-mix(in srgb, var(--accent) 26%, transparent);
}
.chat-main .sys::before{
  content:"";
  position:absolute;
  left:8px;
  top:6px;
  bottom:6px;
  width:2px;
  border-radius:2px;
  background:var(--sys-rail);
  opacity:0.65;
}
.chat-main .sys.sys-dice{ --sys-rail: color-mix(in srgb, var(--accent) 55%, transparent); }
.chat-main .sys.sys-mod{ --sys-rail: color-mix(in srgb, var(--warning) 60%, transparent); }
.chat-main .sys.sys-sim{ --sys-rail: color-mix(in srgb, var(--success) 55%, transparent); }

.dmMessages,
.dmMsgs,
.messages{
  padding-bottom: 12px;
}

/* Dice Room: scale system messages + dice faces ONLY in that room */
body.dice-room .chat-main .sys{
  font-size:calc(var(--sys-msg-font-size, 11px) * 2);
  padding:calc(var(--sys-msg-pad-y, 6px) + 4px) calc(var(--sys-msg-pad-x, 10px) + 10px);
}
body.dice-room .chat-main .sys .diceFace{
  font-size:2em; /* 2x within the 2x sys => 4x overall */
  line-height:1;
  display:inline-block;
  vertical-align:middle;
  margin:0 2px;
}
/* Dice Room: Luck meter (pinned) */
.luckMeter{
  display:none;
  position: sticky;
  top:0;
  z-index: 120;
  padding:10px 12px;
  border-bottom:1px solid var(--border);
  background: color-mix(in srgb, var(--panel) 88%, transparent);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
body.dice-room .luckMeter{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.luckMeterHeader{
  display:flex;
  align-items:center;
  gap:10px;
  font-size:12px;
  font-weight:900;
  text-transform: uppercase;
  letter-spacing:0.6px;
}
.luckMeterTitle{
  display:inline-flex;
  align-items:center;
  gap:6px;
  color:var(--textStrong, var(--text));
}
.luckMeterValue{
  font-variant-numeric: tabular-nums;
  color:var(--text);
}
.luckMeterStreak{
  font-size:11px;
  font-weight:700;
  color:var(--muted);
  margin-left:auto;
}
.luckMeterBar{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size:12px;
  letter-spacing:1px;
  color:var(--muted);
}
.luckMeterBarText{
  color:var(--text);
}
/* Survival Simulator panel */
.survivalPanel{
  display:none;
  position: sticky;
  /* Keep below the fixed top bar on mobile/desktop */
  top: calc(var(--topBarH, 56px) + var(--safeT, 0px));
  z-index:120;
  margin:8px 12px 6px;
  padding:12px 14px;
  border-radius:16px;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--panel) 88%, transparent);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}
body.survival-room .survivalPanel{
  display:flex;
  flex-direction:column;
  gap:10px;
}
.survivalPanelHeader{
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  justify-content:space-between;
  gap:6px 14px;
}
.survivalPanelTitle{
  display:flex;
  align-items:center;
  gap:10px;
  font-weight:800;
}
.survivalPanelName{
  font-size:14px;
}
.survivalPanelSeasonTitle{
  font-size:12px;
  color:var(--text);
}
.survivalPanelStatus{
  padding:3px 8px;
  border-radius:999px;
  font-size:11px;
  background: color-mix(in srgb, var(--panel) 70%, transparent);
  color:var(--muted);
}
.survivalPanelMeta{
  display:flex;
  align-items:center;
  gap:10px;
  font-size:12px;
  color:var(--muted);
}
.survivalPanelControls{
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  justify-content:space-between;
  gap:8px 12px;
}

.survivalOpenBtn{
  white-space:nowrap;
  min-width:32px;
  width:32px;
  height:32px;
  padding:0;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}
.survivalModalShell{
  width:min(1100px, 100%);
  max-height:calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
}
.survivalModalTop{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:12px;
}
.survivalModalHeading{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.survivalModalMeta{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  font-size:12px;
  color:var(--muted);
}
.survivalModalTabs{
  display:flex;
  gap:8px;
  padding:0 16px 12px;
  border-bottom:1px solid var(--line);
  flex-wrap:wrap;
}
.survivalModalBody{
  overflow:auto;
  display:flex;
  flex-direction:column;
  gap:16px;
}
.survivalModalSection{
  display:none;
  flex-direction:column;
  gap:12px;
  min-height:0;
}
.survivalModalSection.active{
  display:flex;
}
.survivalLogHeaderRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  flex-wrap:wrap;
}
.survivalNewSeasonPanel{
  border:1px solid var(--border);
  border-radius:16px;
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:10px;
  background:color-mix(in srgb, var(--panel) 92%, transparent);
}

.survivalCollapseBtn{ margin-left:auto; }

/* Mini collapsed button shown at the very top when survival UI is collapsed */
.survivalMiniBtn{
  position:fixed;
  /* Show below the top bar so it's never hidden behind it */
  top: calc(var(--topBarH, 56px) + var(--safeT, 0px) + 8px);
  left:50%;
  transform:translateX(-50%);
  pointer-events:none;
  z-index:140;
  width:auto;
  border-radius:14px;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--panel) 80%, transparent);
  color:var(--text);
  padding:8px 10px;
  font-weight:800;
  box-shadow: 0 10px 26px rgba(0,0,0,0.25);
}

.survivalPanelGroup{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}
.survivalHistoryLabel{
  display:inline-flex;
  align-items:center;
  gap:6px;
  font-size:11px;
  color:var(--muted);
}
.survivalHistoryLabel select{
  background: color-mix(in srgb, var(--panel) 80%, transparent);
  border:1px solid var(--border);
  color:var(--text);
  border-radius:10px;
  padding:4px 8px;
}

.survivalLogFeed{
  display:none;
  margin:0 12px 10px;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--panel) 75%, transparent);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  max-height:220px;
  overflow:auto;
}
body.survival-room .survivalLogFeed{
  display:block;
}
.survivalLogHeader{
  font-size:11px;
  letter-spacing:0.6px;
  text-transform:uppercase;
  color:var(--muted);
  margin-bottom:6px;
}
.survivalLogList{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.survivalLogItem{
  display:grid;
  grid-template-columns:20px 1fr;
  gap:8px;
  align-items:start;
  font-size:13px;
}
.survivalLogIcon{
  font-size:14px;
}
.survivalLogText{
  color:var(--text);
}
.survivalLogDivider{
  margin:6px 0 4px;
  font-size:11px;
  color:var(--muted);
}

.survivalArena{
  display:none;
  margin:0 12px 10px;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--panel) 75%, transparent);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
body.survival-room .survivalArena{
  display:block;
}
.survivalArenaHeader{
  display:flex;
  justify-content:space-between;
  align-items:baseline;
  margin-bottom:6px;
}
.survivalArenaTitle{
  font-size:11px;
  letter-spacing:0.6px;
  text-transform:uppercase;
  color:var(--muted);
}
.survivalArenaGrid{
  display:grid;
  grid-template-columns:repeat(2, minmax(0, 1fr));
  gap:10px;
}
.survivalZone{
  border:1px solid var(--border);
  border-radius:14px;
  padding:10px;
  background: color-mix(in srgb, var(--panel) 82%, transparent);
}
.survivalZoneTop{
  display:flex;
  justify-content:space-between;
  gap:10px;
  align-items:center;
  margin-bottom:8px;
}
.survivalZoneName{font-weight:700;font-size:13px;}
.survivalZoneDanger{font-size:11px;color:var(--muted);}
.survivalZoneBadges{display:flex;flex-wrap:wrap;gap:6px;}
.survivalBadge{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:5px 8px;
  border-radius:999px;
  border:1px solid var(--border);
  font-size:12px;
}
.survivalBadge .dot{width:8px;height:8px;border-radius:999px;background:var(--accent);opacity:0.9;}

@media (max-width: 420px){
  .survivalArenaGrid{grid-template-columns:1fr;}
}

.survivalModal .modalBody{
  display:flex;
  flex-direction:column;
  gap:12px;
}
.survivalPickerModes{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  font-size:12px;
  color:var(--muted);
}
.survivalParticipantList{
  max-height:220px;
  overflow:auto;
  border-radius:12px;
  border:1px solid var(--border);
  padding:8px;
}
.survivalParticipantRow{
  display:flex;
  align-items:center;
  gap:8px;
  padding:6px 4px;
  font-size:13px;
}
.survivalOptions{
  display:flex;
  flex-direction:column;
  gap:6px;
  font-size:12px;
  color:var(--muted);
}

.survivalNpcFields{
  margin-top:8px;
  padding:10px;
  border-radius:14px;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--panel) 82%, transparent);
}
.survivalNpcFields textarea{
  width:100%;
  margin-top:6px;
  border-radius:12px;
}
.survivalNpcRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-top:8px;
}
.survivalNpcRow input[type="number"]{
  width:120px;
}
.survivalRosterList{
  display:flex;
  flex-direction:column;
  gap:10px;
}
.survivalRosterRow{
  display:flex;
  align-items:center;
  gap:10px;
  padding:8px;
  border-radius:12px;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--panel) 80%, transparent);
}
.survivalRosterRow.dead{
  opacity:0.7;
}
.survivalRosterAvatar{
  width:34px;
  height:34px;
  border-radius:50%;
  background-size:cover;
  background-position:center;
}
.survivalRosterMeta{
  display:flex;
  flex-direction:column;
}
.survivalRosterName{
  font-weight:700;
}
.survivalRosterStats{
  font-size:11px;
  color:var(--muted);
}
.survivalRosterStatus.dead{
  color:#ff9aa2;
}

.chan[data-room=\"survivalsimulator\"]::before{
  content:\"🧭 \";
}
/* ---- Main chat message grouping (consecutive messages) ---- */
.chat-main .msgGroup{ display:flex; gap:8px; align-items:flex-start; max-width:900px; }
.chat-main .msgGroup.self{ align-self:flex-end; flex-direction:row-reverse; }
.chat-main .msgGroupBody{ display:flex; flex-direction:column; gap:var(--msg-group-gap, var(--fx-group-gap, 4px)); min-width:0; }
.chat-main .msgItem.msg--main{ position:relative; display:flex; flex-direction:row; align-items:flex-start; gap:var(--msg-item-gap, 8px); min-width:0; }
.chat-main .msgItem.msg--main.self{ flex-direction:row-reverse; }
.chat-main .msgGroup + .msgGroup .msgGroupBody{
  padding-top:4px;
  border-top:1px solid color-mix(in srgb, var(--border) 55%, transparent);
}

/* --- Message layout preferences (main chat) --- */
body.msg-density-compact .chat-main{
  --msg-pad-y:6px;
  --msg-pad-x:10px;
  --msg-accent-offset:2px;
  --msg-accent-height:3px;
  --msg-accent-gap:3px;
  --msg-group-gap:2px;
  --msg-stack-gap:6px;
  --msg-item-gap:6px;
  --msg-meta-gap:6px;
  --msg-line-height:1.3;
}
body.msg-density-medium .chat-main{
  --msg-pad-y:8px;
  --msg-pad-x:12px;
  --msg-accent-offset:2px;
  --msg-accent-height:4px;
  --msg-accent-gap:4px;
  --msg-group-gap:4px;
  --msg-stack-gap:8px;
  --msg-item-gap:8px;
  --msg-meta-gap:8px;
  --msg-line-height:1.4;
}
body.msg-density-comfortable .chat-main{
  --msg-pad-y:11px;
  --msg-pad-x:14px;
  --msg-accent-offset:3px;
  --msg-accent-height:5px;
  --msg-accent-gap:4px;
  --msg-group-gap:6px;
  --msg-stack-gap:12px;
  --msg-item-gap:10px;
  --msg-meta-gap:10px;
  --msg-line-height:1.5;
}

body.msg-contrast-low .chat-main{ --msg-bg-strength:12%; }
body.msg-contrast-medium .chat-main{ --msg-bg-strength:18%; }
body.msg-contrast-high .chat-main{ --msg-bg-strength:28%; }

body.msg-accent-solid .chat-main,
body.msg-accent-solid .chat-dm{
  --msg-accent-fill: color-mix(in srgb, var(--fx-accent, var(--accent)) 45%, transparent);
  --msg-accent-opacity: 0.55;
}
body.msg-accent-dotted .chat-main,
body.msg-accent-dotted .chat-dm{
  --msg-accent-fill: repeating-linear-gradient(
    180deg,
    color-mix(in srgb, var(--fx-accent, var(--accent)) 55%, transparent) 0 2px,
    transparent 2px 5px
  );
  --msg-accent-opacity: 0.7;
}
body.msg-accent-gradient .chat-main,
body.msg-accent-gradient .chat-dm{
  --msg-accent-fill: linear-gradient(
    180deg,
    color-mix(in srgb, var(--fx-accent, var(--accent)) 55%, transparent) 0%,
    transparent 100%
  );
  --msg-accent-opacity: 0.65;
}
body.msg-accent-hoverglow .chat-main,
body.msg-accent-hoverglow .chat-dm{
  --msg-accent-fill: color-mix(in srgb, var(--fx-accent, var(--accent)) 40%, transparent);
  --msg-accent-opacity: 0.35;
}
body.msg-accent-hoverglow .chat-main .msg--main:hover .bubble::before,
body.msg-accent-hoverglow .chat-main .msg--main.showActions .bubble::before,
body.msg-accent-hoverglow .chat-dm .dmRow.msg--dm:hover .dmBubble::before,
body.msg-accent-hoverglow .chat-dm .dmRow.msg--dm.showActions .dmBubble::before{
  opacity:0.65;
  box-shadow:0 0 6px color-mix(in srgb, var(--fx-accent, var(--accent)) 35%, transparent);
}

body.msg-name-bold .chat-main .msg--main .name{ font-weight:800; }
body.msg-name-underlinehover .chat-main .msg--main .name .unameText{
  text-decoration:none;
  text-underline-offset:3px;
}
body.msg-name-underlinehover .chat-main .msg--main:hover .name .unameText,
body.msg-name-underlinehover .chat-main .msg--main.showActions .name .unameText{
  text-decoration:underline;
}
body.msg-name-rolechip .chat-main .msg--main .name .unameText{
  padding:2px 6px;
  border-radius:999px;
  background:color-mix(in srgb, var(--panel) 80%, transparent);
  border:1px solid color-mix(in srgb, var(--fx-accent, var(--accent)) 18%, transparent);
}

body.sys-density-full .chat-main{
  --sys-msg-font-size:11px;
  --sys-msg-pad-y:6px;
  --sys-msg-pad-x:10px;
  --sys-msg-opacity:1;
}
body.sys-density-compact .chat-main{
  --sys-msg-font-size:10px;
  --sys-msg-pad-y:4px;
  --sys-msg-pad-x:8px;
  --sys-msg-opacity:0.9;
}
body.sys-density-minimized .chat-main{
  --sys-msg-font-size:9px;
  --sys-msg-pad-y:3px;
  --sys-msg-pad-x:6px;
  --sys-msg-opacity:0.7;
}

.chat-main .msgItem.msg--main.message--deleting,
.chat-dm .dmRow.msg--dm.message--deleting{
  opacity:0;
  transform: translateY(-4px) scale(0.98);
  transition: opacity 200ms ease, transform 200ms ease;
  pointer-events:none;
}
@media (prefers-reduced-motion: reduce){
  .chat-main .msgItem.msg--main.message--deleting,
  .chat-dm .dmRow.msg--dm.message--deleting{
    transition-duration: 1ms;
    transform: none;
  }
}

/* ---- Main chat actions: no reserved space + horizontal bar below message ----
   Actions live inside .msgMain (after bubble + reactions) and are collapsed
   by default so they consume ZERO space. When opened (tap/hover), they expand
   downward with a small animation.
*/

/* Message layout container: bubble + reacts + actions */
.chat-main .msgMain{
  display:flex;
  flex-direction:column;
  /* Don't use flex gap here.
     Flex gap reserves spacing even when .msgActions is collapsed, which
     makes it look like the UI is "reserving" space.
     Use margins on .reacts and the opened actions row instead. */
  gap:0;
  /* Keep bubbles content-sized (avoid stretching to the width of other
     rows like reactions). */
  align-items:flex-start;
  min-width:0;
}

/* Self messages: keep the stack aligned to the right, while still allowing
   the bubble itself to stay content-sized. */
.chat-main .msgItem.msg--main.self .msgMain{ align-items:flex-end; }

/* Collapsed by default: no height, no interaction */
.chat-main .msgMain .msgActions{
  display:flex;
  flex-direction:row;
  gap:6px;
  justify-content:flex-start;
  align-items:center;
  width:fit-content;
  max-width:100%;
  overflow:hidden;
  max-height:0;
  opacity:0;
  margin-top:0;
  pointer-events:none;
  transform: translateY(-4px);
  transition: max-height .18s ease, opacity .15s ease, transform .18s ease, margin-top .18s ease;
}

/* Self messages: align the action row to the right */
.chat-main .msgItem.msg--main.self .msgMain .msgActions{
  justify-content:flex-end;
  align-self:flex-end;
}

/* Reveal actions on hover (desktop) */
@media (hover:hover){
  .chat-main .msgItem.msg--main:hover .msgMain .msgActions{
    max-height:72px;
    opacity:1;
    margin-top:6px;
    pointer-events:auto;
    transform: translateY(0);
  }
}

/* Reveal actions when toggled open (mobile) */
.chat-main .msgItem.msg--main.showActions .msgMain .msgActions{
  max-height:72px;
  opacity:1;
  margin-top:6px;
  pointer-events:auto;
  transform: translateY(0);
}
/* Make grouped bubbles visually merge into one (main chat) */
.chat-main .msgGroupBody{ gap:var(--msg-group-gap, var(--fx-group-gap, 4px)); }
.chat-main .msgItem.msg--main.gCont .bubble{ margin-top:2px; }
.chat-main .msgItem.msg--main.gMid .bubble{ margin-top:2px; }
.chat-main .msgItem.msg--main.msg--grouped:not(.msg--group-start){
  margin-top:2px;
}

/* Corner shaping so grouped messages look like one continuous bubble */
.chat-main .msgItem.msg--main.gFirst:not(.gLast) .bubble{
  border-bottom-left-radius:var(--fx-radius-grouped, 8px);
  border-bottom-right-radius:var(--fx-radius-grouped, 8px);
}
.chat-main .msgItem.msg--main.gMid .bubble{
  border-radius:var(--fx-radius-grouped, 8px);
}
.chat-main .msgItem.msg--main.gLast:not(.gFirst) .bubble{
  border-top-left-radius:var(--fx-radius-grouped, 8px);
  border-top-right-radius:var(--fx-radius-grouped, 8px);
}
/* If a message has reactions, give it a little breathing room (splits by reaction space) */
.chat-main .msgItem.msg--main.hasReacts{ margin-bottom:6px; }

.msg{ display:flex; gap:10px; align-items:flex-start; max-width:900px; }
.msg.self{ align-self:flex-end; flex-direction:row-reverse; }
.msgAvatar{ width:38px; height:38px; border-radius:50%; background:var(--avatar-bg); overflow:hidden; flex:0 0 auto; border:1px solid var(--border); }
.msgAvatar img{ width:100%; height:100%; object-fit:cover; display:block; }
.msgItem,
.dmRow,
.dmThreadRow,
.dmItem,
.profileSheetHero{
  --userGlow: transparent;
  /* Default to "off" so fallback rgba(var(--userGlowRgb)/...) never shows a ring */
  --userGlowRgb: 0 0 0;
}
.bubble{
  --fx-base: var(--fx-bubble-bg, var(--messageOtherBg));
  --fx-contrast-shadow: var(--text-shadow-soft);
  color:var(--fx-text, var(--messageOtherText));
  padding:var(--fx-pad-y, 10px) var(--fx-pad-x, 12px);
  border-radius:var(--fx-radius, 14px);
  /* Content-sized bubble: tiny messages stay tiny, long messages wrap. */
  display:inline-flex;
  flex-direction:column;
  gap:var(--fx-inner-gap, 6px);
  width:fit-content;
  max-width:min(70vw, 720px);
  flex:0 0 auto;
  align-self:flex-start;
  word-wrap:break-word;
  border-style:solid;
  border-width:var(--fx-border, 0px);
  border-color:color-mix(in srgb, var(--fx-accent, var(--accent)) 22%, var(--border));
  overflow:hidden;
  font-family:var(--fx-font-family, inherit);
  backdrop-filter: blur(var(--fx-blur, 0px));
  background:
    linear-gradient(rgba(255,255,255, var(--fx-glass, 0)), rgba(255,255,255, var(--fx-glass, 0))),
    var(--fx-base);
  box-shadow:
    0 0 calc(var(--fx-glow, 0) * 6px) color-mix(in srgb, var(--fx-accent, var(--accent)) 45%, transparent),
    0 0 calc(var(--fx-glow, 0) * 14px) color-mix(in srgb, var(--fx-accent, var(--accent)) 28%, transparent);
}
.chat-main .msg--main .bubble{
  --fx-radius: 8px;
  --fx-border: 0;
  --fx-glow: 0;
  --fx-blur: 0;
  --fx-glass: 0;
  --msg-accent-top-size: var(--msg-accent-height, 4px);
  --msg-accent-bottom-size: 0px;
  --fx-contrast-shadow: 0 1px 2px rgba(0,0,0,0.18);
  padding:var(--msg-pad-y, 8px) var(--msg-pad-x, 12px);
  padding-top:calc(var(--msg-pad-y, 8px) + var(--msg-accent-height, 4px) + var(--msg-accent-gap, 4px));
  padding-bottom:var(--msg-pad-y, 8px);
  line-height:var(--msg-line-height, 1.45);
  background:transparent;
  border-color:transparent;
  box-shadow:none;
}
.chat-main .msgItem.msg--main.msg--group-end .bubble{
  --msg-accent-bottom-size: var(--msg-accent-height, 4px);
  padding-bottom:calc(var(--msg-pad-y, 8px) + var(--msg-accent-height, 4px) + var(--msg-accent-gap, 4px));
}
.chat-main .msg--main .bubble::before{
  content:"";
  position:absolute;
  left:0;
  right:0;
  top:0;
  bottom:0;
  border-radius:999px;
  background-image:
    var(--msg-accent-fill, color-mix(in srgb, var(--fx-accent, var(--accent)) 45%, transparent)),
    var(--msg-accent-fill, color-mix(in srgb, var(--fx-accent, var(--accent)) 45%, transparent));
  background-repeat:no-repeat;
  background-position: top left, bottom left;
  background-size: 100% var(--msg-accent-top-size, 4px), 100% var(--msg-accent-bottom-size, 0px);
  opacity:var(--msg-accent-opacity, 0.6);
  pointer-events:none;
  transition: opacity 160ms ease, box-shadow 160ms ease;
}
.bubble,
.dmBubble{
  position:relative;
}

/*
  HARD KILL: "green/blue rectangles" around messages
  ---------------------------------------------------
  Some mobile/WebKit combinations can render a rectangular focus/outline ring
  (outline does NOT respect border-radius) on message wrappers or bubbles.
  This looks like a reactive green/blue box that changes while typing.

  We explicitly disable outlines on all main-chat message containers and then
  re-introduce the glow strictly via the bubble ::after shadow (rounded).
*/
.chat-main .msgGroup,
.chat-main .msgGroupBody,
.chat-main .msgItem,
.chat-main .msgMain,
.chat-main .bubble,
.chat-dm .dmRow,
.chat-dm .dmBubbleWrap,
.chat-dm .dmMetaRow,
.chat-dm .dmAvatarSlot,
.chat-dm .dmMessages{
  outline: none !important;
  -webkit-tap-highlight-color: transparent;
}

/* If any wrapper pseudo-elements exist (from past experiments), neutralize them. */
.chat-main .msgGroup::before,
.chat-main .msgGroup::after,
.chat-main .msgItem::before,
.chat-main .msgItem::after,
.chat-main .msgMain::before,
.chat-main .msgMain::after{
  content: none !important;
  box-shadow: none !important;
  border: 0 !important;
}
.bubble::after,
.dmBubble::after{
  content:"";
  position:absolute;
  inset:-1px;
  border-radius:inherit;
  pointer-events:none;
  /*
    IMPORTANT:
    iOS/WebKit variants that don't support color-mix() will fall back to the
    rgba(--userGlowRgb) shadow below. That was showing a visible outline on
    *every* message (seen as green squares), even when --userGlow is transparent.

    Default to NO outline, and only enable the glow in the color-mix() branch
    where we can respect --userGlow.
  */
  opacity:0;
  box-shadow:none;
  transition: opacity 180ms ease, box-shadow 180ms ease;
}
@supports (color: color-mix(in srgb, #000, #fff)){
  .bubble::after,
  .dmBubble::after{
    opacity:0.6;
    box-shadow:
      0 0 0 1px color-mix(in srgb, var(--userGlow) 28%, transparent),
      0 0 12px color-mix(in srgb, var(--userGlow) 20%, transparent);
  }
}
.chat-main .msg--main.self .bubble{
  --fx-base: var(--fx-bubble-bg, var(--messageSelfBg));
  color:var(--fx-text, var(--messageSelfText));
}

/* Right-align self bubbles without forcing them to stretch. */
.chat-main .msgItem.msg--main.self .bubble{ align-self:flex-end; }
.bubble,
.dmBubble{
  transition: filter 180ms ease, box-shadow 180ms ease;
}
.msgEnter{
  --msg-enter-anim: msgEnterBase;
  --msg-vip-anim: none;
  animation: var(--msg-enter-anim) 280ms ease-out both, var(--msg-vip-anim) 520ms ease-out both;
}
.msgEnter--long{ --msg-enter-anim: msgEnterLong; }
.msgEnter--media{ --msg-enter-anim: msgEnterMedia; }
.msgEnter--vip{ --msg-vip-anim: msgEnterVip; }
@keyframes msgEnterBase{
  0%{ opacity:0; transform: translateY(10px); }
  100%{ opacity:1; transform: translateY(0); }
}
@keyframes msgEnterLong{
  0%{ opacity:0; transform: translateY(12px) scaleY(0.98); }
  100%{ opacity:1; transform: translateY(0) scaleY(1); }
}
@keyframes msgEnterMedia{
  0%{ opacity:0; transform: translateY(8px) scale(0.96); }
  100%{ opacity:1; transform: translateY(0) scale(1); }
}
@keyframes msgEnterVip{
  0%{ box-shadow: 0 0 0 rgba(var(--userGlowRgb, 88 101 242) / 0); }
  40%{ box-shadow: 0 0 18px rgba(var(--userGlowRgb, 88 101 242) / 0.45); }
  100%{ box-shadow: 0 0 0 rgba(var(--userGlowRgb, 88 101 242) / 0); }
}
@media (prefers-reduced-motion: reduce){
  .msgEnter{ animation:none; }
}
.chat-main .msgItem.msg--main:hover .bubble,
.chat-dm .dmRow.msg--dm:hover .dmBubble,
.chat-main .msgItem.msg--main.showActions .bubble,
.chat-dm .dmRow.msg--dm.showActions .dmBubble{
  filter: brightness(1.04);
  box-shadow: none;
}

@media (hover:hover) and (pointer:fine){
  body.polish-pack .chat-main .msgItem.msg--main .bubble,
  body.polish-pack .chat-dm .dmRow.msg--dm .dmBubble{
    outline: 1px solid transparent;
    outline-offset: -1px;
    transition: outline-color 160ms ease;
  }
  body.polish-pack .chat-main .msgItem.msg--main:hover .bubble,
  body.polish-pack .chat-dm .dmRow.msg--dm:hover .dmBubble{
    outline-color: color-mix(in srgb, var(--fx-accent, var(--accent)) 22%, transparent);
  }
  body.polish-pack .chat-main .msgItem.msg--main.hasReacts:hover .bubble,
  body.polish-pack .chat-dm .dmRow.msg--dm.hasReacts:hover .dmBubble{
    outline-color: color-mix(in srgb, var(--fx-accent, var(--accent)) 42%, transparent);
  }

  /* DMs: disable the square outline ring (it can appear as harsh boxes on some themes). */
  body.polish-pack .chat-dm .dmRow.msg--dm .dmBubble{
    outline: none !important;
  }
}

/* Message meta (name/time) */
.chat-main .msgItem.msg--main .meta{
  display:flex;
  gap:8px;
  align-items:baseline;
  flex-wrap:wrap;
}
.chat-main .msgItem.msg--main .name{ font-weight:700; }
.chat-main .msgItem.msg--main .name .unameText{
  font-family: var(--fx-name-font-family, inherit);
  color: var(--fx-name-color, inherit);
  text-shadow:var(--text-shadow-soft);
}
.chat-main .msgItem.msg--main .name .unameText[data-role="owner"],
.dmMetaUser[data-role="owner"]{
  text-shadow: 0 0 6px rgba(120, 255, 180, 0.45), 0 0 12px rgba(120, 255, 180, 0.22);
}
.chat-main .msgItem.msg--main .name .unameText[data-role="coowner"],
.dmMetaUser[data-role="coowner"]{
  text-shadow: 0 0 6px rgba(200, 150, 255, 0.45), 0 0 12px rgba(255, 120, 220, 0.25);
}
.chat-main .msgItem.msg--main .name .unameText[data-role="admin"],
.dmMetaUser[data-role="admin"],
.chat-main .msgItem.msg--main .name .unameText[data-role="moderator"],
.dmMetaUser[data-role="moderator"]{
  background-image: linear-gradient(transparent 70%, rgba(255, 215, 120, 0.75) 70%);
  background-size: 100% 100%;
  background-repeat: no-repeat;
  padding-bottom: 1px;
}
.chat-main .msgItem.msg--main .name .unameText[data-role="vip"],
.dmMetaUser[data-role="vip"]{
  text-shadow: 0 0 4px rgba(120, 200, 255, 0.45), 0 0 9px rgba(120, 200, 255, 0.25);
}
.chat-main .msgItem.msg--main .time{
  font-size: var(--fx-time-size, 11px);
  opacity: .65;
  text-shadow:var(--text-shadow-soft);
}
.toneBadge{
  margin-left:6px;
  font-size:12px;
  opacity:0.78;
  text-shadow:var(--text-shadow-soft);
}

/* Reactions are OUTSIDE the bubble (inside .msgMain) */
.chat-main .msgMain > .reacts{
  align-self:flex-end;
  margin:0 2px 2px 2px;
}
.chat-main .msgMain > .reacts:empty{ display:none; }
.metaLine{ display:flex; gap:8px; align-items:baseline; flex-wrap:wrap; }
.uName{ font-weight:900; font-size:13px; text-shadow:var(--text-shadow-soft); }
.badge{
  font-size:10px; font-weight:900;
  padding:3px 7px; border-radius:999px;
  border:1px solid var(--border); background:color-mix(in srgb, var(--panel) 80%, transparent);
}
.editedTag{ font-size:11px; color:var(--muted); opacity:.9; text-shadow:var(--text-shadow-soft); }
.self .editedTag{ color:var(--messageSelfText); opacity:.85; }

/* Inline edit box */
.editBox{ margin-top:8px; display:flex; flex-direction:column; gap:8px; }
.editBox textarea{
  width:100%;
  min-height:72px;
  resize:vertical;
  border-radius:12px;
  border:1px solid var(--border);
  background:color-mix(in srgb, var(--panel) 85%, transparent);
  color:var(--text);
  padding:10px;
  outline:none;
}
.editRow{ display:flex; gap:8px; justify-content:flex-end; }
.editRow button{
  padding:8px 10px;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--panel2);
  color:var(--text);
  font-weight:800;
}
.editRow button.primary{
  background:var(--accent);
  color:#0b0b0c;
  border-color:color-mix(in srgb, var(--accent) 60%, var(--border));
}

.ts{ font-size:11px; color:var(--muted); text-shadow:var(--text-shadow-soft); }
.self .ts{ color:var(--messageSelfText); opacity:.85; }
.text{
  font-size:14px;
  line-height:1.35;
  white-space:pre-wrap;
  overflow-wrap:anywhere;   /* ✅ breaks long strings */
  word-break:break-word;    /* ✅ backup */
}
.bubble .text,
.dmBubble .text{
  font-weight: var(--fx-text-weight, 400);
  font-style: var(--fx-text-style, normal);
  text-shadow:
    0 0 calc(var(--fx-text-glow, 0) * 6px) color-mix(in srgb, var(--fx-accent, var(--accent)) 60%, transparent),
    0 0 calc(var(--fx-text-glow, 0) * 14px) color-mix(in srgb, var(--fx-accent, var(--accent)) 35%, transparent),
    var(--fx-text-grad-shadow, 0 0 0 transparent),
    var(--fx-contrast-shadow, 0 0 0 transparent);
  -webkit-text-stroke: var(--fx-contrast-stroke, 0px) var(--fx-contrast-stroke-color, transparent);
}
.bubble.fx-textGradient .text,
.dmBubble.fx-textGradient .text{
  background-image: linear-gradient(var(--fx-text-grad-angle, 135deg), var(--fx-text-grad-a, #7c4dff), var(--fx-text-grad-b, #00e5ff));
  background-clip: text;
  -webkit-background-clip: text;
  background-size: 200% 200%;
  background-position: 0% 50%;
  color: transparent;
  -webkit-text-fill-color: transparent;
  -webkit-text-stroke: var(--fx-text-grad-stroke, var(--fx-contrast-stroke, 0px)) var(--fx-text-grad-stroke-color, var(--fx-contrast-stroke-color, transparent));
}
.mention{ background:var(--mentionBg); color:var(--mentionText); border:1px solid var(--border); padding:0 4px; border-radius:6px; }
/* ===== Message actions (horizontal bar below message) =====
   Actions live inside .msgMain and are collapsed by default so they reserve
   ZERO space. When opened (tap/hover), they expand downward.
*/

/* Collapsed by default: no height, no interaction */
.chat-main .msgMain .msgActions{
  display:flex;
  flex-direction:row;
  gap:6px;
  justify-content:flex-start;
  align-items:center;
  width:fit-content;
  max-width:100%;
  overflow:hidden;
  max-height:0;
  opacity:0;
  margin-top:0;
  pointer-events:none;
  transform: translateY(-4px);
  transition: max-height .18s ease, opacity .15s ease, transform .18s ease, margin-top .18s ease;
}

/* Self messages: align action row right */
.chat-main .msgItem.msg--main.self .msgMain .msgActions{
  justify-content:flex-end;
  align-self:flex-end;
}

@media (hover:hover){
  .chat-main .msgItem.msg--main:hover .msgMain .msgActions{
    max-height:72px;
    opacity:1;
    margin-top:6px;
    pointer-events:auto;
    transform: translateY(0);
  }
}

.chat-main .msgItem.msg--main.showActions .msgMain .msgActions{
  max-height:72px;
  opacity:1;
  margin-top:6px;
  pointer-events:auto;
  transform: translateY(0);
}

.attachment{
  margin-top:6px;
  border-radius:var(--radiusLg);
  overflow:hidden;
  border:1px solid var(--border);
  max-width: min(520px, 80vw);
  background:var(--panel);
  display: inline-block;
}
.attachment img, .attachment video{ display:block; max-width:100%; height:auto; }
.attachment img, .attachment video{ user-select:none; }
.attachment video{ background:var(--bg); }
.msg-media-thumb{
  max-width: clamp(180px, 60vw, 320px);
  max-height: 240px;
  border-radius: 12px;
  object-fit: cover;
}

.actions{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:2px; }
.reactBtn{
  border:1px solid var(--border); border-radius:var(--radiusMd);
  padding:6px 8px; background:color-mix(in srgb, var(--panel) 70%, transparent);
  color:var(--text); cursor:pointer; font-weight:900; user-select:none;
}
.reactBtn:hover{ background:color-mix(in srgb, var(--panel) 85%, transparent); }

.reactions{ display:flex; gap:6px; flex-wrap:wrap; margin-top:2px; }
.reactPill{
  background:color-mix(in srgb, var(--panel) 80%, transparent); border:1px solid var(--border);
  border-radius:999px; padding:4px 8px; font-size:12px; font-weight:900;
}

.typing{
  position:absolute;
  left:0;
  right:0;
  /* Use a capped anchor so theme-specific composer UI can't push typing too high */
  bottom: calc(var(--typingAnchorH, var(--composerH, 72px)) + 6px);
  height:22px;
  padding:0 14px;
  color:var(--muted);
  font-size:12px;
  display:flex;
  align-items:center;
  flex:0 0 auto;
  pointer-events:none;
  z-index:120;
}
.typingDots{
  display:inline-flex;
  gap:4px;
  margin-left:6px;
}
.typingDots .dot{
  width:4px;
  height:4px;
  border-radius:50%;
  background:currentColor;
  opacity:0.35;
  animation: typingShimmer 900ms ease-in-out infinite;
}
.typingDots .dot:nth-child(2){ animation-delay:150ms; }
.typingDots .dot:nth-child(3){ animation-delay:300ms; }
.typing:empty .typingDots{ display:none; }
@keyframes typingShimmer{
  0%{ opacity:0.35; }
  40%{ opacity:1; }
  100%{ opacity:0.35; }
}
@media (prefers-reduced-motion: reduce){
  .typingDots .dot{ animation:none; opacity:0.7; }
}
.typing:empty{
  height:0;
  padding:0;
}

#jumpToLatest{
  position:absolute;
  right:14px;
  bottom: calc(var(--typingAnchorH, var(--composerH, 72px)) + 16px);
  display:none;
  align-items:center;
  gap:6px;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid var(--border);
  background:color-mix(in srgb, var(--panel) 85%, transparent);
  color:var(--text);
  box-shadow:var(--shadowSm);
  font-weight:800;
  cursor:pointer;
  z-index:140;
}
#jumpToLatest.show{ display:flex; }

.inputBar{
  padding:12px;
  background:color-mix(in srgb, var(--panel2) 72%, var(--panel-scrim));
  border-top:1px solid var(--border-soft);
  display:flex;
  gap:10px;
  align-items:center;
  flex-shrink:0;
  position: relative;
  bottom: auto;
  backdrop-filter: blur(var(--glass-blur));
  -webkit-backdrop-filter: blur(var(--glass-blur));
}
.inputBar input[type="text"]{
  flex:1;
  padding:12px 12px;
  border-radius:var(--radiusLg);
  border:1px solid var(--border-soft);
  background:color-mix(in srgb, var(--inputBg) 80%, var(--panel-scrim));
  color:var(--inputText);
  outline:none;
  text-shadow:var(--text-shadow-soft);
}
.inputBar input[type="text"]:focus{
  border-color: color-mix(in srgb, var(--accent) 55%, var(--border-soft));
  box-shadow: var(--focusRing);
}

/* Unified media menu (pop-up above composer) */
#mediaBtn{
  width:44px;
  height:44px;
  border-radius:14px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:26px;
  line-height:1;
}
#mediaBtn.diceShaking{
  animation: diceShake 320ms ease-in-out;
}
.diceVariantWrap{
  display:none;
  position:relative;
}
body.dice-room .diceVariantWrap{
  display:inline-flex;
}
.diceInfoBtn{
  width:44px;
  height:44px;
  border-radius:14px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  opacity:0.9;
 }
.diceInfoBtn:hover{ opacity:1; }
.dicePayoutPopover{
  position:absolute;
  left:0;
  bottom: calc(100% + 10px);
  width: min(320px, 88vw);
  padding:12px;
  border-radius:16px;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--panel) 88%, transparent);
  box-shadow: var(--shadowMd);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  z-index: 215;
 }
.dicePayoutPopover[hidden]{ display:none; }
.dicePayoutPopover h4{
  margin:0 0 8px;
  font-size:13px;
  font-weight:900;
 }
.dicePayoutPopover ul{ margin:0; padding-left:18px; }
.dicePayoutPopover li{ margin:4px 0; font-size:12px; color:var(--muted); }
.dicePayoutPopover .payoutNote{ font-size:12px; color:var(--text); opacity:0.9; margin-top:8px; }
.diceVariantToggle{
  height:44px;
  border-radius:14px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  padding:0 12px;
  font-size:12px;
  font-weight:800;
  line-height:1;
}
.diceVariantChevron{
  font-size:11px;
  opacity:0.7;
}
.diceVariantMenu{
  position:absolute;
  left:0;
  bottom: calc(100% + 10px);
  display:flex;
  flex-direction:column;
  gap:6px;
  padding:10px;
  border-radius:14px;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--panel) 85%, transparent);
  box-shadow: var(--shadowMd);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: 210;
  min-width:96px;
}
.diceVariantMenu[hidden]{ display:none; }
.diceVariantOption{
  border:0;
  background: color-mix(in srgb, var(--panel2) 70%, transparent);
  color: var(--text);
  padding:8px 10px;
  border-radius:12px;
  font-size:13px;
  font-weight:700;
  cursor:pointer;
  text-align:left;
}
.diceVariantOption.active{
  background: color-mix(in srgb, var(--accent) 22%, var(--panel2));
  color: var(--textStrong, var(--text));
}
.mediaMenu{
  position:absolute;
  left:12px;
  bottom: calc(100% + 10px);
  display:flex;
  gap:10px;
  padding:10px 12px;
  border-radius:18px;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--panel) 85%, transparent);
  box-shadow: var(--shadowMd);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: 200;
}
.mediaMenu[hidden]{ display:none; }
.mediaMenuItem{
  border:0;
  background: color-mix(in srgb, var(--panel2) 70%, transparent);
  color: var(--text);
  padding:10px 12px;
  border-radius:16px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
  min-width:74px;
  cursor:pointer;
  box-shadow: var(--shadowSm);
}
.mediaMenuItem:active{ transform: translateY(1px); }
.mediaIcon{ font-size:22px; line-height:1; }
.mediaLabel{ font-weight:800; font-size:12px; letter-spacing:.2px; }
.mediaMenuItem.recording{
  outline:2px solid color-mix(in srgb, var(--accent) 70%, transparent);
  box-shadow: 0 0 0 4px color-mix(in srgb, var(--accent) 18%, transparent), var(--shadowSm);
}
.inputBar #sendBtn,
.dmInput #dmSendBtn{
  order:4;
  border-top-right-radius:0;
  border-bottom-right-radius:0;
}
.inputBar .tonePicker,
.dmInput .tonePicker{
  order:5;
  margin-left:-10px;
}
.tonePicker{
  position:relative;
  display:flex;
  align-items:center;
  flex-shrink:0;
}
.toneMenuBtn{
  border:0;
  background:var(--btnPrimaryBg);
  color:var(--btnPrimaryText);
  cursor:pointer;
  font-size:14px;
  font-weight:800;
  line-height:1;
  padding:0 10px;
  border-radius:0 var(--radiusMd) var(--radiusMd) 0;
  min-height:38px;
  min-width:36px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  border-left:1px solid color-mix(in srgb, var(--btnPrimaryText) 25%, transparent);
}
.tonePicker.is-open .toneMenuBtn{
  box-shadow:0 0 0 2px color-mix(in srgb, var(--accent) 35%, transparent);
}
.tonePicker.has-tone .toneMenuBtn{
  box-shadow:0 0 0 1px color-mix(in srgb, var(--accent) 55%, transparent);
}
.toneMenuPanel{
  position:absolute;
  right:0;
  bottom:calc(100% + 8px);
  min-width:220px;
  max-width:min(280px, 90vw);
  padding:8px;
  border-radius:14px;
  border:1px solid var(--border);
  background:var(--panel);
  box-shadow:var(--shadowLg);
  display:flex;
  flex-direction:column;
  gap:6px;
  opacity:0;
  transform:translateY(6px);
  pointer-events:none;
  z-index:180;
  transition:opacity .15s ease, transform .15s ease;
}
.tonePicker.is-open .toneMenuPanel{
  opacity:1;
  transform:translateY(0);
  pointer-events:auto;
}
.toneMenuItem{
  border:1px solid transparent;
  background:transparent;
  color:var(--text);
  cursor:pointer;
  border-radius:12px;
  padding:8px 10px;
  display:flex;
  align-items:flex-start;
  gap:8px;
  text-align:left;
  font-size:13px;
}
.toneMenuItem:hover{
  background:color-mix(in srgb, var(--panel2) 90%, transparent);
  border-color:var(--border);
}
.toneMenuItem.is-active{
  background:color-mix(in srgb, var(--accent) 18%, transparent);
  border-color:color-mix(in srgb, var(--accent) 50%, transparent);
}
.toneMenuEmoji{
  font-size:16px;
  line-height:1.2;
}
.toneMenuText{
  display:flex;
  flex-direction:column;
  gap:2px;
}
.toneMenuName{
  font-weight:800;
}
.toneMenuDesc{
  font-size:11px;
  color:var(--muted);
}
@media (prefers-reduced-motion: reduce){
  .toneMenuPanel{
    transition:none;
  }
}
body:not(.polish-pack) .tonePicker{
  display:none;
}
#fileInput{
  position:absolute;
  left:-9999px;
  width:1px; height:1px;
  opacity:0;
}
#audioFileInput{
  position:absolute;
  left:-9999px;
  width:1px; height:1px;
  opacity:0;
}

.replyPreview{ display:none; align-items:center; gap:10px; padding:8px 12px; margin:8px 12px; background:color-mix(in srgb, var(--panel) 80%, transparent); border:1px solid var(--border); border-radius:var(--radiusLg); }
.replyPreview.show{ display:flex; }
.replyText{ flex:1; font-size:13px; color:var(--muted); overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.replyContext{ width:100%; text-align:left; border:1px solid var(--border); background:color-mix(in srgb, var(--panel) 85%, transparent); color:var(--text); border-radius:var(--radiusMd); padding:6px 8px; margin-bottom:6px; }
.replyContext .replyUser{ font-weight:700; color:var(--muted); }
.replyContext .replySnippet{ font-size:13px; color:var(--text); overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.dmReplyContext{ width:100%; text-align:left; border:1px solid var(--border); background:color-mix(in srgb, var(--panel2) 90%, transparent); color:var(--text); border-radius:var(--radiusMd); padding:6px 8px; margin-bottom:6px; }
.mentionDropdown{ position:absolute; right:12px; bottom:58px; background:var(--panel); border:1px solid var(--border); border-radius:var(--radiusMd); box-shadow:var(--shadowLg); padding:6px; display:none; flex-direction:column; gap:4px; z-index:30; min-width:180px; }
.mentionDropdown.show{ display:flex; }
.mentionDropdown button{ width:100%; text-align:left; padding:8px 10px; border-radius:var(--radiusSm); border:1px solid transparent; background:transparent; color:var(--text); }
.mentionDropdown button:hover{ border-color:var(--borderStrong); background:color-mix(in srgb, var(--panel2) 80%, transparent); }

/* Upload preview */
.uploadPreview{
  margin: 8px 12px;
  padding: 10px 12px;
  border: 1px solid var(--border);
  border-radius: var(--radiusLg);
  background: color-mix(in srgb, var(--panel) 85%, transparent);
  display:none;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
.uploadLeft{ display:flex; align-items:center; gap:12px; min-width:0; }
.previewThumb{
  width:54px; height:54px;
  border-radius:var(--radiusMd); overflow:hidden;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--panel) 70%, transparent);
  display:flex; align-items:center; justify-content:center;
  flex:0 0 auto;
}
.previewThumb img, .previewThumb video{ width:100%; height:100%; object-fit:cover; display:block; }
.uploadMeta{ display:flex; flex-direction:column; gap:2px; min-width:0; }
.uploadName{ font-weight:900; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:46vw; }
.uploadInfo{ opacity:.8; font-size:12px; }
.uploadRight{ display:flex; align-items:center; gap:10px; min-width:220px; }
.progressWrap{
  flex:1; height:10px; border-radius:999px;
  background: color-mix(in srgb, var(--panel) 80%, transparent);
  overflow:hidden;
  border:1px solid var(--border);
}
.progressBar{ height:100%; width:0%; border-radius:999px; background: var(--accent2); transition: width .08s linear; }
.progressShell{ margin-top:8px; height:10px; border-radius:999px; background: color-mix(in srgb, var(--panel) 80%, transparent); border:1px solid var(--border); overflow:hidden; }
.progressFill{ height:100%; width:0%; background:linear-gradient(90deg, var(--accent), var(--accent2)); transition: width .25s ease; }

/* Members */
.members{
  width:300px;
  background:color-mix(in srgb, var(--panel2) 72%, var(--panel-scrim));
  border-left:1px solid var(--border-soft);
  padding:10px;
  overflow:auto;
  position:relative;
  backdrop-filter: blur(var(--glass-blur));
  -webkit-backdrop-filter: blur(var(--glass-blur));
}
.members h3{
  margin:6px 6px 10px;
  font-size:12px;
  color:var(--muted);
  letter-spacing:.06em;
  text-transform:uppercase;
  font-weight:600;
  text-shadow:var(--text-shadow-strong);
}
.memberGold{ margin:0 6px 10px; padding:6px 10px; border-radius:var(--radiusMd); background:color-mix(in srgb, var(--panel) 80%, transparent); border:1px solid var(--border); font-weight:900; display:none; }
.memberGold.show{ display:block; }

.memberPills{ display:flex; gap:8px; margin:0 6px 10px; }
.memberPills .pill{
  flex:1;
  padding:8px 10px;
  border-radius:999px;
  border:1px solid var(--border-soft);
  background:color-mix(in srgb, var(--panel) 82%, var(--panel-scrim));
  color:var(--text);
  font-weight:900;
  cursor:pointer;
  text-shadow:var(--text-shadow-soft);
}
.memberPills .pill.active{ background:var(--accent); color:#000; border-color:color-mix(in srgb, var(--accent) 65%, var(--border)); }

.commandPopup{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:8px;margin:8px 6px 0;display:none;max-height:260px;overflow:auto;box-shadow:var(--shadow);}
.commandPopup.show{display:block;}
.commandPopupHeader{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:6px;}
.commandPopupTitle{font-weight:900;font-size:14px;}
.commandPopupBody{font-size:13px;line-height:1.4;white-space:pre-wrap;}
.commandHelpList{display:flex;flex-direction:column;gap:6px;}
.commandHelpItem{border:1px solid var(--line);padding:6px;border-radius:8px;background:var(--panel2);}
.commandHelpItem .name{font-weight:800;}
.commandHelpItem .usage{font-family:monospace;font-size:12px;}
.mItem{
  padding:8px 8px;
  border-radius:var(--radiusLg);
  display:flex;
  align-items:center;
  gap:10px;
  cursor:pointer;
  border:1px solid transparent;
}
.mItem:hover{ background:color-mix(in srgb, var(--panel) 80%, transparent); border-color: var(--border); }
.mAvatar{ width:30px; height:30px; border-radius:50%; background:var(--avatar-bg); overflow:hidden; flex:0 0 auto; border:1px solid var(--border); }
.mAvatar img{ width:100%; height:100%; object-fit:cover; display:block; }
.dot{ width:10px; height:10px; border-radius:50%; flex:0 0 auto; background:var(--gray); }
.mMeta{ display:flex; flex-direction:column; gap:2px; min-width:0; }
.mName{ font-weight:900; font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.mName{ text-shadow:var(--text-shadow-soft); }
.mSub{
  font-size:11px;
  color:var(--muted);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  font-weight:500;
  text-shadow:var(--text-shadow-soft);
}
.mRoll{ font-size:11px; color:var(--accent); font-weight:800; text-shadow:var(--text-shadow-soft); }

.memberMenu{
  position:fixed;
  top:0;
  left:0;
  background: color-mix(in srgb, var(--panel2) 92%, transparent);
  border:1px solid var(--border);
  box-shadow: var(--shadowMd);
  border-radius:var(--radiusLg);
  padding:12px;
  display:none;
  flex-direction:column;
  gap:8px;
  z-index: 500;
  min-width: 230px;
  max-width: min(320px, calc(100vw - 24px - var(--safeL) - var(--safeR)));
}
.memberMenu.open{ display:flex; }
.memberMenuHeader{ display:flex; flex-direction:column; gap:4px; }
.memberMenuName{ font-weight:900; }
.memberMenuActions{ display:flex; gap:8px; flex-wrap:wrap; }
.memberMenuActions .btn{ flex:1; }
.memberMenuSection{
  width:100%;
  display:flex;
  flex-direction:column;
  gap:6px;
  border-top:1px solid var(--border);
  padding-top:8px;
  margin-top:4px;
}
.memberMenuSectionTitle{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:0.06em;
  color:var(--muted);
  font-weight:700;
}
.memberMenuSectionActions{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}
.memberMenuSectionActions .btn{ flex:1; }

@media (max-width: 640px){
  .memberMenu.sheet{
    left:12px !important;
    right:12px !important;
    top:auto !important;
    bottom:calc(12px + env(safe-area-inset-bottom));
    max-width:calc(100vw - 24px);
  }
}

/* Modal/Profile */
#modal{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  display: none;
  align-items: flex-start;
  justify-content: center;
  opacity: 0;
  transition: opacity 120ms ease;
  /* Prevent double-scroll containers on iOS. The inner modalBody should scroll. */
  overflow: hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  padding: 18px;
  z-index: 900;
  pointer-events: none;
}
#modal.modal-visible{
  opacity: 1;
  pointer-events: auto;
}
.modal{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  display: none;
  align-items: flex-start;
  justify-content: center;
  opacity: 0;
  transition: opacity 120ms ease;
  overflow: hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  padding: calc(18px + env(safe-area-inset-top)) calc(18px + env(safe-area-inset-right)) calc(18px + env(safe-area-inset-bottom)) calc(18px + env(safe-area-inset-left));
  z-index: 920;
}
.modal.modal-visible{ opacity: 1; }

#couplesModal{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  display: none;
  align-items: flex-start;
  justify-content: center;
  opacity: 0;
  transition: opacity 120ms ease;
  overflow: hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  padding: 18px;
  z-index: 910; /* above main modal */
}
#couplesModal.modal-visible{ opacity: 1; }
.roomModal{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  display: none;
  align-items: flex-start;
  justify-content: center;
  opacity: 0;
  transition: opacity 120ms ease;
  overflow: hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  padding: 18px;
  z-index: 930;
}
.roomModal.modal-visible{ opacity: 1; }
.roomModalCard{
  width: min(840px, calc(100vw - 36px));
}
.roomModalBody{
  padding: 0 12px 16px;
}
.modalCard{
  position: relative;
  display: flex;
  flex-direction: column;
  /* Robust viewport cap: vvH (set in JS) with a dvh fallback for iOS */
  max-height: calc(var(--vvhPx, 100dvh) - 36px);
  overflow: hidden;
  background: var(--panel);
  border-radius: 14px;
  margin-top: 10px;
}
#modal .modalCard{
  transform: scale(0.98);
  opacity: 0;
  transition: transform 180ms cubic-bezier(.22,.61,.36,1), opacity 180ms cubic-bezier(.22,.61,.36,1);
}
#modal.modal-visible .modalCard{
  transform: scale(1);
  opacity: 1;
  transition-delay: 90ms;
}
.modalBody{
  flex: 1;
  min-height: 0;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  /* iOS: ensure the scroll container is actually allowed to pan */
  touch-action: pan-y;
}
#modal .modalBody{
  opacity: 0;
  transform: translateY(4px);
  transition: transform 160ms cubic-bezier(.22,.61,.36,1), opacity 160ms cubic-bezier(.22,.61,.36,1);
}
#modal.modal-visible .modalBody{
  opacity: 1;
  transform: translateY(0);
  transition-delay: 150ms;
}

/* Wider, cleaner modal on desktop */
@media (min-width: 761px){
  #modal{ align-items: center; }
  .modalCard{
    width: min(980px, calc(100vw - 48px));
    margin-top: 0;
  }
  .modalBody{
    padding: 0 18px 18px;
  }
  .profileModalCard .modalBody{
    padding: 0 18px 18px;
  }
  .profileSticky{
    margin: 0 -18px;
    padding-left: 18px;
    padding-right: 18px;
  }
  .profileSheetHero{
    margin-top: 0;
  }
  .profileSheetName{ font-size: 20px; }
  .tabs{ gap: 8px; }
}
.modalTop{ display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:10px;flex-shrink: 0; }
.modalTop strong{ font-size:14px; }
.profileModalTop{
  margin-bottom: 0;
  padding: 0;
}
.profileModalCard .modalBody{
  padding: 0 12px 12px;
}

/* Edit Profile Modal */
#editProfileModal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 0;
  transition: opacity 180ms ease;
}
#editProfileModal:not([hidden]) {
  opacity: 1;
}
#editProfileModal.modal-closing {
  opacity: 0;
}
.profileEditModalCard {
  background: var(--panel);
  border-radius: 14px;
  max-width: 900px;
  width: 90%;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  box-shadow: 0 0 20px 2px var(--accent, #6c5ce7);
}
.editProfileModalBody {
  overflow-y: auto;
  padding: 16px;
}
.editProfileLayout {
  display: grid;
  grid-template-columns: 300px 1fr;
  gap: 20px;
}
.editProfilePreview {
  position: sticky;
  top: 0;
  height: fit-content;
}
.profilePreviewCard {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
}
.profilePreviewHeader {
  padding: 20px;
  background: linear-gradient(135deg, #ff6a2b, #2b0f08);
  color: #fdfdfd;
  text-align: center;
}
.profilePreviewAvatar {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: var(--accent);
  background-size: cover;
  background-position: center;
  margin: 0 auto 12px;
  border: 3px solid rgba(255, 255, 255, 0.3);
}
.profilePreviewName {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 4px;
}
.profilePreviewMood {
  font-size: 13px;
  opacity: 0.9;
  font-style: italic;
}
.profilePreviewBio {
  padding: 14px;
  font-size: 13px;
  border-top: 1px solid var(--border);
  min-height: 60px;
}
.profilePreviewVibes {
  padding: 0 14px 14px;
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
.vibeTag {
  background: var(--accent);
  color: var(--accentText);
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 600;
}
.editProfileFields {
  display: flex;
  flex-direction: column;
  gap: 14px;
}
@media (max-width: 768px) {
  .editProfileLayout {
    grid-template-columns: 1fr;
  }
  .editProfilePreview {
    position: relative;
  }
  .profileEditModalCard {
    width: 95%;
    max-height: 95vh;
  }
}

.profileSections{
  display:flex;
  flex-direction:column;
  gap:12px;
}
.profileSection{
  border:1px solid var(--border);
  border-radius:12px;
  background: var(--panel);
  overflow:hidden;
}
.profileSection summary{
  list-style:none;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding: 12px 14px;
  font-weight: 700;
  cursor:pointer;
  min-height: 44px;
}
.profileSection summary::-webkit-details-marker{ display:none; }
.profileSection summary::after{
  content:"▾";
  font-size: 12px;
  opacity: 0.7;
  transition: transform 140ms ease;
}
.profileSection[open] summary::after{
  transform: rotate(180deg);
}
.profileSectionBody{
  padding: 12px 14px 14px;
  border-top: 1px solid var(--border);
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* Hide spectator-only elements when viewing your own profile in non-edit mode */
.profileSpectatorOnly {
  /* Will be hidden/shown via JS based on isSelf state */
}

.notificationsModal{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 18px;
  z-index: 400;
}
.notificationsCard{
  width: min(640px, calc(100vw - 36px));
}
.notificationsActions{ display:flex; justify-content:flex-end; margin-bottom:10px; }
.notificationsList{ display:flex; flex-direction:column; gap:12px; }
.notificationsGroup{ display:flex; flex-direction:column; gap:8px; }

/* Themes modal v2 */
.themeLaunchRow{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  padding:12px;
  border-radius:14px;
  background:var(--panel);
  border:1px solid var(--line);
}
.textStyleLaunch{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
  padding:12px;
  border-radius:14px;
  background:var(--panel);
  border:1px solid var(--line);
}
.textStyleLaunchActions{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  justify-content:flex-end;
}
.textStyleLaunchMeta{
  display:flex;
  flex-direction:column;
  gap:4px;
}
.textStyleLaunchLabel{
  font-size:12px;
  color:var(--muted);
}
.textStyleLaunchValue{
  font-size:14px;
  font-weight:600;
  color:var(--text);
}
.themeLaunchMeta{
  display:flex;
  flex-direction:column;
  gap:4px;
}
.themeLaunchLabel{
  font-size:12px;
  color:var(--muted);
}
.themeLaunchValue{
  font-size:14px;
  font-weight:600;
  color:var(--text);
}
.themesModal{
  position:fixed;
  inset:0;
  background:var(--overlay-scrim);
  display:none;
  align-items:stretch;
  justify-content:center;
  z-index:960;
  padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
}
.themesModal.show{ display:flex; }
.themesModalCard{
  width:min(1100px, 100%);
  max-height:calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
  background:var(--panel2);
  border:1px solid var(--line);
  border-radius:20px;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  box-shadow:var(--shadowLg);
}
.textCustomizationModal{
  position:fixed;
  inset:0;
  background:var(--overlay-scrim);
  display:none;
  align-items:stretch;
  justify-content:center;
  z-index:980;
  padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
}
.textCustomizationModal.show{ display:flex; }
.textCustomizationCard{
  width:min(960px, 100%);
  max-height:calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
  background:var(--panel2);
  border:1px solid var(--line);
  border-radius:20px;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  box-shadow:var(--shadowLg);
}
.textCustomizationHeader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  padding:16px;
  background:var(--panel2);
  border-bottom:1px solid var(--line);
}
.textCustomizationTitle{
  font-size:16px;
  font-weight:700;
}
.textCustomizationBody{
  padding:16px;
  display:flex;
  flex:1;
  min-height:0;
  overflow:hidden;
}
.textCustomizationLayout{
  display:grid;
  grid-template-columns: minmax(260px, 0.42fr) minmax(320px, 1fr);
  gap:16px;
  min-height:0;
  width:100%;
}
.textCustomizationLeft{
  display:flex;
  flex-direction:column;
  gap:16px;
  min-height:0;
}
.textCustomizationRight{
  min-height:0;
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
  padding-right:4px;
}
.textCustomizationFooter{
  display:flex;
  justify-content:flex-end;
  gap:12px;
  padding:14px 16px calc(14px + env(safe-area-inset-bottom));
  border-top:1px solid var(--line);
  background:var(--panel2);
}
.textCustomizationPreview{
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:14px;
  border-radius:14px;
  border:1px solid var(--line);
  background:linear-gradient(180deg, rgba(255,255,255,0.08), rgba(0,0,0,0.12));
}
.textCustomizationPreviewGrid{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap:12px;
}
.textCustomizationPreviewPanel{
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid color-mix(in srgb, var(--line) 70%, transparent);
  background:var(--panel);
}
.textCustomizationPreviewPanel.isHeader{
  background:linear-gradient(90deg, rgba(255,255,255,0.12), rgba(0,0,0,0.2));
}
.textCustomizationPreviewPanel.isChat{
  background:var(--chatBg, var(--bg));
}
.textCustomizationPreviewPanelLabel{
  font-size:11px;
  color:var(--muted);
  text-transform:uppercase;
  letter-spacing:0.08em;
}
.textCustomizationPreviewLabel{
  font-size:12px;
  color:var(--muted);
  text-transform:uppercase;
  letter-spacing:0.08em;
}
.textCustomizationPreviewText{
  font-size:22px;
  font-weight:700;
  line-height:1.2;
  color:var(--text);
  word-break:break-word;
}
.textCustomizationPreviewText--message{
  font-size:15px;
  font-weight:600;
  line-height:1.35;
}
.textCustomizationCard[data-target="username"] .textCustomizationPreview--message{
  display:none;
}
.textCustomizationCard[data-target="messageText"] .textCustomizationPreview--username{
  display:none;
}
.textCustomizationTabs{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}
.textCustomizationTabs button{
  border:1px solid var(--line);
  background:var(--panel);
  color:var(--text);
  border-radius:999px;
  padding:6px 14px;
  font-weight:600;
}
.textCustomizationTabs button.active{
  border-color:var(--accent);
  box-shadow:0 0 0 2px color-mix(in srgb, var(--accent) 40%, transparent);
}
.textCustomizationPanel{
  display:none;
  flex-direction:column;
  gap:12px;
}
.textCustomizationPanel.active{
  display:flex;
}
.textCustomizationGridGroup{
  display:flex;
  flex-direction:column;
  gap:8px;
}
.textCustomizationGroupLabel{
  font-size:12px;
  color:var(--muted);
  text-transform:uppercase;
  letter-spacing:0.08em;
}
.textCustomizationGrid{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(54px, 1fr));
  gap:12px;
}
.textCustomizationSwatch{
  width:100%;
  aspect-ratio:1;
  border-radius:12px;
  border:1px solid var(--line);
  background:var(--swatch-color, #fff);
  cursor:pointer;
  position:relative;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,0.08);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
}
.textCustomizationSwatchLabel{
  font-size:12px;
  color:color-mix(in srgb, var(--text) 75%, transparent);
  text-shadow:0 1px 2px rgba(0,0,0,0.35);
}
.textCustomizationSwatch--gradient .textCustomizationSwatchLabel{
  background-image:var(--swatch-color, linear-gradient(135deg, #7c4dff, #00e5ff));
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
  text-shadow:0 1px 2px rgba(0,0,0,0.25);
}
.textCustomizationSwatch.selected{
  outline:2px solid var(--accent);
  outline-offset:2px;
}
.textCustomizationControls{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));
  gap:12px;
}
.textCustomizationField label{
  display:block;
  font-size:12px;
  color:var(--muted);
  margin-bottom:6px;
}
.textStyleGradient{
  background-clip:text;
  -webkit-background-clip:text;
  background-size:200% 200%;
  background-position:0% 50%;
  color:transparent;
  -webkit-text-fill-color:transparent;
  text-shadow:var(--text-gradient-shadow, 0 1px 2px rgba(0,0,0,0.4));
  -webkit-text-stroke:var(--text-gradient-stroke, 0px) var(--text-gradient-stroke-color, transparent);
}
@media (max-width: 820px){
  .textCustomizationLayout{
    display:flex;
    flex-direction:column;
  }
  .textCustomizationLeft{
    display:contents;
  }
  .textCustomizationPreview{
    order:0;
  }
  .textCustomizationTabs{
    order:1;
  }
  .textCustomizationRight{
    order:2;
    max-height:280px;
  }
  .textCustomizationControls{
    order:3;
  }
}
.themesModalSticky{
  position:sticky;
  top:0;
  z-index:4;
  background:var(--panel2);
  padding:16px;
  padding-top:calc(16px + env(safe-area-inset-top));
  border-bottom:1px solid var(--line);
  display:flex;
  flex-direction:column;
  gap:12px;
}
.themesModalHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
.themesModalTitle{
  font-size:18px;
  font-weight:700;
}
.themesModalSearchRow{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.themesModalSearchRow input[type="search"]{
  flex:1 1 200px;
  min-width:160px;
  background:var(--inputBg);
  color:var(--inputText);
  border:1px solid var(--line);
  border-radius:12px;
  padding:10px 12px;
}
.themesModalSearchRow select{
  background:var(--inputBg);
  color:var(--inputText);
  border:1px solid var(--line);
  border-radius:12px;
  padding:10px 12px;
}
.themesModalFilters{
  display:flex;
  gap:8px;
  flex-wrap:nowrap;
  overflow:auto;
  padding-bottom:4px;
}
.themesModalBody{
  flex:1;
  overflow:auto;
  display:grid;
  grid-template-columns:minmax(0, 1fr) minmax(280px, 320px);
  gap:16px;
  padding:16px;
}
.themesListPane{
  display:flex;
  flex-direction:column;
  gap:18px;
}
.themesSectionHeader{
  font-size:13px;
  font-weight:700;
  color:var(--muted);
  text-transform:uppercase;
  letter-spacing:0.08em;
  margin-bottom:8px;
}
.themesGrid{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(180px, 1fr));
  gap:12px;
}
.themeCardV2{
  position:relative;
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:12px;
  border-radius:14px;
  border:1px solid var(--line);
  background:var(--panel);
  color:var(--text);
  text-align:left;
  transition:transform 0.15s ease, border-color 0.15s ease;
}
.themeCardV2:hover{
  transform:translateY(-1px);
  border-color:rgba(127,132,146,0.45);
}
.themeCardV2.selected{
  border-color:var(--accent);
  box-shadow:0 0 0 1px rgba(88,101,242,0.35);
}
.themeCardTop{
  display:flex;
  justify-content:space-between;
  gap:8px;
  align-items:flex-start;
}
.themeCardName{
  font-size:14px;
  font-weight:600;
}
.themeCardActions{
  display:flex;
  gap:6px;
}
.themeCardAction{
  border:none;
  background:transparent;
  color:var(--muted);
  font-size:14px;
  cursor:pointer;
}
.themeCardAction.active{ color:var(--accent); }
.themeCardBadges{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.themeBadge{
  font-size:11px;
  padding:2px 8px;
  border-radius:999px;
  border:1px solid var(--line);
  background:rgba(0,0,0,0.15);
  color:var(--muted);
}
.themeBadge.vip{
  background:rgba(88,101,242,0.15);
  color:var(--accent2);
  border-color:rgba(88,101,242,0.45);
}
.themeBadge.gold{
  background:rgba(240,177,50,0.15);
  color:var(--warning);
  border-color:rgba(240,177,50,0.5);
}
.themeBadge.owned{
  background:rgba(35,165,90,0.15);
  color:var(--success);
  border-color:rgba(35,165,90,0.5);
}
.themeBadge.locked{
  background:rgba(237,66,69,0.12);
  color:var(--danger);
  border-color:rgba(237,66,69,0.45);
}
.themesEmpty{
  display:none;
  padding:16px;
  border:1px dashed var(--line);
  border-radius:12px;
  color:var(--muted);
  text-align:center;
}
.themesEmpty.show{ display:block; }
.themesPreviewPane{
  position:sticky;
  top:90px;
  align-self:start;
}
.themesPreviewCard{
  background:var(--panel);
  border:1px solid var(--line);
  border-radius:16px;
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.themesPreviewHeader{
  display:flex;
  flex-direction:column;
  gap:4px;
}
.themesPreviewTitle{
  font-size:13px;
  color:var(--muted);
  text-transform:uppercase;
  letter-spacing:0.08em;
}
.themesPreviewName{
  font-size:16px;
  font-weight:600;
}
.themesPreviewFrame{
  border-radius:14px;
  overflow:hidden;
  border:1px solid var(--line);
  background:var(--bg);
  color:var(--text);
  display:flex;
  flex-direction:column;
  min-height:220px;
}
.themesPreviewTopbar{
  padding:10px 12px;
  background:var(--panel);
  border-bottom:1px solid var(--line);
  font-weight:600;
  font-size:13px;
}
.themesPreviewChat{
  flex:1;
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.themesPreviewMsg{
  display:flex;
  gap:8px;
  align-items:flex-start;
}
.themesPreviewMsg.self{ flex-direction:row-reverse; }
.themesPreviewAvatar{
  width:24px;
  height:24px;
  border-radius:50%;
  background:var(--accent2);
  flex:0 0 auto;
}
.themesPreviewBubble{
  background:var(--messageOtherBg);
  color:var(--messageOtherText);
  padding:8px 10px;
  border-radius:12px;
  font-size:12px;
  max-width:70%;
}
.themesPreviewMsg.self .themesPreviewBubble{
  background:var(--messageSelfBg);
  color:var(--messageSelfText);
}
.themesPreviewComposer{
  padding:10px;
  display:flex;
  gap:8px;
  background:var(--panel);
  border-top:1px solid var(--line);
  align-items:center;
}
.themesPreviewInput{
  flex:1;
  background:var(--inputBg);
  color:var(--inputPlaceholder);
  padding:6px 10px;
  border-radius:10px;
  font-size:12px;
}
.themesPreviewSend{
  background:var(--btnPrimaryBg);
  color:var(--btnPrimaryText);
  border:none;
  padding:6px 10px;
  border-radius:10px;
  font-size:12px;
}
.themesPreviewActions{
  display:flex;
  flex-direction:column;
  gap:8px;
}
.themesPreviewHint{
  font-size:12px;
}
.themesFiltersSheet,
.themesActionSheet{
  position:fixed;
  inset:0;
  display:none;
  align-items:flex-end;
  background:rgba(0,0,0,0.4);
  z-index:970;
}
.themesFiltersSheet.show,
.themesActionSheet.show{ display:flex; }
.themesFiltersSheetCard,
.themesActionSheetCard{
  width:100%;
  background:var(--panel2);
  border-top-left-radius:18px;
  border-top-right-radius:18px;
  border:1px solid var(--line);
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.themesFiltersSheetHeader,
.themesActionSheetTitle{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:700;
}
.themesFiltersSheetBody{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}
.themesActionSheetCard .btn{
  justify-content:center;
}
@media (max-width: 900px){
  .themesModalCard{
    border-radius:0;
    max-height:100%;
  }
  .themesModalBody{
    grid-template-columns:1fr;
  }
  .themesPreviewPane{
    position:static;
  }
}
@media (max-width: 600px){
  .themesModalFilters{
    display:none;
  }
}
.notificationsGroupTitle{
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: .08em;
  color: var(--muted);
  margin-bottom: 6px;
}
.notificationsRow{
  display: grid;
  grid-template-columns: 24px 1fr auto;
  gap: 10px;
  align-items: center;
  padding: 10px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--panel2);
  color: var(--text);
  text-align: left;
  cursor: pointer;
  transition: transform .12s ease, background .12s ease;
}
.notificationsRow:active{ transform: scale(0.98); }

.notificationsRow.friendReq{ grid-template-columns: 44px 1fr auto; cursor: default; }
.notifAvatarBtn{ width:44px; height:44px; border-radius:50%; border:1px solid var(--border); background:color-mix(in srgb, var(--panel) 80%, transparent); display:flex; align-items:center; justify-content:center; padding:0; overflow:hidden; cursor:pointer; }
.notifBody{ display:flex; flex-direction:column; gap:2px; }
.notifActions{ display:flex; gap:8px; align-items:center; }
.btn.small{ padding:6px 10px; font-size:12px; border-radius:10px; }
.notificationsRow.friendReq.handled{ opacity:0.75; }

.notificationsIcon{ font-size: 16px; }
.notificationsText{ font-size: 13px; }
.notificationsTime{ font-size: 11px; color: var(--muted); white-space: nowrap; }
.modalContent{ flex:1 1 auto; overflow:auto; -webkit-overflow-scrolling: touch; padding-right:2px; min-height:0; }
.tabs{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin:10px 0 12px;
  overflow-x:visible;
  -webkit-overflow-scrolling:touch;
  scrollbar-width:none;
}
.tabs::-webkit-scrollbar{ display:none; }
.tab{
  padding:10px;
  border-radius:12px;
  background:color-mix(in srgb, var(--panel) 85%, transparent);
  border:1px solid var(--border);
  cursor:pointer;
  font-weight:900;
  font-size:12px;
  color:var(--text);
  user-select:none;
  flex:1 1 120px;
  text-align:center;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;
}
.tab.active{ background:var(--panel); border-color:var(--border); box-shadow: var(--shadowSm); }
.tab .tabIcon{ font-size:18px; line-height:1; }
.tab .tabLabel{ white-space:nowrap; }

.modalGrid{ display:grid; grid-template-columns: 170px 1fr; gap:12px; }
.pAvatar{ width:160px; height:160px; border-radius:18px; background:var(--avatar-bg); overflow:hidden; border:1px solid var(--border); }
.pAvatar img{ width:100%; height:100%; object-fit:cover; display:block; }
.avatarImg{ width:100%; height:100%; object-fit:cover; display:block; }
.avatarFallback{
  width:100%;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:900;
  background:var(--avatar-bg);
  text-transform:uppercase;
}

/* Role-based fallback avatars (used when a user has no avatar or it fails to load) */
.avatarFallback{
  color:#fff;
  letter-spacing:0.5px;
}

.avatarFallback.role-owner{
  background: radial-gradient(circle at 30% 30%, #7CFF4A 0%, #0B4D1E 78%);
}
.avatarFallback.role-coowner{
  background: radial-gradient(circle at 30% 30%, #8A2BE2 0%, #FF4FA3 78%);
}
.avatarFallback.role-admin{
  /* gold outside, orange inside */
  background: radial-gradient(circle at 30% 30%, #FF8C00 0%, #FFD700 78%);
}
.avatarFallback.role-moderator{
  /* darker red inside */
  background: radial-gradient(circle at 30% 30%, #7A0000 0%, #E02020 78%);
}
.avatarFallback.role-vip{
  background: #7FD3FF; /* light blue “diamond” */
  color:#0B2B3A;
}
.avatarFallback.vipDiamond{
  clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
}

/* Avatar frames (show the same role gradients even when an image avatar exists) */
.avatarFrame{
  width:100%;
  height:100%;
  border-radius:999px;
  padding:2px;
  box-sizing:border-box;
  display:flex;
  align-items:center;
  justify-content:center;
}
.avatarInner{
  width:100%;
  height:100%;
  border-radius:999px;
  overflow:hidden;
  background: var(--avatar-bg);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:900;
  color:#fff;
  text-transform:uppercase;
}
.avatarInner.hasImg{ background-size:cover; background-position:center; color:transparent; }

.avatarFrame.role-owner{ background: radial-gradient(circle at 30% 30%, #7CFF4A 0%, #0B4D1E 78%); }
.avatarFrame.role-coowner{ background: radial-gradient(circle at 30% 30%, #8A2BE2 0%, #FF4FA3 78%); }
.avatarFrame.role-admin{ background: radial-gradient(circle at 30% 30%, #FF8C00 0%, #FFD700 78%); }
.avatarFrame.role-moderator{ background: radial-gradient(circle at 30% 30%, #7A0000 0%, #E02020 78%); }
.avatarFrame.role-vip{ background: #7FD3FF; }
.avatarFrame.role-vip .avatarInner{ color:#0B2B3A; background: rgba(255,255,255,0.65); }

.small{ font-size:12px; color:var(--muted); }
.sectionTitle{ font-weight:900; margin:10px 0 6px; }
.panelBox{ background:var(--panel2); border:1px solid var(--border); border-radius:14px; padding:10px; }
.panelBox .badge{ background:var(--accent); color:var(--btnPrimaryText); }
.panelBox .small{ color:var(--muted); }
.prefsSections{
  display:flex;
  flex-direction:column;
  gap:12px;
  margin-top:6px;
}
.prefsSection{
  border:1px solid var(--border);
  border-radius:12px;
  background:color-mix(in srgb, var(--panel) 82%, transparent);
  padding:0;
}
.prefsSection summary{
  list-style:none;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:space-between;
  min-height:40px;
  padding:10px 12px;
  font-weight:800;
}
.prefsSection summary::-webkit-details-marker{ display:none; }
.prefsSection summary::after{
  content:"▾";
  font-size:14px;
  color:var(--muted);
  transition:transform .15s ease;
}
.prefsSection[open] summary::after{ transform:rotate(180deg); }
.prefsContent{
  padding:0 12px 12px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.chatFxPreview{
  margin-bottom:12px;
  padding:12px;
  border:1px dashed var(--border);
  border-radius:12px;
  background: color-mix(in srgb, var(--panel) 78%, transparent);
}
.chatFxPreview.disabled{ opacity:0.65; }
.chatFxPreviewRow{ display:flex; justify-content:flex-end; }
.chatFxPreviewRow .bubble{ max-width:100%; }
.chatFxPreviewItem{
  width: 100%;
  align-items: flex-start;
}
.chatFxPreviewItem .msgMain{
  min-width: 0;
}
.chatFxPreviewAvatar{
  width: 32px;
  height: 32px;
}
.chatFxSliderRow{ display:flex; align-items:center; gap:10px; }
.chatFxSliderRow input[type="range"]{ flex:1; accent-color:var(--accent, #ff4f6d); }
.chatFxSliderValue{
  min-width:40px;
  text-align:right;
  font-size:12px;
  color:var(--muted);
}
.chatFxColorRow{
  display:flex;
  align-items:center;
  gap:10px;
}
.chatFxColorRow input[type="color"]{
  width:42px;
  height:34px;
  padding:0;
  border:none;
  background:transparent;
}
.chatFxColorRow input[type="text"]{
  flex:1;
}
.chatFxDensityRow{ display:flex; flex-wrap:wrap; gap:8px; }
.chatFxActions{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin-top:8px;
}
.polishPackField{
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:10px;
  border-radius:12px;
  border:1px solid var(--border);
  background:color-mix(in srgb, var(--panel) 80%, transparent);
}
.polishPackHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  font-weight:700;
}
.polishPackOptions{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  font-size:12px;
  color:var(--muted);
}
.chatFxStatus{
  font-size:12px;
  color:var(--muted);
  min-height:16px;
}
.likeRow{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; margin-top:10px; }
.likeRow .badge{ background:var(--panel); color:var(--text); border:1px solid var(--line); }

.infoGrid{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
.infoItem{ background: color-mix(in srgb, var(--panel) 85%, transparent); border:1px solid var(--border); border-radius:14px; padding:10px; }
.infoItem .k{ color:var(--muted); font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.06em; }
.infoItem .v{ margin-top:4px; font-weight:900; }

.bioRender{
  padding:10px; border-radius:14px;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--panel) 85%, transparent);
  line-height:1.4;
  word-break: break-word;
}
.bioRender blockquote{
  margin:10px 0; padding:10px;
  border-left:4px solid var(--border);
  background: color-mix(in srgb, var(--panel) 75%, transparent);
  border-radius:12px;
}
.bioRender pre{
  overflow:auto; padding:10px; border-radius:12px;
  background: color-mix(in srgb, var(--panel) 75%, transparent);
  border:1px solid var(--border);
}
.pill{
  display:inline-block; padding:3px 8px; border-radius:999px;
  border:1px solid var(--border); background:color-mix(in srgb, var(--panel) 80%, transparent);
  font-weight:900; font-size:11px; margin-right:6px;
}
.logTable{ width:100%; border-collapse:collapse; font-size:12px; overflow:hidden; border-radius:12px; }
.logTable th, .logTable td{ border-bottom:1px solid var(--line); padding:8px 8px; text-align:left; vertical-align:top; }
.logTable th{ color:var(--muted); font-weight:900; }
.logTable tr:last-child td{ border-bottom:0; }

/* Moderation log table wrapper: keeps filters visible and makes the log list scrollable */
.logTableWrap{
  overflow:auto;
  margin-top:8px;
  max-height:52vh;
  border:1px solid var(--line);
  border-radius:12px;
  background:var(--panel);
}
/* Force a horizontal scrollbar on small screens instead of squishing columns */
.logTable{ min-width:720px; }

.modCard{ display:flex; flex-direction:column; gap:10px; }
.pillRow{ display:flex; flex-wrap:wrap; gap:8px; }
.actionGrid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap:8px; }
.modGrid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:10px; }
.modGrid select{ width:100%; }

/* Customization */
.customizeShell{ display:grid; grid-template-columns: 200px 1fr; gap:12px; align-items:start; }
.customNav{ display:flex; flex-direction:column; gap:8px; }
.customNavBtn{
  border:1px solid var(--border);
  background:color-mix(in srgb, var(--panel) 85%, transparent);
  color:var(--text);
  border-radius:var(--radiusMd);
  padding:10px;
  cursor:pointer;
  font-weight:900;
  text-align:left;
}
.customNavBtn.active{ background:var(--panel); box-shadow: var(--shadowSm); }
.customContent{ width:100%; min-width:0; }
.customPanel{ display:none; }
.customPanel.active{ display:block; }
.themeFilters{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px; }
.pillBtn{
  border:1px solid var(--border);
  background:color-mix(in srgb, var(--panel) 85%, transparent);
  color:var(--text);
  border-radius:999px;
  padding:8px 12px;
  cursor:pointer;
  font-weight:800;
}
.pillBtn.active{
  background: color-mix(in srgb, var(--panel) 88%, var(--brand) 18%);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--brand) 35%, transparent), var(--shadowSm);
  border-color: color-mix(in srgb, var(--brand) 35%, var(--border));
}
.themeGrid{ display:grid; grid-template-columns: 1fr 1fr; gap:14px; align-items:start; }

.themeGrid.oneColumn{ grid-template-columns: 1fr; }
@media (max-width: 760px){
  .themeGrid{ grid-template-columns: 1fr; }
}

/* Split columns */
.themeColumn{ display:flex; flex-direction:column; gap:10px; }
.themeColumnHeader{ display:flex; align-items:baseline; justify-content:space-between; gap:8px; padding:2px 2px 0; }
.themeColumnTitle{ font-weight:1000; letter-spacing:.2px; }
.themeColumnHint{ font-size:11px; color:var(--muted); }

/* Compact theme cards for picker */
.themeCard.compact{ padding:8px; gap:6px; }
.themeCard.compact .themeLabel{ font-size:13px; }
.themeCard.compact .themeMode{ display:none; }
.themeCard.compact .themeThumbnail{ padding:8px; border-radius: var(--radiusMd); }
.themeCard.compact .themeMiniLayout{ grid-template-columns: 64px 1fr; gap:7px; }
.themeCard.compact .themeMiniSidebar{ padding:5px; gap:5px; }
.themeCard.compact .themeMiniMain{ padding:6px; gap:5px; }
.themeCard.compact .themeMiniButton{ font-size:9px; padding:5px 6px; }
.themeCard.compact .themeMiniBubble{ font-size:9px; padding:6px 7px; }
.themeCard.compact .themeMiniAvatar{ width:14px; height:14px; }

.themeCard{
  border:1px solid var(--border);
  border-radius:var(--radiusLg);
  background:var(--panel);
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:8px;
  cursor:pointer;
  position:relative;
}
.themeCard.selected{ box-shadow: var(--shadowSm); border-color: var(--accent); }
.themeCardHeader{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
.themeLabel{ font-weight:900; font-size:14px; }
.themeMode{ font-size:11px; color:var(--muted); }
.themeCheck{ color:var(--accent); font-weight:900; display:none; }
.themeCard.selected .themeCheck{ display:block; }
.themeThumbnail{
  border:1px solid var(--border);
  border-radius:var(--radiusLg);
  padding:10px;
  background:var(--panel2);
  box-shadow: var(--shadowSm);
}
.themeMiniLayout{ display:grid; grid-template-columns: 80px 1fr; gap:8px; align-items:stretch; }
.themeMiniSidebar{ background:var(--panel); border:1px solid var(--border); border-radius:var(--radiusMd); display:flex; flex-direction:column; gap:6px; padding:6px; }
.themeMiniSidebar .miniItem{ height:8px; border-radius:var(--radiusSm); background:color-mix(in srgb, var(--panel2) 70%, transparent); }
.themeMiniMain{ background:var(--panel); border:1px solid var(--border); border-radius:var(--radiusMd); padding:8px; display:flex; flex-direction:column; gap:6px; }
.themeMiniMsg{ display:flex; gap:6px; align-items:flex-start; }
.themeMiniAvatar{ width:18px; height:18px; border-radius:50%; background:var(--avatar-bg); border:1px solid var(--border); }
.themeMiniBubble{ flex:1; border-radius:var(--radiusSm); padding:6px; background:var(--messageOtherBg); color:var(--messageOtherText); font-size:10px; line-height:1.3; border:1px solid var(--border); }
.themeMiniBubble.self{ background:var(--messageSelfBg); color:var(--messageSelfText); }
.themeMiniButton{ align-self:flex-start; padding:6px 8px; background:var(--btnPrimaryBg); color:var(--btnPrimaryText); border-radius:var(--radiusSm); font-size:10px; font-weight:800; border:1px solid var(--border); }

@media (max-width: 980px){
  .searchWrap{
    display:none !important;
  }
  .customizeShell{ grid-template-columns: 1fr; }
  .customNav{ flex-direction:row; flex-wrap:wrap; }
  .customNavBtn{ flex:1; text-align:center; }
}

/* Mobile drawers */
.overlay{ position:fixed; inset:0; background:color-mix(in srgb, var(--shadowColor) 70%, transparent); display:none; pointer-events:none; z-index: 70; }
  .overlay{
    top: var(--headerH, 54px);
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 150;
  }
.overlay.show{ display:block; pointer-events:auto; }
.mediaLightbox{ position:fixed; inset:0; background:rgba(0,0,0,.75); display:none; align-items:center; justify-content:center; z-index:500; padding:20px; }
.mediaLightbox.show{ display:flex; }
.mediaLightbox img, .mediaLightbox video{ max-width:90vw; max-height:80vh; border-radius:16px; box-shadow:var(--shadowLg); background:#000; }
.mediaLightbox .largeClose{ position:absolute; top:16px; right:16px; }
body.lockScroll{ overflow:hidden; }
.drawerHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:10px 12px;
  border-bottom:1px solid var(--line);
}
.drawerHeader h3{ margin:0; }
.members .drawerHeader{ position:relative; }
.adminDropdown{
  position:absolute;
  top: calc(100% + 6px);
  right: calc(12px + env(safe-area-inset-right));
  min-width: 170px;
  background: var(--panel2);
  border:1px solid var(--line);
  border-radius:12px;
  box-shadow: var(--shadowLg);
  padding:8px;
  display:flex;
  flex-direction:column;
  gap:6px;
  z-index: 320;
}
.adminDropdownHeader{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:.08em;
  color:var(--muted);
  padding:2px 6px 4px;
}
.adminDropdownItem{
  display:flex;
  align-items:center;
  justify-content:flex-start;
  width:100%;
  padding:6px 10px;
  border-radius:10px;
  border:1px solid transparent;
  background: color-mix(in srgb, var(--panel) 70%, transparent);
  color: var(--text);
  font-size:13px;
  cursor:pointer;
}
.adminDropdownItem:hover,
.adminDropdownItem:focus-visible{
  background: color-mix(in srgb, var(--accent) 18%, var(--panel));
  border-color: color-mix(in srgb, var(--accent) 40%, transparent);
}
.profileSettingsWrap{
  position:relative;
  display:inline-flex;
}
.profileSettingsMenu{
  position:absolute;
  top:calc(100% + 8px);
  right:0;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:12px;
  padding:6px;
  display:flex;
  flex-direction:column;
  gap:4px;
  min-width:160px;
  box-shadow:var(--shadowMd);
  z-index:520;
}
.profileSettingsItem{
  background:transparent;
  border:1px solid transparent;
  border-radius:10px;
  padding:8px 10px;
  text-align:left;
  color:var(--text);
  font-weight:600;
}
.profileSettingsItem:hover,
.profileSettingsItem:focus-visible{
  background:color-mix(in srgb, var(--panel2) 80%, transparent);
  border-color:var(--borderStrong);
}
/* DM panel */
.dmPanel{
  --dmPanelBottom: max(16px, var(--dmDockBottom));
  position:fixed;
  top:16px;
  /* Leave a little breathing room for the desktop composer and avoid covering the members list. */
  bottom: var(--dmPanelBottom);
  right: calc(16px + var(--membersW));
  width:min(640px, 48vw);
  height:auto;
  max-height: calc(var(--vvhPx) - 16px - var(--dmPanelBottom));
  background: var(--panel2);
  border:1px solid color-mix(in srgb, var(--dm-neon) 18%, var(--line));
  border-radius:20px;
  box-shadow:
    0 0 0 1px color-mix(in srgb, var(--dm-neon) 18%, transparent),
    0 0 22px color-mix(in srgb, var(--dm-neon) 18%, transparent),
    0 22px 60px rgba(0,0,0,.5);
  display:flex;
  flex-direction:column;
  /* Pop-out animation (shown when .open is toggled) */
  visibility:hidden;
  opacity:0;
  transform: translateY(12px) scale(.98);
  pointer-events:none;
  transition: opacity .18s ease, transform .18s ease, visibility 0s linear .18s;
  z-index:300;
  overflow:hidden;
  min-height:0;
}

/* Optional: translucent DM panel so the room behind can still be noticed */
.dmPanel.dmTranslucent{
  background: color-mix(in srgb, var(--panel2) 72%, transparent);
  -webkit-backdrop-filter: blur(12px);
  backdrop-filter: blur(12px);
  border-color: transparent;
  box-shadow: 0 22px 60px rgba(0,0,0,.5);
}
.dmPanel.dmTranslucent .dmHeader,
.dmPanel.dmTranslucent .dmThreadsHeader,
.dmPanel.dmTranslucent .dmMeta{
  background: color-mix(in srgb, var(--panel2) 68%, transparent);
}

/* When translucent mode is enabled, make the whole DM surface (not just the top bars)
   follow the same glassy background treatment. */
.dmPanel.dmTranslucent .dmContent{
  background: transparent;
}
.dmPanel.dmTranslucent .dmThreads{
  background: color-mix(in srgb, var(--panel) 68%, transparent);
  -webkit-backdrop-filter: blur(12px);
  backdrop-filter: blur(12px);
  border-right-color: color-mix(in srgb, var(--line) 55%, transparent);
}
.dmPanel.dmTranslucent .dmConversation,
.dmPanel.dmTranslucent .dmMessages{
  background: transparent;
}
.dmPanel.dmTranslucent .dmNotice,
.dmPanel.dmTranslucent .dmInput,
.dmPanel.dmTranslucent .replyPreview{
  background: color-mix(in srgb, var(--panel2) 64%, transparent);
  -webkit-backdrop-filter: blur(12px);
  backdrop-filter: blur(12px);
}

/* Simple checkbox row used in the DM settings menu */
.checkRow{
  display:flex;
  align-items:center;
  gap:10px;
  cursor:pointer;
  user-select:none;
}
.checkRow input{
  width:18px;
  height:18px;
}
.dmPanel.open{
  visibility:visible;
  opacity:1;
  transform:none;
  pointer-events:auto;
  transition: opacity .18s ease, transform .18s ease;
 }
.dmHeader{
  /* Keep the DM panel header compact (closer to desktop DM header style). */
  padding:8px 12px;
  display:flex;
  align-items:center;
  gap:12px;
  justify-content:space-between;
  border-bottom:1px solid var(--line);
  background: var(--panel2);
}
.dmHeaderMain{
  display:flex;
  align-items:center;
  gap:10px;
  min-width:0;
}
.dmBackBtn{ display:none; }
.dmHeader .title{ font-weight:900; letter-spacing:.01em; }
.dmHeader .small{ font-size:11px; }
.dmHeader .iconBtn{ width:32px; height:32px; }
.dmNotice{
  /* Compact bar: holds the DM tabs; avoids wasting vertical space on mobile */
  padding:8px 12px;
  border-bottom:1px solid var(--line);
  min-height:18px;
  font-size:12px;
  color:var(--muted);
  background: rgba(255,255,255,.03);
  display:flex;
  align-items:center;
  gap:10px;
}
.dmNoticeText{ display:none; }
.dmNotice.hasNotice .dmNoticeText{ display:block; }
.dmContent{
  flex:1;
  display:flex;
  flex-direction:row;
  min-height:0;
  background:var(--dm-bg);
}
.dmThreads{
  width: min(320px, 38%);
  border-right:1px solid var(--line);
  overflow:auto;
  display:flex;
  flex-direction:column;
  min-height:0;
  gap:10px;
  padding:10px;
  background: var(--panel);
}
.dmThreadsHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:4px 4px 0;
}
.dmThreadList{
  display:flex;
  flex-direction:column;
  gap:6px;
  min-height:0;
}
/* Remove the large "boxed" panel look so the left list doesn't waste vertical space (mobile) */
.dmThreadList{ border:0; border-radius:0; overflow:auto; background:transparent; flex:1; min-height:0; }
.dmItem{
  padding:12px;
  border:1px solid transparent;
  border-radius:14px;
  cursor:pointer;
  display:flex;
  gap:10px;
  align-items:center;
  transition: background .12s ease, border-color .12s ease, transform .12s ease;
  min-height:48px;
}
.dmItem:hover{ background:var(--panel); }
.dmItem.active{ background:color-mix(in srgb, var(--panel2) 70%, transparent); border-color:color-mix(in srgb, var(--dm-neon) 18%, transparent); }
.dmItem:last-child{ border-bottom:0; }
.dmItem,
.dmThreadRow{
  position:relative;
}
.dmItem::after,
.dmThreadRow::after{
  content:"";
  position:absolute;
  inset:2px;
  border-radius:12px;
  pointer-events:none;
  opacity:0;
  transition: opacity 160ms ease, box-shadow 160ms ease;
  box-shadow:
    0 0 0 1px rgba(var(--userGlowRgb, 88 101 242) / 0.2),
    0 0 14px rgba(var(--userGlowRgb, 88 101 242) / 0.12);
}
@supports (color: color-mix(in srgb, #000, #fff)){
  .dmItem::after,
  .dmThreadRow::after{
    box-shadow:
      0 0 0 1px color-mix(in srgb, var(--userGlow) 26%, transparent),
      0 0 14px color-mix(in srgb, var(--userGlow) 18%, transparent);
  }
}
.dmItem:hover::after,
.dmItem.active::after,
.dmThreadBtn:hover .dmThreadRow::after,
.dmThreadBtn.active .dmThreadRow::after{
  opacity:1;
}
.dmItem .name{ font-weight:900; font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.dmItem .small{ color:var(--muted); font-size:11px; }
.dmItem .preview{ display:block; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.dmItemTop{ display:flex; align-items:center; gap:6px; justify-content:space-between; }
.dmItemMeta{ display:flex; flex-direction:column; gap:6px; min-width:0; flex:1; }
.dmItemBottom{ display:flex; align-items:center; gap:6px; justify-content:space-between; }
.dmItemTime{ font-size:11px; color:var(--muted); white-space:nowrap; }
.dmUnread{ min-width:22px; height:22px; padding:0 8px; border-radius:999px; background:var(--accent); color:white; font-size:11px; display:flex; align-items:center; justify-content:center; }
.dmAvatar{ width:44px; height:44px; border-radius:14px; overflow:hidden; background:var(--avatar-bg); flex-shrink:0; display:flex; align-items:center; justify-content:center; }
.dmConversation{
  display:flex;
  flex-direction:column;
  flex:1 1 auto;
  min-width:0;
  min-height:0;
}

.dmStrip{
  display:flex;
  gap:8px;
  align-items:center;
  padding:6px 8px;
  border-radius:999px;
  background: rgba(255,255,255,0.10);
  border:1px solid rgba(255,255,255,0.10);
  width: fit-content;
  flex: 0 1 auto;
  max-width: min(50vw, 420px);
  overflow-x:auto;
  overflow-y:hidden;
  -webkit-overflow-scrolling: touch;
}
.dmStrip::-webkit-scrollbar{ height:6px; }

/* Quick DM avatar strips shown under the topbar (before opening DM panel) */
.dmQuickBar{
  display:flex;
  justify-content:center;
  padding:6px 10px;
}
.dmQuickStrip{
  display:flex;
  gap:8px;
  align-items:center;
  padding:6px 8px;
  border-radius:999px;
  background: rgba(255,255,255,0.10);
  border:1px solid rgba(255,255,255,0.10);
  width: fit-content;
  flex: 0 1 auto;
  max-width: min(70vw, 560px);
  overflow-x:auto;
  overflow-y:hidden;
  -webkit-overflow-scrolling: touch;
}
.dmQuickStrip::-webkit-scrollbar{ height:6px; }
.dmQuickEmpty{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 14px;
  border-radius:999px;
  background: rgba(255,255,255,0.10);
  border:1px solid rgba(255,255,255,0.10);
  width: fit-content;
  max-width: min(70vw, 560px);
  color: rgba(255,255,255,0.85);
  font-size: 13px;
}
.dmQuickEmptyText{ opacity:0.95; }
.dmQuickEmptyBtn{
  padding:6px 10px;
  border-radius:999px;
  font-size: 12px;
  line-height: 1;
}

/* Ensure the HTML [hidden] attribute reliably hides the quick DM strips */
#dmQuickBar[hidden], #groupQuickBar[hidden]{ display:none !important; }

/* Group DM "venn" preview inside group avatar buttons */
.groupVenn{
  position:relative;
  width:34px;
  height:34px;
}
.groupVenn .vennAvatar{
  position:absolute;
  width:22px;
  height:22px;
  border-radius:999px;
  border:2px solid rgba(0,0,0,0.35);
  box-sizing:border-box;
}
.groupVenn .vennAvatar.v1{ left:0; top:8px; }
.groupVenn .vennAvatar.v2{ right:0; top:8px; }
.groupVenn .vennAvatar.v3{ left:6px; top:0; }

.dmGroupStack{
  position:relative;
  width:40px;
  height:40px;
}
.dmGroupAvatar{
  position:absolute;
  width:20px;
  height:20px;
  border-radius:999px;
  border:2px solid rgba(0,0,0,0.35);
  box-sizing:border-box;
}
.dmGroupAvatar1{ left:0; top:0; }
.dmGroupAvatar2{ right:0; top:0; }
.dmGroupAvatar3{ left:0; bottom:0; }
.dmGroupAvatar4{ right:0; bottom:0; }

.dmTabs{
  display:flex;
  gap:6px;
  flex-wrap:wrap;
  margin:2px 0 6px;
}

/* Tabs are no longer shown inside the DM panel; group DMs have their own topbar button */
#dmTabs{ display:none !important; }
.dmTabBtn{
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.14);
  background: rgba(255,255,255,0.06);
  color: var(--text);
  cursor:pointer;
  font-weight:900;
  font-size:12px;
  line-height:1;
}
.dmTabBtn.active{
  background: rgba(255,255,255,0.14);
  border-color: rgba(255,255,255,0.24);
}
.dmAvatarBtn{
  position:relative;
  border:0;
  background: transparent;
  padding:0;
  cursor:pointer;
}

.chat-main .sys.diceResult{
  animation: diceResultPop 240ms ease-out;
}

@keyframes diceShake{
  0%{ transform: translateX(0) rotate(0); }
  20%{ transform: translateX(-2px) rotate(-6deg); }
  40%{ transform: translateX(2px) rotate(6deg); }
  60%{ transform: translateX(-2px) rotate(-4deg); }
  80%{ transform: translateX(2px) rotate(4deg); }
  100%{ transform: translateX(0) rotate(0); }
}

@keyframes diceResultPop{
  0%{ transform: scale(0.96); }
  55%{ transform: scale(1.03); }
  100%{ transform: scale(1); }
}

@media (prefers-reduced-motion: reduce){
  #mediaBtn.diceShaking,
  .chat-main .sys.diceResult{
    animation:none !important;
  }
}
.dmAvatarBtn .avatar{
  width:28px;
  height:28px;
}
.dmAvatarBtn .unreadDot{
  position:absolute;
  right:-1px;
  top:-1px;
  width:10px;
  height:10px;
  border-radius:50%;
  background: #ff4d4d;
  box-shadow: 0 0 0 2px rgba(0,0,0,0.5);
  display:none;
}
.dmAvatarBtn.unread .unreadDot{ display:block; }
.dmAvatarBtn.active .avatar{
  outline:2px solid rgba(255,255,255,0.6);
  outline-offset:2px;
  border-radius:50%;
}

.dmMeta{ padding:4px 8px; border-bottom:1px solid var(--line); display:flex; align-items:center; justify-content:space-between; gap:8px; }
.dmMeta .title{ font-weight:900; }
.dmMetaText{ display:flex; flex-direction:column; gap:4px; min-width:0; }
.dmMetaTop{ display:flex; align-items:center; gap:8px; min-width:0; }
.dmMetaAvatar{ display:flex; align-items:center; justify-content:center; flex:0 0 auto; }
.dmMetaAvatar .avatar{ border-radius:50%; overflow:hidden; }
.dmTyping{ min-height:14px; opacity:.82; letter-spacing:.5px; }
.dmTyping.isOn{ opacity:.95; }
.dmTyping .dots{ font-weight:800; display:inline-block; min-width:22px; }

/* DM typing indicator must never reflow messages.
   It's rendered inside .dmInput and positioned above the composer. */
.dmInput .dmTyping{
  position:absolute;
  left:14px;
  right:14px;
  top:-16px;
  min-height:0;
  margin:0;
  pointer-events:none;
  opacity:.85;
  text-shadow: 0 0 10px rgba(0,0,0,.45);
}

.dmMetaActions{ position:relative; display:flex; align-items:center; gap:8px; }
.dmMetaActions .iconBtn{ width:32px; height:32px; }
.dmMetaActions .iconBtn{ width:32px; height:32px; }
.dmSettingsMenu{ display:none; position:absolute; right:0; top:110%; background:var(--panel); border:1px solid var(--line); border-radius:14px; min-width:220px; padding:10px; box-shadow: var(--shadow); z-index:4; gap:10px; flex-direction:column; }
.dmSettingsMenu.open{ display:flex; }
.dmSettingsRow{ display:flex; flex-direction:column; gap:6px; padding:6px 0; border-bottom:1px solid var(--line); }
.dmSettingsRow:last-child{ border-bottom:0; }
.colorInputRow.tight{ gap:6px; }
.colorInputRow.tight input[type="text"]{ min-width:120px; }
.chat-dm .dmMessages{ flex:1; overflow:auto; padding:10px 12px; display:flex; flex-direction:column; gap:8px; min-height:0; }

/* --- DM message layout (bubble hugs content; actions appear BELOW bubble, no reserved space) --- */
.chat-dm .dmMessages{ padding:14px 16px; gap:8px; }
.chat-dm .dmRow{ width:100%; display:flex; align-items:flex-start; box-sizing:border-box; min-width:0; }
.chat-dm .dmRow.self{ justify-content:flex-end; }

/* DM message avatars (pfps) */
.chat-dm .dmAvatarSlot{
  width:40px;
  flex: 0 0 40px;
  display:flex;
  align-items:flex-end;
  justify-content:center;
  padding-right:6px;
  box-sizing:border-box;
}
.chat-dm .dmAvatarSlot.empty{ visibility:hidden; }
.chat-dm .dmAvatarSpacer{ width:30px; height:30px; }
.chat-dm .dmMsgAvatar{ width:30px; height:30px; }

/* Self messages don't need a left avatar column */
/* Self messages: show your avatar on the RIGHT (like modern DMs) */
.chat-dm .dmRow.self .dmAvatarSlot{
  display:flex;
  order:2;
  padding-right:0;
  padding-left:6px;
  justify-content:center;
}
.chat-dm .dmRow.self .dmBubbleWrap{ order:1; }

body.polish-pack.polish-animations .chat-dm .msg-new .dmMsgAvatar{
  animation: msgArrival 160ms cubic-bezier(.22,.61,.36,1);
  transform-origin: center;
}
@media (prefers-reduced-motion: reduce){
  body.polish-pack.polish-animations .chat-dm .msg-new .dmMsgAvatar{
    animation:none;
  }
}

.chat-dm .dmBubbleWrap{
  display:flex;
  flex-direction:column;
  flex: 0 1 auto;
  min-width:0;
  max-width:66%;
  /* Prevent bubbles from stretching to the width of meta/reactions/actions */
  align-items:flex-start;
}
.chat-dm .dmRow.self .dmBubbleWrap{ align-items:flex-end; }

.chat-dm .dmBubble{
  --fx-contrast-shadow: 0 1px 2px rgba(0,0,0,0.18);
  --msg-accent-top-size: var(--msg-accent-height, 4px);
  --msg-accent-bottom-size: 0px;
  color:var(--fx-text, var(--text));
  display:inline-flex;
  width: fit-content;
  max-width:100%;
  flex: 0 0 auto;
  padding:10px 12px;
  padding-top:calc(10px + var(--msg-accent-height, 4px) + var(--msg-accent-gap, 4px));
  border-radius:var(--dm-bubble-radius, 16px);
  background:transparent;
  border:0;
  overflow-wrap:anywhere;
  word-break:break-word;
  font-family:var(--fx-font-family, inherit);
  gap:6px;
  box-shadow:none;
}
.chat-dm .dmRow.msg--dm.msg--group-end .dmBubble{
  --msg-accent-bottom-size: var(--msg-accent-height, 4px);
  padding-bottom:calc(10px + var(--msg-accent-height, 4px) + var(--msg-accent-gap, 4px));
}
.chat-dm .dmBubble::before{
  content:"";
  position:absolute;
  left:0;
  right:0;
  top:0;
  bottom:0;
  border-radius:999px;
  background-image:
    var(--msg-accent-fill, color-mix(in srgb, var(--fx-accent, var(--accent)) 45%, transparent)),
    var(--msg-accent-fill, color-mix(in srgb, var(--fx-accent, var(--accent)) 45%, transparent));
  background-repeat:no-repeat;
  background-position: top left, bottom left;
  background-size: 100% var(--msg-accent-top-size, 4px), 100% var(--msg-accent-bottom-size, 0px);
  opacity:var(--msg-accent-opacity, 0.6);
  pointer-events:none;
  transition: opacity 160ms ease, box-shadow 160ms ease;
}
.chat-dm .dmBubble.self{
  --dm-bubble-bg: var(--bubbleSelf, var(--dm-bubble-bg, var(--panel)));
  color:var(--fx-text, #fff);
}
.chat-dm .dmMetaRow{
  display:flex;
  justify-content:flex-start;
  align-items:baseline;
  gap:6px;
  flex-wrap:wrap;
  margin-top:4px;
  font-size:var(--fx-time-size, 12px);
  color: var(--muted);
  text-shadow:var(--text-shadow-soft);
}
.chat-dm .dmMetaUser{ font-weight:800; text-shadow:var(--text-shadow-soft); }
.chat-dm .dmMetaTime{ opacity:.85; text-shadow:var(--text-shadow-soft); }

/* DM actions: overlay beside the bubble (never reserves vertical space) */
.chat-dm .dmBubbleWrap{ position:relative; }

.chat-dm .dmActionsBar{
  /* horizontal, like main chat */
  display:flex !important;
  flex-direction:row !important;
  flex-wrap:nowrap !important;
  align-items:center;
  gap:8px;
  white-space:nowrap;

  /* overlay: do NOT participate in layout */
  position:absolute;
  top:50%;
  left: calc(100% + 10px);
  transform: translateY(-50%) scale(.98);
  z-index: 50;

  /* hidden by default */
  opacity:0;
  pointer-events:none;

  /* small visual container to match your UI */
  padding:6px;
  border-radius:14px;
  background: rgba(0,0,0,.22);
  border: 1px solid rgba(255,255,255,.08);
  backdrop-filter: blur(10px);

  transition: opacity .15s ease, transform .18s ease;
}

/* Ensure buttons never force a new line in the flex row */
.chat-dm .dmActionsBar > *{ flex: 0 0 auto; }

/* Self messages are on the right: put actions on the left of the bubble */
.chat-dm .dmRow.msg--dm.self .dmActionsBar{
  left:auto;
  right: calc(100% + 10px);
}

@media (hover:hover){
  .chat-dm .dmRow.msg--dm:hover .dmActionsBar{
    opacity:1;
    pointer-events:auto;
    transform: translateY(-50%) scale(1);
  }
}

.chat-dm .dmRow.msg--dm.showActions .dmActionsBar{
  opacity:1;
  pointer-events:auto;
  transform: translateY(-50%) scale(1);
}

/* Mobile: keep the bar horizontal and tighter so it fits nicely */
@media (max-width: 520px){
  .chat-dm .dmActionsBar{
    gap:6px;
    padding:5px;
    left: calc(100% + 8px);
    max-width: min(92vw, 360px);
    overflow-x:auto;
    -webkit-overflow-scrolling: touch;
  }
  .chat-dm .dmRow.msg--dm.self .dmActionsBar{ right: calc(100% + 8px); }
  .chat-dm .dmActionsBar .iconBtn.smallIcon{
    width:30px;
    height:30px;
    border-radius:11px;
    font-size:14px;
  }
}

.chat-dm .dmReplyContext{
  width:100%;
  text-align:left;
  border:0;
  background: rgba(255,255,255,.06);
  color: inherit;
  border-radius:12px;
  padding:8px 10px;
  margin-bottom:8px;
  cursor:pointer;
}
.chat-dm .dmReplyContext .replyUser{ font-weight:900; font-size:12px; }
.chat-dm .dmReplyContext .replySnippet{ font-size:12px; opacity:.9; }
.dmInput{ padding:10px 12px; border-top:1px solid var(--line); display:flex; gap:8px; flex-shrink:0; background: var(--panel2); position:relative; }
.dmInput input{ flex:1; }
.dmSectionTitle{
  padding:10px 12px;
  font-size:11px;
  font-weight:900;
  color: var(--muted);
  letter-spacing:.06em;
  text-transform:uppercase;
  border-bottom:1px solid var(--line);
  background: rgba(255,255,255,.03);
}
.dmEmpty{ color:var(--muted); font-size:12px; text-align:center; padding:12px; }
.dmTabs{ display:none; }
.segBtn{ flex:1; padding:10px; border-radius:12px; background:var(--panel); border:1px solid var(--line); color:inherit; font-weight:800; letter-spacing:.01em; }
.segBtn.active{ background:var(--accent); color:#fff; border-color:var(--accent); }
.dmThreadActions{ padding:4px 6px 6px; }
.dmThreadActions .btn.full{ width:100%; justify-content:center; }
.dmModal{ position:fixed; inset:0; background:var(--overlay-scrim); display:none; align-items:center; justify-content:center; padding:14px; z-index:380; }
.dmModal.show{ display:flex; }
.dmModalCard{
  background:var(--panel2);
  border:1px solid color-mix(in srgb, var(--dm-neon) 18%, var(--line));
  border-radius:18px;
  width:min(560px, 96vw);
  max-height:90vh;
  display:flex;
  flex-direction:column;
  gap:12px;
  padding:14px;
  overflow:hidden;
  box-shadow:
    0 0 0 1px color-mix(in srgb, var(--dm-neon) 16%, transparent),
    0 12px 32px rgba(0,0,0,0.45);
}
.dmModalHeader{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; }
.dmPickerList{ flex:1; min-height:200px; border:1px solid var(--line); border-radius:12px; overflow:auto; background:var(--panel); }
.dmPickerRow{ display:flex; align-items:center; gap:10px; padding:10px 12px; border-bottom:1px solid var(--line); }
.dmPickerRow:last-child{ border-bottom:0; }
.dmPickerName{ font-weight:800; }
.dmPickerSub{ font-size:11px; color:var(--muted); }
.dmModalActions{ display:flex; gap:8px; justify-content:flex-end; flex-wrap:wrap; }
.dmModalActions.stacked{ flex-direction:column; align-items:stretch; }
.dmModalActions .btn{ flex:1; justify-content:center; }
.dmInfoMembers{ display:flex; flex-direction:column; gap:8px; margin-top:8px; max-height:260px; overflow:auto; border:1px solid var(--line); border-radius:12px; padding:8px; background:var(--panel); }
.dmInfoMember{ display:flex; align-items:center; gap:10px; padding:8px 6px; border-bottom:1px solid var(--line); }
.dmInfoMember:last-child{ border-bottom:0; }
.dmInfoSection .small{ color:var(--muted); }
.bodyLocked{ overflow:hidden; }
.mobOnly{ display:none; }

@media (max-width: 1260px){
  .dmPanel{ right: calc(16px + var(--membersW)); width:min(640px, 70vw); }
}
@media (max-width: 980px){
  /*
    Reserve space at the bottom of the scrollable message list so the floating
    typing indicator never overlaps the newest messages.
    This keeps the viewport stable (no jump/reflow) when typing appears.
  */
  :root{ --typingReserve: 28px; }
  .mobOnly{ display:flex; }
  .members{ display:none; }

  .topbar{
    position: sticky;
    top: 0;
    z-index: 200;
    padding:0 calc(10px + env(safe-area-inset-right)) 0 calc(10px + env(safe-area-inset-left));
    gap:8px;
  }
  /* --- iOS topbar tap fix: prevent wrapping causing buttons to overflow into content layer --- */
  .topbar .row{ flex-wrap: nowrap; }
  .topbar .row{ min-width: 0; }
  .topbar .topLeft{ flex: 0 0 auto; }
  .topbar .topActions{ flex: 1 1 auto; justify-content:flex-end; gap:8px; }
  .topbar .searchWrap{ min-width: 0; }
  .topbar .searchWrap input{ width: 140px; max-width: 30vw; }
  .topbar .iconBtn{ flex: 0 0 auto; }
  .msgs{ padding:10px; gap:8px; padding-bottom: calc(12px + var(--typingReserve, 0px)); }
  .msg{ gap:8px; }
  .msgAvatar{ width:34px; height:34px; }
  .bubble{
  /* ...existing... */
  min-width:0;              /* ✅ allow flex child to shrink */
  overflow:hidden;          /* ✅ prevents bleed */
}
  .typing{ padding:0 10px; height:18px; font-size:11px; }
  .inputBar{ padding:10px; gap:8px; position: static; bottom:auto; padding-bottom: calc(10px + env(safe-area-inset-bottom)); }

  .dmPanel{
    inset:0;
    width:100vw;
    height: var(--vvhPx);
    max-height:none;
    border-radius:0;
    border:0;
    box-shadow:none;
  }
  .dmHeader{ position:sticky; top:0; background:var(--panel2); z-index:2; }
  .dmBackBtn{ display:inline-flex; }
  .dmInput{
    position: static;
    bottom: auto;
    padding-bottom: calc(10px + env(safe-area-inset-bottom));
  }
  .dmContent{ display:flex; flex-direction:column; }
  .dmThreads{
    width:100%;
    border-right:0;
    border-bottom:1px solid var(--line);
    background: var(--panel2);
  }
  .dmPanel.dmModeInbox .dmConversation{ display:none; }
  .dmPanel.dmModeThread .dmThreads{ display:none; }
  .dmPanel.dmModeThread .dmBackBtn{ display:inline-flex; }
  .dmPanel.dmModeInbox .dmBackBtn{ display:none; }
  .dmMessages{ padding-bottom: 12px; }

  .channels{
    position:fixed;
    top: var(--headerH, 54px);
    left:0;
    height: calc(var(--vvhPx) - var(--headerH, 54px));
    width:min(86vw, 320px);
    transform:translateX(-105%);
    transition:transform .18s ease;
    z-index:160;
    box-shadow: 12px 0 30px rgba(0,0,0,.55);
  }

  /* When drawers are closed keep them out of the hit-test chain (iOS was letting the off-canvas pane eat topbar taps). */
  .channels,
  .members.drawer{
    pointer-events:none;
  }
  .channels.open,
  .members.drawer.open{
    pointer-events:auto;
  }

/* If members panel is hidden (mobile/tablet), don't reserve space on the right */
@media (max-width: 980px){
  .dmPanel{ right:0; bottom:0; }
}

/* --- DM width safety: keep bubbles/meta/typing inside frame --- */
:root{
  --dmActionsW: 104px; /* estimated width of 3 small action buttons + gaps */
}
.chat-dm .dmRow.msg--dm{
  min-width:0;
  box-sizing:border-box;
}
.chat-dm .dmBubbleWrap{
  flex:0 1 auto;
  min-width:0;
  max-width:66%;
}
.chat-dm .dmMetaRow{
  max-width:100%;
}
.chat-dm .dmMetaUser,
.chat-dm .dmMetaTime{
  max-width:100%;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.typing{
  max-width:100%;
  box-sizing:border-box;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
@media (max-width: 520px){
  :root{ --dmActionsW: 92px; }
}
/* --- DM actions rail: smaller and hug bubbles more closely --- */
.chat-dm .dmActionsRail{
  gap:4px;
}
.chat-dm .dmActionsRail .iconBtn.smallIcon{
  width:28px;
  height:28px;
  border-radius:10px;
  font-size:14px;
}

/* --- Mobile typing indicator: float above the composer instead of stealing chat height --- */
@media (max-width: 980px){
  .typing{
    position:fixed;
    left:0;
    right:0;
    bottom: calc(var(--typingAnchorH, var(--composerH, 72px)) + env(safe-area-inset-bottom));
    height:auto;
    padding:6px 12px;
    display:none;
    background: rgba(0,0,0,0.35);
    backdrop-filter: blur(8px);
    border-top: 1px solid rgba(255,255,255,0.08);
    pointer-events:none;
    z-index:180;
  }
  .typing:not(:empty){ display:flex; }
}

/* iOS Safari: prefer the small viewport unit when available */
@supports (height: 100svh){
  .dmPanel{ height: 100svh; }
}
  .channels.open{ transform:translateX(0); }

  .members.drawer{
  display:block;
  position:fixed; top: var(--headerH, 54px); right:0; height: calc(var(--vvhPx) - var(--headerH, 54px));
  width:min(86vw, 320px);
  transform:translateX(105%);
  transition:transform .18s ease;
  z-index:160;
  box-shadow: -12px 0 30px rgba(0,0,0,.55);
}
  .members.drawer.open{ transform:translateX(0); }

  input, textarea, select{ font-size:16px; }
  .uploadPreview{ margin: 6px 10px; padding: 8px 10px; gap: 10px; }
}
/* Rooms header */
.chanHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:10px 12px;
  border-top:1px solid var(--line);
  border-bottom:1px solid var(--line);
  position:relative;
}
.roomActionsWrap{ position:relative; display:inline-flex; align-items:center; }
.roomActionsMenu{
  position:absolute;
  top:calc(100% + 6px);
  right:0;
  min-width:180px;
  display:flex;
  flex-direction:column;
  gap:4px;
  padding:8px;
  background:var(--panel2);
  border:1px solid var(--border);
  border-radius:12px;
  box-shadow: var(--shadowMd);
  z-index:200;
}
.roomActionsMenu[hidden]{ display:none; }
.roomActionsMenu button{
  width:100%;
  text-align:left;
  background:transparent;
  border:1px solid transparent;
  color:var(--text);
  padding:8px 10px;
  border-radius:10px;
  cursor:pointer;
  font-weight:600;
}
.roomActionsMenu button:hover{ background:var(--panel); }
.roomActionsMenu button:disabled{
  opacity:0.5;
  cursor:not-allowed;
}
.smallIcon{
  width:32px;
  height:32px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border-radius:10px;
}

/* Main chat .msgMain/.msgActions behavior is defined up near the grouping
   section (absolute overlay + animated shift). Keep this block empty so
   later CSS doesn't override that behavior. */

/* Reaction picker popover */
.reactionMenu{
  position:fixed;
  z-index:9999;
  display:none;
  padding:10px;
  border-radius:14px;
  background: var(--panel2);
  border:1px solid var(--border);
  box-shadow: var(--shadowMd);
  max-width:260px;
}
.reactionMenu.open{ display:block; }
.reactionGrid{
  display:grid;
  grid-template-columns: repeat(8, 1fr);
  gap:6px;
}
.reactionMenu button{
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--panel) 80%, transparent);
  color: var(--text);
  border-radius:12px;
  padding:8px 0;
  cursor:pointer;
  font-weight:900;
}
.reactionMenu button:hover{ background:color-mix(in srgb, var(--panel) 90%, transparent); }

/* ✅ Fix: prevent the hidden level toast from blocking taps on mobile */
#levelToast{
  /* Inline toast near topbar controls (prevents covering tap targets) */
  position: relative;
  inset: auto;
  top: auto;
  right: auto;

  background: var(--panel2);
  color: var(--text);
  border: 2px solid var(--accent);
  border-radius: 12px;
  padding: 8px 12px;
  font-weight: 900;
  box-shadow: var(--shadow);
  display: inline-flex;
  align-items: center;
  gap: 8px;

  opacity: 0;
  transform: translateY(-6px);
  transition: opacity .25s ease, transform .25s ease;

  /* Hidden state MUST NOT block taps */
  pointer-events: none;
  visibility: hidden;
}

#levelToast.show{
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
  visibility: visible;
}

/* keep it compact on narrow screens */
@media (max-width: 420px){
  #levelToast{ padding: 6px 10px; font-size: 13px; }
}

@media (max-width: 760px){
  #modal{
    padding: max(12px, env(safe-area-inset-top)) 10px max(12px, env(safe-area-inset-bottom)) 10px;
  }
  .modalCard{
    width: 100vw;
    max-width: 100vw;
    /* Fallbacks for iOS Safari where custom vvH may be missing */
    max-height: calc(var(--vvhPx, 100dvh) - 20px);
    border-radius: 16px;
  }
  @supports (height: 100svh){
    .modalCard{ max-height: calc(100svh - 20px); }
  }
  .modalBody{
    padding: 0 10px 12px;
  }
  .modalGrid{ grid-template-columns: 1fr; }
  .infoGrid{ grid-template-columns: 1fr; }
  .pAvatar{ width:140px; height:140px; margin:0 auto; }

  .tabs{
    position: sticky;
    top: 0;
    z-index: 5;
    background: var(--panel);
    padding: 6px 2px 10px;
    gap: 8px;
    overflow: hidden;
  }
  .tab{
    flex: 1 1 calc(50% - 8px);
    text-align: center;
    padding: 10px 8px;
    font-size: 12px;
    white-space: nowrap;
  }

  .panelBox h3{
    margin: 10px 0 8px;
  }
}

@media (max-width: 520px){
  /* Topbar: keep essential buttons visible on narrow screens */
  .topbar .searchWrap{ display:none; }
  .topbar .levelToastInline{ display:none; }
  .topbar{ gap:6px; }
  .topbar .topActions{ gap:6px; }

  .uploadPreview{ flex-direction: column; align-items: stretch; }
  .uploadRight{ min-width: 0; width: 100%; }
  .ts{ display:none; }
}
@media (max-width: 760px){
  #viewModeration .row{
    flex-direction: column;
    align-items: stretch !important;
  }

  #modUser, #modReason, #modMuteMins, #modBanMins, #modSetRole{
    width: 100% !important;
    min-width: 0 !important;
  }

  /* Turn the action buttons row into a grid */
  #modKickBtn, #modMuteBtn, #modBanBtn,
  #modUnmuteBtn, #modUnbanBtn, #modWarnBtn,
  #modOpenProfileBtn{
    width: 100%;
  }

  /* If the buttons are all inside the same row container,
     we can target that row and grid it. If needed, I’ll adjust markup slightly. */
  #viewModeration .modTargetActions{
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }
}

/* Dice Room overlay + confetti */
#diceOverlay{
  position:absolute;
  left:50%;
  /* Keep result overlay above the composer/roll button on all viewports */
  top:auto;
  /* Keep dice FX safely above the composer/roll button across iOS viewport quirks */
  bottom: calc(var(--composerH, 72px) + env(safe-area-inset-bottom, 0px) + 28px + var(--diceOverlayLift, 0px));
  transform:translateX(-50%);
  pointer-events:none;
  min-width: 170px;
  min-height: 96px;
  padding: 14px 14px 12px;
  border-radius:18px;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  background:var(--panel);
  border:1px solid var(--border);
  box-shadow:0 10px 30px rgba(0,0,0,.25);
  z-index:50;
}
#diceOverlay .diceOverlayInner{ width:100%; display:flex; flex-direction:column; gap:6px; align-items:center; }
#diceOverlay .diceDisplay{ font-size:54px; font-weight:900; letter-spacing:0.5px; line-height:1; }
#diceOverlay .diceSub{ font-size:12px; color:var(--muted); font-weight:800; }
#diceOverlay .diceDelta{ font-size:14px; font-weight:900; }
#diceOverlay.outcome-loss .diceDelta{ opacity:0.95; }
#diceOverlay.outcome-win .diceDelta,
#diceOverlay.outcome-bigwin .diceDelta{ text-shadow: 0 6px 18px rgba(0,0,0,0.25); }
#diceOverlay.outcome-jackpot{ box-shadow:0 14px 40px rgba(0,0,0,.35); }
#diceOverlay.outcome-loss{ animation: diceLossShake 280ms ease-in-out both; }
#diceOverlay.outcome-nice{ animation: diceNiceWiggle 420ms ease-in-out both; }
#diceOverlay.outcome-jackpot{ animation: diceJackpotPulse 720ms ease-out both; }

/* Variant-specific micro animations */
#diceOverlay.variant-d6 .diceDisplay{ animation: d6Pop 420ms ease-out both; }
#diceOverlay.variant-d20 .diceDisplay{ animation: d20Spin 520ms cubic-bezier(.2,.9,.2,1) both; }
#diceOverlay.variant-2d6 .diceDisplay{ animation: twoDiceBounce 520ms ease-out both; }
#diceOverlay.variant-d100 .diceDisplay{ animation: d100Ticker 520ms ease-out both; }

@keyframes d6Pop{ 0%{ transform:scale(0.85) rotate(-6deg); opacity:0.6; } 100%{ transform:scale(1) rotate(0); opacity:1; } }
@keyframes d20Spin{ 0%{ transform:rotate(-140deg) scale(0.75); opacity:0.35; } 100%{ transform:rotate(0deg) scale(1); opacity:1; } }
@keyframes twoDiceBounce{ 0%{ transform:translateY(10px) scale(0.85); opacity:0.6; } 60%{ transform:translateY(-6px) scale(1.03); opacity:1; } 100%{ transform:translateY(0) scale(1); } }
@keyframes d100Ticker{ 0%{ transform:translateY(-10px) scale(0.9); opacity:0.4; } 100%{ transform:translateY(0) scale(1); opacity:1; } }

@keyframes diceLossShake{
  0%{ transform:translate(-50%,-50%) translateX(0); }
  25%{ transform:translate(-50%,-50%) translateX(-3px); }
  50%{ transform:translate(-50%,-50%) translateX(3px); }
  75%{ transform:translate(-50%,-50%) translateX(-2px); }
  100%{ transform:translate(-50%,-50%) translateX(0); }
}
@keyframes diceNiceWiggle{
  0%{ transform:translate(-50%,-50%) rotate(0deg); }
  35%{ transform:translate(-50%,-50%) rotate(-4deg); }
  70%{ transform:translate(-50%,-50%) rotate(3deg); }
  100%{ transform:translate(-50%,-50%) rotate(0deg); }
}
@keyframes diceJackpotPulse{
  0%{ transform:translate(-50%,-50%) scale(0.92); filter:brightness(0.95); }
  35%{ transform:translate(-50%,-50%) scale(1.03); filter:brightness(1.05); }
  70%{ transform:translate(-50%,-50%) scale(1); filter:brightness(1); }
  100%{ transform:translate(-50%,-50%) scale(1); }
}
#confettiLayer{
  position:absolute;
  left:0;
  right:0;
  top:0;
  /* Keep celebratory confetti above the composer area (especially on mobile). */
  bottom: calc(var(--composerH, 72px) + env(safe-area-inset-bottom, 0px) + 24px + var(--diceOverlayLift, 0px));
  pointer-events:none;
  z-index:45;
}
#confettiLayer .confetti{
  position:absolute;
  top:35%;
  width:10px;
  height:14px;
  border-radius:3px;
  background:var(--accent);
  animation: confettiPop 0.8s ease-out forwards;
}
#confettiLayer .confetti:nth-child(3n){ background:var(--accent2); }
#confettiLayer .confetti:nth-child(3n+1){ background:var(--success); }
@keyframes confettiPop{
  0%{ transform:translateY(0) rotate(0deg); opacity:1; }
  100%{ transform:translateY(180px) rotate(420deg); opacity:0; }
}

@media (max-height: 700px){
  :root{
    --diceOverlayLift: 28px;
  }
  #diceOverlay{
    min-width: 150px;
    min-height: 84px;
  }
  #diceOverlay .diceDisplay{ font-size: 46px; }
  #diceOverlay .diceDelta{ font-size: 13px; }
}

main.chat{ position: relative; }

.srOnly{
  position:absolute;
  width:1px; height:1px;
  padding:0; margin:-1px;
  overflow:hidden;
  clip:rect(0,0,0,0);
  white-space:nowrap;
  border:0;
}

.logoutTop{
  background:var(--panel);
  border-color:var(--line);
  font-size:18px;
}

.ytSticky{ position:sticky; top:0; z-index:40; margin:10px 0; transform:translateY(-120%); opacity:0; pointer-events:none; transition:transform 200ms ease, opacity 200ms ease; }
.ytSticky:not(.is-hidden){ transform:translateY(0); opacity:1; pointer-events:auto; }
.ytStickyInner{ background:var(--panel, #0f1116); border:1px solid var(--border-subtle, rgba(255,255,255,0.08)); border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,0.3); overflow:hidden; }
.ytStickyHeader{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px 12px; background:linear-gradient(90deg, rgba(255,255,255,0.04), rgba(255,255,255,0)); }
.ytStickyInfo{ display:flex; align-items:center; gap:10px; min-width:0; }
.ytStickyThumb{ width:64px; height:48px; border-radius:10px; background:#0c0f14 center/cover no-repeat; flex-shrink:0; box-shadow:inset 0 0 0 1px rgba(255,255,255,0.05); }
.ytStickyText{ min-width:0; }
.ytStickyTitle{ font-weight:700; font-size:15px; color:var(--text, #fff); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.ytStickyChannel{ color:var(--muted, #9aa3b1); font-size:12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.ytStickyHeaderActions{ display:flex; align-items:center; gap:6px; }
.ytStickyBody{ padding:0 12px 12px; display:flex; flex-direction:column; gap:10px; }
.ytSticky.yt-collapsed .ytStickyBody{ display:none; }
.ytSticky.yt-compact .ytStickyControls{ display:none; }
.ytStickyControls{ display:flex; flex-direction:column; gap:10px; }
.ytSeekRow{ display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:8px; }
.ytControlRow{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; justify-content:space-between; }
.ytVolumeControls{ display:flex; align-items:center; gap:8px; }
.ytPlayerHolder{ border-radius:12px; overflow:hidden; background:#000; min-height:160px; }
.ytSticky.yt-size-large .ytPlayerHolder{ min-height:240px; height:240px; }
.ytSticky.yt-size-medium .ytPlayerHolder{ min-height:180px; height:180px; }
.ytSticky.yt-size-small .ytPlayerHolder{ min-height:140px; height:140px; }
.ytSticky.yt-size-tiny .ytPlayerHolder{ min-height:110px; height:110px; }
#ytStickyFrame{ width:100%; height:auto; min-height:180px; aspect-ratio:16/9; }
#ytStickyFrame iframe{ width:100% !important; height:100% !important; display:block; }
.ytTime{ font-variant-numeric:tabular-nums; color:var(--muted, #9aa3b1); font-size:12px; }
.ytSelectLabel{ color:var(--muted, #aab2bf); font-size:12px; display:flex; align-items:center; gap:6px; }
.ytSticky input[type=range]{ accent-color:var(--accent, #ff4f6d); width:100%; }
.ytMiniCard{ width:100%; margin-top:8px; display:flex; align-items:center; gap:10px; padding:10px; border-radius:12px; background:var(--panel, #0f1116); border:1px solid var(--border-subtle, rgba(255,255,255,0.08)); color:var(--text, #fff); cursor:pointer; text-align:left; transition:transform 120ms ease, border-color 120ms ease; }
.ytMiniCard:hover{ border-color:var(--accent, #ff4f6d); transform:translateY(-1px); }
.ytMiniThumb{ width:86px; height:60px; border-radius:10px; background:#0c0f14 center/cover no-repeat; box-shadow:inset 0 0 0 1px rgba(255,255,255,0.04); flex-shrink:0; }
.ytMiniMeta{ flex:1; min-width:0; display:flex; flex-direction:column; gap:4px; }
.ytMiniTitle{ font-weight:700; font-size:15px; color:var(--text, #fff); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.ytMiniChannel{ font-size:12px; color:var(--muted, #9aa3b1); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.ytMiniAction{ font-weight:700; color:var(--accent, #ff4f6d); }
.ytSticky.yt-compact .ytStickyInner,
.ytSticky.yt-collapsed .ytStickyInner{ border-radius:12px; }
.ytSticky.yt-compact .ytStickyHeader,
.ytSticky.yt-collapsed .ytStickyHeader{ padding-bottom:10px; }
.ytSticky.yt-compact .ytStickyThumb,
.ytSticky.yt-collapsed .ytStickyThumb{ width:52px; height:40px; }
.ytSticky.yt-compact .ytStickyTitle,
.ytSticky.yt-collapsed .ytStickyTitle{ font-size:14px; }
.ytSticky.yt-compact .ytStickyChannel{ display:none; }

.ytSticky .iconBtn{ min-width:34px; height:34px; }

@media (max-width: 700px){
  .ytSticky{ margin:6px 0; }
  .ytStickyBody{ padding:0 10px 10px; }
  .ytPlayerHolder{ min-height:140px; }
  #ytStickyFrame{ min-height:150px; }
  .ytMiniThumb{ width:72px; height:50px; }
}

@media (max-width: 700px){
  .dmStrip{ max-width: 50vw; }
}
/* -----------------------------
   DM: make chat fill available area
------------------------------ */

/* The DM panel/modal content should be a full-height column */
#dmModal .modalCard,
.dmModal .modalCard,
#dmPanel,
.dmPanel {
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* The scrollable messages area should take all remaining space */
#dmModal .dmMessages,
#dmModal .dmMsgs,
#dmModal .messages,
.dmPanel .dmMessages,
.dmPanel .dmMsgs,
.dmPanel .messages {
  flex: 1 1 auto;
  min-height: 0;          /* critical so flex children can scroll */
  overflow-y: auto;
  width: 100%;
}

/* The composer/input row stays pinned at the bottom of the DM panel */
#dmModal .dmComposer,
#dmModal .composer,
#dmModal .dmInputRow,
.dmPanel .dmComposer,
.dmPanel .composer,
.dmPanel .dmInputRow {
  flex: 0 0 auto;
  width: 100%;
  position: static;
  bottom: auto;
  z-index: 5;
}
:root{
  --leftDrawerW: 0px;
  --rightDrawerW: 0px;
  --safeB: env(safe-area-inset-bottom, 0px);
  --safeT: env(safe-area-inset-top, 0px);
  --safeL: env(safe-area-inset-left, 0px);
  --safeR: env(safe-area-inset-right, 0px);
}

body.drawer-left-open  { --leftDrawerW: min(86vw, 340px); }
body.drawer-right-open { --rightDrawerW: min(86vw, 340px); }

/* Mobile: when drawers slide in, keep the main composer from overlapping them by
   shrinking and shifting it left/right. */
@media (max-width: 980px){
  /*
    IMPORTANT:
    Earlier mobile rules set `.inputBar` to `width: 100%`.
    When combined with left/right offsets (for drawers), that can overflow the
    viewport and clip the Send button (seen on iOS).

    On mobile we want the composer to size itself between left/right edges,
    so `width` must be `auto`.
  */
  .inputBar{
    position: static;
    left: auto;
    right: auto;
    bottom: auto;
    width: auto;
    box-sizing: border-box;
    z-index: 140; /* below drawers (160), above chat */
    padding-bottom: calc(12px + var(--safeB));
    padding-left: calc(12px + env(safe-area-inset-left, 0px));
    padding-right: calc(12px + env(safe-area-inset-right, 0px));
  }
}

/* --- Mobile safe-area fixes (cumulative patch) --- */
.bottomBar{
  padding-bottom: calc(10px + env(safe-area-inset-bottom));
}

.modalBody{
  padding-bottom: calc(16px + env(safe-area-inset-bottom));
}

.modalContent{
  padding-bottom: calc(16px + env(safe-area-inset-bottom));
}

/* === Mobile: allow profile modal to scroll fully and avoid safe-area overlap === */
.modalBody{
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding-bottom: calc(16px + env(safe-area-inset-bottom));
  min-height: 0;
}
.modalCard{
  max-height: calc(var(--vvhPx) - 20px);
}
.bottomBar{
  padding-bottom: calc(10px + env(safe-area-inset-bottom));
}

/* UI scale: adjust key sizes without CSS transforms (transforms break taps on iOS) */
html, body {
  font-size: calc(16px * var(--uiScale));
}

.topbar{
  height: calc(54px * var(--uiScale)) !important;
  padding: 0 calc(14px * var(--uiScale)) !important;
}

.btn{
  padding: calc(10px * var(--uiScale)) calc(12px * var(--uiScale)) !important;
  font-size: calc(14px * var(--uiScale)) !important;
}

input, textarea, select{
  font-size: calc(14px * var(--uiScale)) !important;
}

.field input, textarea, select{
  padding: calc(11px * var(--uiScale)) calc(12px * var(--uiScale)) !important;
}

.iconBtn{
  width: calc(38px * var(--uiScale)) !important;
  height: calc(38px * var(--uiScale)) !important;
}

/* Keep tap targets sane even when scaled down */
@media (max-width: 360px){
  .btn, .iconBtn{ min-height: 38px; }
}

/* iOS input zoom fix: Safari zooms when inputs < 16px */
@media (hover: none) and (pointer: coarse) {
  input, textarea, select, button {
    font-size: 16px;
  }
  /* keep icons from ballooning */
  .iconBtn, .iconBtn.smallIcon { font-size: 16px; }
}
/* =========================================================
   iOS SAFARI – PREVENT INPUT ZOOM + UI BREAKAGE
   ========================================================= */

/* Stop Safari from resizing text automatically */
html {
  -webkit-text-size-adjust: 100%;
}

/* Prevent iOS zooming when focusing inputs */
@media (hover: none) and (pointer: coarse) {
  input,
  textarea,
  select,
  button {
    font-size: 16px !important;
    line-height: 1.35;
  }

  /* Stabilise chat + DM composer height so keyboard doesn't push UI */
  .composer,
  .dmComposer,
  .messageComposer,
  .chatInputBar {
    min-height: 44px;
    max-height: 44px;
  }

  /* Ensure input fields fill the bar properly */
  .composer input,
  .composer textarea,
  .dmComposer input,
  .dmComposer textarea {
    height: 100%;
  }
}
/* =========================================================
   Viewport shells + scroll invariants
   ========================================================= */

/* One scroll container per shell: chat (.msgs) and menu (.menuContent).
   Heights are anchored to --vvhPx (visualViewport height) so we don't double
   compensate for the iOS keyboard. */

/* Your main app wrapper should be a vertical flex column sized to the visual viewport. */
#app,
.app,
.mainLayout {
  display: flex;
  flex-direction: column;
  height: var(--vvhPx);
  min-height: 0; /* critical */
}

/* The chat/messages area must be allowed to shrink and scroll */
#chatArea,
#messages,
.messages,
.chatPane,
.mainChat {
  flex: 1 1 auto;
  min-height: 0;     /* CRITICAL for iOS */
  overflow: auto;    /* chat scroll stays here */
  -webkit-overflow-scrolling: touch;
}

/* Composer stays at bottom */
#composer,
.composer,
.chatInputBar,
.messageComposer {
  flex: 0 0 auto;
}

/* Theme tier lock styling (VIP) - keep full colors visible */
.themeCard.locked{
  cursor: pointer;
  position: relative;
}
.themeCard.locked::after{
  content: "🔒";
  position: absolute;
  top: 6px;
  right: 6px;
  font-size: 18px;
  pointer-events: none;
}

.themeCard.locked .vipOnlyTag{
  position: absolute;
  left: 8px;
  top: 8px;
  font-size: 11px;
  font-weight: 800;
  letter-spacing: 0.6px;
  padding: 3px 7px;
  border-radius: 999px;
  background: rgba(0,0,0,0.35);
  color: #fff;
  pointer-events: none;
  text-transform: uppercase;
}

/* Preview button (appears on hover/focus; tap works on mobile via click) */
.themeCard .previewBtn{
  position: absolute;
  left: 50%;
  bottom: 10px;
  transform: translateX(-50%);
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.35);
  background: rgba(0,0,0,0.45);
  color: #fff;
  font-size: 12px;
  font-weight: 700;
  cursor: pointer;
  opacity: 0;
  pointer-events: none;
  transition: opacity 120ms ease;
}

.themeCard.locked:hover .previewBtn,
.themeCard.locked:focus-within .previewBtn{
  opacity: 1;
  pointer-events: auto;
}

/* VIP ONLY tag */
.themeCard.locked .vipOnlyTag{
  position: absolute;
  left: 8px;
  top: 8px;
  font-size: 11px;
  font-weight: 800;
  letter-spacing: 0.6px;
  padding: 3px 7px;
  border-radius: 999px;
  background: rgba(0,0,0,0.35);
  color: #fff;
  pointer-events: none;
  text-transform: uppercase;
}

/* Preview button (appears on hover/focus) */
.themeCard .previewBtn{
  position: absolute;
  left: 50%;
  bottom: 10px;
  transform: translateX(-50%);
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.35);
  background: rgba(0,0,0,0.45);
  color: #fff;
  font-size: 12px;
  font-weight: 700;
  cursor: pointer;
  opacity: 0;
  pointer-events: none;
  transition: opacity 120ms ease;
}

.themeCard.locked:hover .previewBtn,
.themeCard.locked:focus-within .previewBtn{
  opacity: 1;
  pointer-events: auto;
}

/* ---- Restored theme definitions (were missing) ---- */

:root[data-theme="Lavender Fog"],
[data-theme="Lavender Fog"] {
  --bg: #f6f1ff;
  --bg2: #eee6ff;
  --panel: #ffffff;
  --panel2: #f3ecff;
  --text: #20132f;
  --muted: #4b2e6a;
  --border: #d9c8ff;
  --shadowColor: rgba(0,0,0,0.10);
  --accent: #b57cff;
  --accent2: #8b5cf6;
  --danger: #dc2626;
  --success: #16a34a;
  --warning: #f59e0b;
  --link: #7c3aed;
  --messageSelfBg: linear-gradient(135deg, #b57cff, #8b5cf6);
  --messageSelfText: #ffffff;
  --messageOtherBg: rgba(255,255,255,0.85);
  --messageOtherText: #20132f;
  --messageSystemBg: rgba(139,92,246,0.10);
  --messageSystemText: #4b2e6a;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(181,124,255,0.18);
  --mentionText: #20132f;
  --btnPrimaryBg: #8b5cf6;
  --btnPrimaryText: #ffffff;
  --btnSecondaryBg: rgba(32,19,47,0.06);
  --btnSecondaryText: #20132f;
  --inputBg: rgba(255,255,255,0.75);
  --inputText: #20132f;
  --inputPlaceholder: rgba(32,19,47,0.55);
  --focusRing: 0 0 0 2px rgba(139,92,246,0.30);
  --shadowSm: 0 4px 12px rgba(0,0,0,0.10);
  --shadowMd: 0 10px 30px rgba(0,0,0,0.12);
  --shadowLg: 0 18px 60px rgba(0,0,0,0.14);
  color-scheme: light;
}

:root[data-theme="Ocean Mist"],
[data-theme="Ocean Mist"] {
  --bg: #e9fbff;
  --bg2: #d7f5ff;
  --panel: #ffffff;
  --panel2: #eefbff;
  --text: #06222b;
  --muted: #0b4b5c;
  --border: #bfe7f2;
  --shadowColor: rgba(0,0,0,0.10);
  --accent: #22c3d6;
  --accent2: #0ea5b7;
  --danger: #dc2626;
  --success: #16a34a;
  --warning: #f59e0b;
  --link: #0ea5b7;
  --messageSelfBg: linear-gradient(135deg, #22c3d6, #0ea5b7);
  --messageSelfText: #06222b;
  --messageOtherBg: rgba(255,255,255,0.88);
  --messageOtherText: #06222b;
  --messageSystemBg: rgba(34,195,214,0.10);
  --messageSystemText: #0b4b5c;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(34,195,214,0.16);
  --mentionText: #06222b;
  --btnPrimaryBg: #0ea5b7;
  --btnPrimaryText: #ffffff;
  --btnSecondaryBg: rgba(6,34,43,0.06);
  --btnSecondaryText: #06222b;
  --inputBg: rgba(255,255,255,0.78);
  --inputText: #06222b;
  --inputPlaceholder: rgba(6,34,43,0.55);
  --focusRing: 0 0 0 2px rgba(14,165,183,0.30);
  --shadowSm: 0 4px 12px rgba(0,0,0,0.10);
  --shadowMd: 0 10px 30px rgba(0,0,0,0.12);
  --shadowLg: 0 18px 60px rgba(0,0,0,0.14);
  color-scheme: light;
}

:root[data-theme="Sunlit Sand"],
[data-theme="Sunlit Sand"] {
  --bg: #fff6e6;
  --bg2: #ffedd0;
  --panel: #ffffff;
  --panel2: #fff3dd;
  --text: #2a1a08;
  --muted: #6b3f16;
  --border: #f3d7ad;
  --shadowColor: rgba(0,0,0,0.10);
  --accent: #f59e0b;
  --accent2: #d97706;
  --danger: #dc2626;
  --success: #16a34a;
  --warning: #b45309;
  --link: #d97706;
  --messageSelfBg: linear-gradient(135deg, #fbbf24, #f59e0b);
  --messageSelfText: #2a1a08;
  --messageOtherBg: rgba(255,255,255,0.88);
  --messageOtherText: #2a1a08;
  --messageSystemBg: rgba(245,158,11,0.12);
  --messageSystemText: #6b3f16;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(245,158,11,0.18);
  --mentionText: #2a1a08;
  --btnPrimaryBg: #f59e0b;
  --btnPrimaryText: #2a1a08;
  --btnSecondaryBg: rgba(42,26,8,0.06);
  --btnSecondaryText: #2a1a08;
  --inputBg: rgba(255,255,255,0.80);
  --inputText: #2a1a08;
  --inputPlaceholder: rgba(42,26,8,0.55);
  --focusRing: 0 0 0 2px rgba(245,158,11,0.30);
  --shadowSm: 0 4px 12px rgba(0,0,0,0.10);
  --shadowMd: 0 10px 30px rgba(0,0,0,0.12);
  --shadowLg: 0 18px 60px rgba(0,0,0,0.14);
  color-scheme: light;
}

:root[data-theme="Crimson Noir"],
[data-theme="Crimson Noir"] {
  --bg: #0b0a0d;
  --bg2: #141018;
  --panel: #17131c;
  --panel2: #1b1522;
  --text: #f7f2f6;
  --muted: #c9b8c6;
  --border: #2a2231;
  --shadowColor: rgba(0,0,0,0.40);
  --accent: #ef4444;
  --accent2: #b91c1c;
  --danger: #ef4444;
  --success: #22c55e;
  --warning: #f59e0b;
  --link: #fb7185;
  --messageSelfBg: linear-gradient(135deg, #ef4444, #b91c1c);
  --messageSelfText: #0b0a0d;
  --messageOtherBg: rgba(255,255,255,0.06);
  --messageOtherText: #f7f2f6;
  --messageSystemBg: rgba(239,68,68,0.10);
  --messageSystemText: #c9b8c6;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(239,68,68,0.16);
  --mentionText: #f7f2f6;
  --btnPrimaryBg: #ef4444;
  --btnPrimaryText: #0b0a0d;
  --btnSecondaryBg: rgba(255,255,255,0.08);
  --btnSecondaryText: #f7f2f6;
  --inputBg: rgba(255,255,255,0.08);
  --inputText: #f7f2f6;
  --inputPlaceholder: rgba(247,242,246,0.55);
  --focusRing: 0 0 0 2px rgba(239,68,68,0.30);
  --shadowSm: 0 4px 12px rgba(0,0,0,0.25);
  --shadowMd: 0 10px 30px rgba(0,0,0,0.35);
  --shadowLg: 0 18px 60px rgba(0,0,0,0.45);
  color-scheme: dark;
}

:root[data-theme="Deep Ocean"],
[data-theme="Deep Ocean"] {
  --bg: #061722;
  --bg2: #04121b;
  --panel: #0a2230;
  --panel2: #0b2736;
  --text: #e6f2ff;
  --muted: #a7c3d9;
  --border: #123447;
  --shadowColor: rgba(0,0,0,0.40);
  --accent: #38bdf8;
  --accent2: #0ea5e9;
  --danger: #ef4444;
  --success: #22c55e;
  --warning: #f59e0b;
  --link: #38bdf8;
  --messageSelfBg: linear-gradient(135deg, #38bdf8, #0ea5e9);
  --messageSelfText: #061722;
  --messageOtherBg: rgba(255,255,255,0.06);
  --messageOtherText: #e6f2ff;
  --messageSystemBg: rgba(56,189,248,0.10);
  --messageSystemText: #a7c3d9;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(56,189,248,0.16);
  --mentionText: #e6f2ff;
  --btnPrimaryBg: #38bdf8;
  --btnPrimaryText: #061722;
  --btnSecondaryBg: rgba(255,255,255,0.08);
  --btnSecondaryText: #e6f2ff;
  --inputBg: rgba(255,255,255,0.08);
  --inputText: #e6f2ff;
  --inputPlaceholder: rgba(230,242,255,0.55);
  --focusRing: 0 0 0 2px rgba(56,189,248,0.30);
  --shadowSm: 0 4px 12px rgba(0,0,0,0.25);
  --shadowMd: 0 10px 30px rgba(0,0,0,0.35);
  --shadowLg: 0 18px 60px rgba(0,0,0,0.45);
  color-scheme: dark;
}

:root[data-theme="Graphite"],
[data-theme="Graphite"] {
  --bg: #111214;
  --bg2: #0d0e10;
  --panel: #1b1d20;
  --panel2: #17191c;
  --text: #f1f5f9;
  --muted: #cbd5e1;
  --border: #2a2e34;
  --shadowColor: rgba(0,0,0,0.40);
  --accent: #a3a3a3;
  --accent2: #d4d4d4;
  --danger: #ef4444;
  --success: #22c55e;
  --warning: #f59e0b;
  --link: #e5e7eb;
  --messageSelfBg: linear-gradient(135deg, #d4d4d4, #a3a3a3);
  --messageSelfText: #111214;
  --messageOtherBg: rgba(255,255,255,0.06);
  --messageOtherText: #f1f5f9;
  --messageSystemBg: rgba(255,255,255,0.08);
  --messageSystemText: #cbd5e1;
  --dm-bubble-bg: var(--bubble);
  --dm-bubble-border: color-mix(in srgb, var(--border) 80%, transparent);
  --dm-bubble-radius: var(--radiusLg);
  --dm-bubble-shadow: 0 8px 18px color-mix(in srgb, var(--shadowColor) 60%, transparent);
  --mentionBg: rgba(255,255,255,0.12);
  --mentionText: #f1f5f9;
  --btnPrimaryBg: #d4d4d4;
  --btnPrimaryText: #111214;
  --btnSecondaryBg: rgba(255,255,255,0.08);
  --btnSecondaryText: #f1f5f9;
  --inputBg: rgba(255,255,255,0.08);
  --inputText: #f1f5f9;
  --inputPlaceholder: rgba(241,245,249,0.55);
  --focusRing: 0 0 0 2px rgba(212,212,212,0.25);
  --shadowSm: 0 4px 12px rgba(0,0,0,0.25);
  --shadowMd: 0 10px 30px rgba(0,0,0,0.35);
  --shadowLg: 0 18px 60px rgba(0,0,0,0.45);
  color-scheme: dark;
}

/* Heart */
body[data-theme="Iris & Lola Neon"] #roomsPanel::before,
body[data-theme="Iris & Lola Neon"] #membersPane::before {
  content: "💚";
  position: absolute;
  left: 50%;
  top: 72%;
  transform: translate(-50%, -50%) rotate(-18deg);
  font-size: clamp(160px, 18vw, 240px);
  line-height: 1;
  opacity: 0.32;
  pointer-events: none;
  z-index: 5;
  filter: drop-shadow(0 0 18px rgba(0, 255, 119, 0.18));
}

/* Text */
body[data-theme="Iris & Lola Neon"] #roomsPanel::after,
body[data-theme="Iris & Lola Neon"] #membersPane::after {
  content: "Iris & Lola";
  position: absolute;
  left: -15%;
  right: -15%;
  top: 72%;
  transform: rotate(-18deg);
  text-align: center;
  font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  font-weight: 900;
  letter-spacing: 0.05em;
  font-size: clamp(26px, 3.4vw, 44px);
  opacity: 0.70;
  color: rgba(0, 255, 119, 0.92);
  text-shadow:
    0 0 10px rgba(0, 255, 119, 0.25),
    0 0 20px rgba(0, 255, 119, 0.18),
    0 0 30px rgba(181, 93, 255, 0.12);
  pointer-events: none;
  z-index: 6;
}
/* NOTE: removed stray Iris & Lola Neon ::after block fragment */
@media (max-width: 520px) {
  body[data-theme="Iris & Lola Neon"]::before {
    display: none;
  }
  body[data-theme="Iris & Lola Neon"]::after {
    top: 42%;
    opacity: 0.80;
  }
}

/* Iris & Lola Neon: keep topbar full-width without breaking right-side buttons */
body[data-theme="Iris & Lola Neon"] .chat { width: 100%; min-width: 0; }
body[data-theme="Iris & Lola Neon"] .topbar { width: 100%; max-width: 100%; box-sizing: border-box; }

.irisLolaHeart {
  margin-left: 6px;
  font-size: 0.9em;
  opacity: 0.75;
  animation: irisLolaHeartPulse 3.5s ease-in-out infinite;
}

@keyframes irisLolaHeartPulse {
  0% { transform: scale(1); opacity: 0.65; }
  50% { transform: scale(1.15); opacity: 0.95; }
  100% { transform: scale(1); opacity: 0.65; }
}

@media (prefers-reduced-motion: reduce) {
  .irisLolaHeart { animation: none; }
}

body[data-theme="Iris & Lola Neon"].iris-lola-together::before {
  animation: irisLolaTogether 6s ease-in-out infinite;
}

@keyframes irisLolaTogether {
  0% { opacity: 0.55; filter: blur(14px) saturate(1.1); }
  50% { opacity: 0.75; filter: blur(16px) saturate(1.35); }
  100% { opacity: 0.55; filter: blur(14px) saturate(1.1); }
}
/* ===== Iris & Lola Neon: MOBILE-SAFE LAYERING FIX ===== */
/* Disable body overlays (mask + fixed can break stacking on mobile) */
body[data-theme="Iris & Lola Neon"]::before { display:none; }
body[data-theme="Iris & Lola Neon"]::after  { display:none; }

/* Render theme overlays inside the chat pane (prevents mobile stacking bugs) */
body[data-theme="Iris & Lola Neon"] .chat{
  position: relative;
  overflow: hidden;
}

/* Heart glow */
body[data-theme="Iris & Lola Neon"] .chat::before{
  content: "";
  position: absolute;
  left: 50%;
  top: 46%;
  width: min(78vmin, 820px);
  height: min(70vmin, 740px);
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 0;

  background:
    radial-gradient(circle at 50% 55%,
      rgba(0, 255, 119, 0.42) 0%,
      rgba(0, 255, 119, 0.16) 22%,
      rgba(181, 93, 255, 0.08) 44%,
      rgba(18, 0, 24, 0.0) 70%);
  filter: blur(16px);

  -webkit-mask-image: url("data:image/svg+xml,%3Csvg%20xmlns=%22http:%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox=%220%200%20100%2090%22%3E%3Cpath%20d=%22M50%2085%20C20%2065%205%2045%2010%2028%20C15%2012%2032%2010%2042%2018%20C46%2022%2049%2027%2050%2031%20C51%2027%2054%2022%2058%2018%20C68%2010%2085%2012%2090%2028%20C95%2045%2080%2065%2050%2085%20Z%22%20fill=%22black%22%2F%3E%3C%2Fsvg%3E");
  mask-image: url("data:image/svg+xml,%3Csvg%20xmlns=%22http:%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox=%220%200%20100%2090%22%3E%3Cpath%20d=%22M50%2085%20C20%2065%205%2045%2010%2028%20C15%2012%2032%2010%2042%2018%20C46%2022%2049%2027%2050%2031%20C51%2027%2054%2022%2058%2018%20C68%2010%2085%2012%2090%2028%20C95%2045%2080%2065%2050%2085%20Z%22%20fill=%22black%22%2F%3E%3C%2Fsvg%3E");
  -webkit-mask-repeat: no-repeat;
  mask-repeat: no-repeat;
  -webkit-mask-size: contain;
  mask-size: contain;
  -webkit-mask-position: center;
  mask-position: center;

  animation: irisLolaChatGlow 4.8s ease-in-out infinite;
}

/* Center text */
body[data-theme="Iris & Lola Neon"] .chat::after{
  content: "I love you";
  position: absolute;
  left: 50%;
  top: 46%;
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 0;

  font-family: "Segoe Script", "Bradley Hand", "Snell Roundhand", "Lucida Handwriting", "Comic Sans MS", "Apple Chancery", cursive;
  font-weight: 600;
  letter-spacing: 0.02em;
  font-size: clamp(34px, 6vw, 64px);
  color: rgba(194, 110, 255, 0.95);
  text-shadow:
    0 0 8px rgba(194, 110, 255, 0.55),
    0 0 18px rgba(194, 110, 255, 0.38),
    0 0 34px rgba(0, 255, 119, 0.18);
  animation: irisLolaChatNeon 2.4s ease-in-out infinite;
  opacity: 0.92;
}

/* Keep UI above overlays */
body[data-theme="Iris & Lola Neon"] .topbar,
body[data-theme="Iris & Lola Neon"] .msgs,
body[data-theme="Iris & Lola Neon"] .composer,
body[data-theme="Iris & Lola Neon"] .chatInputWrap{
  position: relative;
  z-index: 1;
}

@keyframes irisLolaChatGlow{
  0%   { transform: translate(-50%, -50%) scale(0.98); opacity: 0.55; filter: blur(16px) saturate(1.10) brightness(0.98); }
  50%  { transform: translate(-50%, -50%) scale(1.02); opacity: 0.80; filter: blur(16px) saturate(1.40) brightness(0.78); }
  100% { transform: translate(-50%, -50%) scale(0.98); opacity: 0.55; filter: blur(16px) saturate(1.10) brightness(0.98); }
}
@keyframes irisLolaChatNeon{
  0%,100% { opacity: 0.78; transform: translate(-50%, -50%) scale(0.99); }
  50% { opacity: 1; transform: translate(-50%, -50%) scale(1.03); }
}

@media (max-width: 520px){
  body[data-theme="Iris & Lola Neon"] .chat::before{
    width: min(72vmin, 520px);
    height: min(64vmin, 460px);
    filter: blur(12px);
    opacity: 0.45;
  }
  body[data-theme="Iris & Lola Neon"] .chat::after{
    font-size: clamp(26px, 8vw, 44px);
    opacity: 0.80;
    top: 42%;
  }
}
/* ===== Iris & Lola Neon: iOS-safe overlay fix (no body pseudo, no CSS mask) ===== */
body[data-theme="Iris & Lola Neon"]::before,
body[data-theme="Iris & Lola Neon"]::after {
  content: none !important;
  display: none !important;
}

body[data-theme="Iris & Lola Neon"] .chat {
  position: relative;
  overflow: hidden; /* prevents off-canvas bleed */
}

body[data-theme="Iris & Lola Neon"] .chat::before {
  content: "";
  position: absolute;
  left: 50%;
  top: 46%;
  width: min(86vmin, 520px);
  height: min(78vmin, 520px);
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 0;

  /* Heart glow SVG (iOS-safe) */
  background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20400%20360%22%3E%3Cdefs%3E%3CradialGradient%20id%3D%22rg%22%20cx%3D%2250%25%22%20cy%3D%2255%25%22%20r%3D%2262%25%22%3E%3Cstop%20offset%3D%220%25%22%20stop-color%3D%22%2300ff77%22%20stop-opacity%3D%220.70%22/%3E%3Cstop%20offset%3D%2222%25%22%20stop-color%3D%22%2300ff77%22%20stop-opacity%3D%220.26%22/%3E%3Cstop%20offset%3D%2244%25%22%20stop-color%3D%22%23b55dff%22%20stop-opacity%3D%220.12%22/%3E%3Cstop%20offset%3D%2270%25%22%20stop-color%3D%22%23120018%22%20stop-opacity%3D%220%22/%3E%3C/radialGradient%3E%3Cfilter%20id%3D%22blur%22%20x%3D%22-30%25%22%20y%3D%22-30%25%22%20width%3D%22160%25%22%20height%3D%22160%25%22%3E%3CfeGaussianBlur%20stdDeviation%3D%2218%22/%3E%3C/filter%3E%3C/defs%3E%3Cpath%20filter%3D%22url(%23blur)%22%20d%3D%22M200%20330%20C90%20250%2040%20180%2055%20118%20C70%2060%20125%2052%20160%2078%20C180%2092%20193%20112%20200%20130%20C207%20112%20220%2092%20240%2078%20C275%2052%20330%2060%20345%20118%20C360%20180%20310%20250%20200%20330%20Z%22%20fill%3D%22url(%23rg)%22/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: center;
  background-size: contain;

  opacity: 0.55;
  animation: irisLolaChatGlow2 5.2s ease-in-out infinite;
}

body[data-theme="Iris & Lola Neon"] .chat::after {
  content: "I love you";
  position: absolute;
  left: 50%;
  top: 46%;
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 0;

  font-family: "Segoe Script", "Bradley Hand", "Snell Roundhand", "Lucida Handwriting", "Comic Sans MS", "Apple Chancery", cursive;
  font-weight: 600;
  letter-spacing: 0.02em;
  font-size: clamp(30px, 8vw, 54px);
  color: rgba(194, 110, 255, 0.95);
  text-shadow:
    0 0 10px rgba(194, 110, 255, 0.70),
    0 0 22px rgba(194, 110, 255, 0.48),
    0 0 44px rgba(0, 255, 119, 0.16);
  opacity: 0.90;
  animation: irisLolaChatNeon2 2.6s ease-in-out infinite;
}

/* Keep UI above overlays */
body[data-theme="Iris & Lola Neon"] .topbar,
body[data-theme="Iris & Lola Neon"] .msgs,
body[data-theme="Iris & Lola Neon"] .composer,
body[data-theme="Iris & Lola Neon"] .chatInputWrap {
  position: relative;
  z-index: 1;
}

@keyframes irisLolaChatGlow2 {
  0%,100% { transform: translate(-50%, -50%) scale(0.98); opacity: 0.45; filter: saturate(1.05) brightness(1.00); }
  50%     { transform: translate(-50%, -50%) scale(1.02); opacity: 0.72; filter: saturate(1.35) brightness(0.86); }
}

@keyframes irisLolaChatNeon2 {
  0%,100% { opacity: 0.72; transform: translate(-50%, -50%) scale(0.99); }
  50%     { opacity: 1.00; transform: translate(-50%, -50%) scale(1.03); }
}

@media (max-width: 520px) {
  body[data-theme="Iris & Lola Neon"] .chat::before {
    width: min(92vmin, 420px);
    height: min(84vmin, 420px);
    opacity: 0.42;
  }
  body[data-theme="Iris & Lola Neon"] .chat::after {
    top: 44%;
    opacity: 0.82;
  }
}

/* Iris & Lola Space Backdrop */
body[data-theme="Iris & Lola Neon"] {
  background-color: #06010c;
  background-image:
    radial-gradient(circle at 18% 22%,
      rgba(0, 255, 180, 0.12) 0%,
      rgba(0, 255, 180, 0.06) 22%,
      rgba(6, 1, 12, 0) 60%),
    radial-gradient(circle at 78% 28%,
      rgba(181, 93, 255, 0.12) 0%,
      rgba(181, 93, 255, 0.05) 26%,
      rgba(6, 1, 12, 0) 62%),
    radial-gradient(circle at 48% 78%,
      rgba(120, 200, 255, 0.06) 0%,
      rgba(6, 1, 12, 0) 58%),
    linear-gradient(180deg, #120018 0%, #06010c 100%);
  background-repeat: no-repeat;
  background-size: 160vmax 160vmax, 150vmax 150vmax, 140vmax 140vmax, cover;
  background-position: 18% 22%, 78% 28%, 48% 78%, center;
}

body[data-theme="Iris & Lola Neon"].irisLolaCoupleActive {
  animation: irisLolaNebulaPulse 32s ease-in-out infinite;
}

/* Iris & Lola Neon: Performance mode
   - Disable large background-size animations (expensive on mobile GPUs)
   - Keep the same nebula look, just static
*/
body[data-theme="Iris & Lola Neon"].irisLolaPerf{
  animation: none !important;
}

@keyframes irisLolaNebulaPulse {
  0%, 100% {
    background-size: 156vmax 156vmax, 148vmax 148vmax, 136vmax 136vmax, cover;
  }
  50% {
    background-size: 168vmax 168vmax, 158vmax 158vmax, 146vmax 146vmax, cover;
  }
}

body[data-theme="Iris & Lola Neon"].irisLolaPerf.irisLolaCoupleActive{
  animation: none !important;
}

/* Iris & Lola Space Backdrop */
body[data-theme="Iris & Lola Neon"] #app {
  position: relative;
  z-index: 1;
}

.irisLolaStarfield {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  opacity: 0;
  transition: opacity 900ms ease;
}

body[data-theme="Iris & Lola Neon"] .irisLolaStarfield {
  opacity: 1;
}

.irisLolaStar {
  position: absolute;
  top: var(--y);
  left: var(--x);
  width: calc(12px + var(--size));
  height: var(--size);
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(180, 255, 220, 0), rgba(180, 255, 220, 0.12), rgba(181, 93, 255, 0.08));
  opacity: 0;
  transform: translate3d(0, 0, 0) rotate(-28deg);
  animation: irisLolaStarDrift var(--dur) linear infinite;
  animation-delay: var(--delay);
}

/* In perf mode, slow the drifting stars down and reduce alpha a touch */
body[data-theme="Iris & Lola Neon"].irisLolaPerf .irisLolaStar{
  animation-duration: 60s !important;
  opacity: 0;
}

/* Perf mode: fewer stars are spawned by JS; also slow down their drift. */
body[data-theme="Iris & Lola Neon"].irisLolaPerf .irisLolaStar{
  animation-duration: 58s;
  opacity: 0.0;
}

@keyframes irisLolaStarDrift {
  0% { opacity: 0; transform: translate3d(0, 0, 0) rotate(-28deg); }
  8% { opacity: 0.22; }
  42% { opacity: 0.18; }
  72% { opacity: 0; }
  100% { opacity: 0; transform: translate3d(120px, 90px, 0) rotate(-28deg); }
}

/* Iris & Lola Neon — keep it SPACEY (disable older heart/text overlays)
   The theme already has a nebula backdrop + starfield. Over time, extra
   experiments added big heart/text overlays that can drown the space vibe.
   This block force-disables those overlays so the intended starry backdrop
   always shows.
*/
body[data-theme="Iris & Lola Neon"]::before,
body[data-theme="Iris & Lola Neon"]::after,
body[data-theme="Iris & Lola Neon"] .chat::before,
body[data-theme="Iris & Lola Neon"] .chat::after,
body[data-theme="Iris & Lola Neon"] #roomsPanel::before,
body[data-theme="Iris & Lola Neon"] #roomsPanel::after,
body[data-theme="Iris & Lola Neon"] #membersPane::before,
body[data-theme="Iris & Lola Neon"] #membersPane::after {
  content: none !important;
  display: none !important;
}

/* Iris & Lola Couples Theme Enhancement */
body[data-theme="Iris & Lola Neon"].irisLolaCoupleActive .irisLolaTogetherGlow {
  box-shadow:
    0 0 8px rgba(0, 255, 180, 0.12),
    0 0 16px rgba(181, 93, 255, 0.12);
  animation: irisLolaTogetherPulse 24s ease-in-out infinite;
}

@keyframes irisLolaTogetherPulse {
  0%, 100% {
    box-shadow:
      0 0 6px rgba(0, 255, 180, 0.10),
      0 0 12px rgba(181, 93, 255, 0.10);
  }
  50% {
    box-shadow:
      0 0 10px rgba(0, 255, 180, 0.14),
      0 0 20px rgba(181, 93, 255, 0.14);
  }
}

body[data-theme="Iris & Lola Neon"].irisLolaCoupleActive .mItem.irisLolaPartnerRow {
  background: rgba(181, 93, 255, 0.08);
  border-radius: 12px;
}

body[data-theme="Iris & Lola Neon"].irisLolaCoupleActive .irisLolaCoupleMarker {
  text-align: center;
  font-size: 11px;
  opacity: 0.14;
  margin: 2px 0 6px;
  letter-spacing: 0.08em;
}

body[data-theme="Iris & Lola Neon"].irisLolaCoupleActive .chat-main .msgItem.msg--main.couple-partner-msg .bubble,
body[data-theme="Iris & Lola Neon"].irisLolaCoupleActive .chat-dm .dmRow.msg--dm.couple-partner-msg .dmBubble {
  box-shadow:
    0 0 0 1px rgba(0, 255, 180, 0.12),
    0 0 10px rgba(181, 93, 255, 0.08);
}

body[data-theme="Iris & Lola Neon"].irisLolaCoupleActive .irisLolaSharedMoment {
  margin: 6px auto;
  width: fit-content;
  font-size: 12px;
  opacity: 0;
  animation: irisLolaSharedMoment 1.1s ease-out forwards;
}

body[data-theme="Iris & Lola Neon"].irisLolaCoupleActive .irisLolaSharedMoment.no-motion {
  animation: none;
  opacity: 0.12;
}

@keyframes irisLolaSharedMoment {
  0% { opacity: 0; transform: translateY(6px) scale(0.9); }
  35% { opacity: 0.12; }
  100% { opacity: 0; transform: translateY(-6px) scale(1); }
}

@media (prefers-reduced-motion: reduce) {
  body[data-theme="Iris & Lola Neon"].irisLolaCoupleActive {
    animation: none;
  }
  body[data-theme="Iris & Lola Neon"] .chat::before,
  body[data-theme="Iris & Lola Neon"] .chat::after {
    animation: none;
  }
  body[data-theme="Iris & Lola Neon"].irisLolaCoupleActive .irisLolaTogetherGlow,
  body[data-theme="Iris & Lola Neon"].irisLolaCoupleActive .irisLolaSharedMoment {
    animation: none;
  }
  body[data-theme="Iris & Lola Neon"] .irisLolaStarfield {
    opacity: 0;
  }
  body[data-theme="Iris & Lola Neon"] .irisLolaStar {
    animation: none;
    opacity: 0.08;
  }
}

/* Make sure the topbar buttons remain clickable above everything */
body[data-theme="Iris & Lola Neon"] .topbar {
  position: sticky;
  top: 0;
  z-index: 50;
  pointer-events: auto;
}

/* Side-panel watermark using background-image (safe on mobile). */
body[data-theme="Iris & Lola Neon"] #roomsPanel,
body[data-theme="Iris & Lola Neon"] #membersPane {
  background-image: url("data:image/svg+xml,%3Csvg%20xmlns=%22http:%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox=%220%200%20600%20240%22%3E%20%20%3Ctext%20x=%22300%22%20y=%2275%22%20text-anchor=%22middle%22%20%20%20%20%20%20%20%20font-size=%22140%22%20fill=%22rgba(0,255,180,0.12)%22%3E%E2%9C%A8%3C%2Ftext%3E%20%20%3Ctext%20x=%22300%22%20y=%22155%22%20text-anchor=%22middle%22%20%20%20%20%20%20%20%20font-family=%22ui-rounded,%20system-ui,%20-apple-system,%20Segoe%20UI,%20Roboto,%20Arial,%20sans-serif%22%20%20%20%20%20%20%20%20font-weight=%22900%22%20font-size=%2264%22%20letter-spacing=%222%22%20%20%20%20%20%20%20%20fill=%22rgba(181,93,255,0.12)%22%3EIris%20%26%20Lola%3C%2Ftext%3E%3C%2Fsvg%3E");
  background-repeat: no-repeat;
  background-position: center 72%;
  background-size: 120% auto;
}

/* Together-online subtle effect (safe). */
body[data-theme="Iris & Lola Neon"].irisLolaTogether .topbar {
  animation: irisLolaTogetherBar 24s ease-in-out infinite;
}
@keyframes irisLolaTogetherBar {
  0%,100% { box-shadow: 0 0 0 rgba(0,0,0,0); }
  50% { box-shadow: 0 0 22px rgba(0,255,119,0.14); }
}

@media (max-width: 720px) {
  body[data-theme="Iris & Lola Neon"] {
    background-size: 150vmax 150vmax, 140vmax 140vmax, 130vmax 130vmax, cover;
  }
}
@media (max-width: 520px) {
  body[data-theme="Iris & Lola Neon"] {
    background-image:
      radial-gradient(circle at 50% 40%,
        rgba(0, 255, 180, 0.10) 0%,
        rgba(181, 93, 255, 0.08) 32%,
        rgba(6, 1, 12, 0) 70%),
      linear-gradient(180deg, #120018 0%, #06010c 100%);
    background-size: 140vmax 140vmax, cover;
    background-position: center 44%, center center;
  }
  body[data-theme="Iris & Lola Neon"] #roomsPanel,
  body[data-theme="Iris & Lola Neon"] #membersPane {
    background-image: none;
  }
}

/* ---- Core layout guardrails (themes should not override these) */
#topBar, .topBar, header.topBar {
  width: 100%;
  left: 0;
  right: 0;
}
#topRight, .topRight, .topbarRight, .topBarRight {
  pointer-events: auto;
}
#composer, .composer, #msgForm, form#msgForm {
  padding-bottom: env(safe-area-inset-bottom);
}

/* Neon glow for Owner / Co-Owner avatars */
.avatar.role-owner {
  box-shadow:
    0 0 6px rgba(0, 255, 128, 0.7),
    0 0 14px rgba(0, 200, 100, 0.6),
    inset 0 0 10px rgba(0, 120, 60, 0.8);
}

.avatar.role-coowner {
  box-shadow:
    0 0 6px rgba(180, 80, 255, 0.7),
    0 0 14px rgba(255, 100, 200, 0.6),
    inset 0 0 10px rgba(120, 40, 160, 0.8);
}
.avatar {
  border-radius: 999px;
  overflow: hidden;
  display: grid;
  place-items: center;
  flex: 0 0 auto;
}

.avatarImg {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

/* Fallback style uses your existing role gradients */
.avatarFallback {
  font-weight: 700;
  font-size: 14px;
  color: #fff;
}
body.polish-pack .presenceAura{
  position:relative;
  isolation:isolate;
  --aura-color: var(--aura-online);
  --aura-glow: var(--aura-strength);
}
body.polish-pack.polish-auras .presenceAura::after{
  content:"";
  position:absolute;
  inset:2px;
  border-radius:inherit;
  pointer-events:none;
  opacity:0.9;
  transition: box-shadow 180ms ease, opacity 180ms ease, filter 180ms ease;
  box-shadow:
    0 0 0 2px rgb(var(--aura-color) / calc(var(--aura-glow) + 0.08)),
    0 0 10px rgb(var(--aura-color) / var(--aura-glow));
  animation: var(--aura-anim, none);
}
body.polish-pack.polish-auras .presenceAura.isOnline::after{
  --aura-color: var(--aura-online);
  --aura-anim: auraPulse 7s ease-in-out infinite;
}
body.polish-pack.polish-auras .presenceAura.isIdle::after{
  --aura-color: var(--aura-idle);
  --aura-anim: auraPulse 7.5s ease-in-out infinite;
  opacity:0.75;
}
body.polish-pack.polish-auras .presenceAura.isActiveDm::after{
  --aura-color: var(--aura-typing);
  --aura-anim: auraPulse 7s ease-in-out infinite;
}
@keyframes auraPulse{
  0%{ opacity:0.55; }
  50%{ opacity:1; }
  100%{ opacity:0.55; }
}
body.polish-pack.polish-auras .presenceAura.isTyping::after{
  --aura-color: var(--aura-typing);
  --aura-anim: auraPulse 3.6s ease-in-out infinite;
}
body.polish-pack.polish-auras .presenceAura.isDnd::after{
  --aura-color: var(--aura-dnd);
  --aura-anim: auraPulse 6.2s ease-in-out infinite;
}
body.polish-pack.polish-auras .presenceAura.isVip{
  --aura-glow: var(--aura-strength-vip);
}
body.polish-pack.polish-auras .presenceAura.isVip::after{
  animation: var(--aura-anim, none), auraVipShimmer 12s ease-in-out infinite;
}
@keyframes auraVipShimmer{
  0%{ filter: saturate(1); opacity:0.85; }
  50%{ filter: saturate(1.25); opacity:1; }
  100%{ filter: saturate(1); opacity:0.85; }
}
@media (prefers-reduced-motion: reduce){
  body.polish-pack.polish-auras .presenceAura.isTyping::after,
  body.polish-pack.polish-auras .presenceAura.isOnline::after,
  body.polish-pack.polish-auras .presenceAura.isIdle::after,
  body.polish-pack.polish-auras .presenceAura.isActiveDm::after,
  body.polish-pack.polish-auras .presenceAura.isDnd::after,
  body.polish-pack.polish-auras .presenceAura.isVip::after{
    animation:none;
  }
}

/* ==== Profile sheet modal (custom, not a clone) ==== */
.profileSheetHero{
  position: relative;
  margin: 0;
  border-radius: 14px 14px 0 0;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(0,0,0,.25);
  color: var(--profileHeaderText, #fff);
  min-height: 120px;
  width: 100%;
  max-width: none;
  --profileHeaderTextShadow: 0 1px 4px rgba(0,0,0,.6);
  --profileHeaderText: #fff;
  --profileHeaderPillBg: rgba(0,0,0,.32);
  --profileHeaderPillBorder: rgba(255,255,255,.18);
}
.profileSheetHero::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:inherit;
  pointer-events:none;
  opacity:0.65;
  box-shadow:
    0 0 0 1px rgba(var(--userGlowRgb, 88 101 242) / 0.2),
    0 0 24px rgba(var(--userGlowRgb, 88 101 242) / 0.16);
}
@supports (color: color-mix(in srgb, #000, #fff)){
  .profileSheetHero::after{
    box-shadow:
      0 0 0 1px color-mix(in srgb, var(--userGlow) 24%, transparent),
      0 0 24px color-mix(in srgb, var(--userGlow) 18%, transparent);
  }
}
.profileSheetBg{
  position: absolute;
  inset: 0;
  height: 100%;
  background: var(--profileHeaderBg, linear-gradient(135deg, rgba(255,106,43,.75), rgba(43,15,8,.85)));
  filter: saturate(1.08);
  background-repeat: no-repeat;
  background-size: cover;
}
.profileSheetOverlay{
  position: absolute;
  inset: 0;
  pointer-events: none;
  mix-blend-mode: screen;
  opacity: .55;
  z-index: 0;
  background: radial-gradient(120% 80% at 50% 10%, rgba(255,255,255,0.25), transparent 65%);
}
.profileSheetOverlay.role-owner{ box-shadow: 0 0 32px 4px rgba(140, 255, 110, 0.35), inset 0 0 40px rgba(80, 255, 160, 0.24); }
.profileSheetOverlay.role-co-owner{ box-shadow: 0 0 36px 4px rgba(220, 110, 255, 0.30), inset 0 0 46px rgba(160, 90, 255, 0.24); }
.profileSheetOverlay.role-admin{ box-shadow: 0 0 32px 2px rgba(255, 196, 64, 0.32), inset 0 0 36px rgba(255, 140, 40, 0.22); }
.profileSheetOverlay.role-moderator{ box-shadow: 0 0 28px 2px rgba(255, 90, 90, 0.30), inset 0 0 32px rgba(200, 60, 60, 0.22); }
.profileSheetOverlay.role-vip{
  background: linear-gradient(120deg, rgba(110,210,255,0.35), rgba(190,230,255,0.05), rgba(110,210,255,0.35));
  background-size: 220% 220%;
  animation: profileShimmer 8s ease-in-out infinite;
  opacity: .55;
}
.profileSheetOverlay.role-member, .profileSheetOverlay.role-user{ opacity: .18; mix-blend-mode: soft-light; }
.profileSheetOverlay.role-guest{ opacity: .12; mix-blend-mode: soft-light; }

@keyframes profileShimmer{
  0%{ background-position: 0% 50%; }
  50%{ background-position: 100% 50%; }
  100%{ background-position: 0% 50%; }
}

@media (prefers-reduced-motion: reduce){
  .profileSheetOverlay{ animation: none !important; transition: none !important; }
}
.profileSheetContent{
  position: relative;
  z-index: 1;
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 12px;
  padding: 10px 12px;
  align-items: center;
}
.profileSheetContent.compact{
  padding: 8px 12px;
}
.profileAvatarWrap{ position: relative; display: grid; place-items: center; }
.profileLevelRing{
  width: 28px;
  height: 28px;
  border-radius: 999px;
  display: inline-grid;
  place-items: center;
  font-size: 12px;
  font-weight: 700;
  color: var(--profileHeaderText, #fff);
  background:
    radial-gradient(circle at center, rgba(0,0,0,0.55) 55%, transparent 56%),
    conic-gradient(var(--accent, #ff4f6d) var(--levelProgress, 0%), rgba(255,255,255,0.18) 0);
  border: 1px solid rgba(255,255,255,0.35);
  text-shadow: var(--profileHeaderTextShadow, 0 1px 4px rgba(0,0,0,.6));
}
.profileSheetAvatarCard{
  width: 96px;
  height: 96px;
  border-radius: 18px;
  overflow: hidden;
  border: 2px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.40);
  backdrop-filter: blur(10px);
  position: relative;
}
.profileSheetAvatar{
  width: 100%;
  height: 100%;
  display: grid;
  place-items: center;
}
.profileSheetAvatar .avatarWrap{ width: 100%; height: 100%; }
.profileSheetAvatarActions{
  position: absolute;
  left: 8px;
  right: 8px;
  bottom: 8px;
  display: flex;
  gap: 8px;
  padding: 6px;
  background: rgba(0,0,0,.45);
  border-radius: 14px;
}
.profilePresenceDot{
  position: absolute;
  right: -2px;
  bottom: -2px;
  width: 14px;
  height: 14px;
  border-radius: 999px;
  border: 2px solid rgba(0,0,0,.5);
  background: #7f8c8d;
  box-shadow: 0 0 8px rgba(0,0,0,.35);
}
.profilePresenceDot[data-status="online"]{ background: #3bd16f; }
.profilePresenceDot[data-status="away"]{ background: #f5c542; }
.profilePresenceDot[data-status="busy"],
.profilePresenceDot[data-status="dnd"]{ background: #ef4444; }
.profilePresenceDot[data-status="idle"]{ background: #f59e0b; }
.profilePresenceDot[data-status="gaming"]{ background: #8b5cf6; }
.profilePresenceDot[data-status="music"]{ background: #22c55e; }
.profilePresenceDot[data-status="working"]{ background: #38bdf8; }
.profilePresenceDot[data-status="chatting"]{ background: #60a5fa; }
.profilePresenceDot[data-status="lurking"]{ background: #a3a3a3; }

/* Couples Flair */
.couplesFlair{
  position: absolute;
  right: -8px;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  align-items: center;
  gap: 0;
  z-index: 2;
}
.couplesFlairConnector{
  width: 32px;
  height: 3px;
  background: linear-gradient(90deg, #ff6a2b, #2b0f08);
  border-radius: 2px;
  position: relative;
  box-shadow: 0 1px 3px rgba(0,0,0,0.3);
}
.couplesFlairPartner{
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}
.couplesFlairText{
  font-size: 9px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: rgba(255,255,255,0.7);
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  white-space: nowrap;
}
.couplesFlairAvatar{
  width: 48px;
  height: 48px;
  border-radius: 12px;
  overflow: hidden;
  border: 2px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.40);
  backdrop-filter: blur(8px);
  cursor: pointer;
  transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
  display: grid;
  place-items: center;
}
.couplesFlairAvatar:hover,
.couplesFlairAvatar:focus{
  transform: scale(1.08);
  border-color: rgba(255,255,255,.32);
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  outline: none;
}
.couplesFlairAvatar:active{
  transform: scale(0.98);
}
.couplesFlairAvatar .avatarWrap{
  width: 100%;
  height: 100%;
}

@media (max-width: 760px){
  .couplesFlair{
    right: -6px;
  }
  .couplesFlairConnector{
    width: 24px;
    height: 2px;
  }
  .couplesFlairAvatar{
    width: 40px;
    height: 40px;
    border-radius: 10px;
  }
  .couplesFlairText{
    font-size: 8px;
  }
}

.iconPill{
  flex: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 8px 0;
  border-radius: 12px;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.14);
  color: #fff;
}
.iconPill .ico{ width: 18px; height: 18px; display: inline-block; }
.iconPill svg{ width: 18px; height: 18px; display:block; }
.iconPill .iconLabel{
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 0.02em;
}
.vibeRow{ display:flex; gap:6px; flex-wrap:wrap; margin-top:4px; }
.vibeChip{ background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.08); padding:2px 8px; border-radius:999px; font-size:11px; line-height:1.2; color:var(--text,#fff); }
.vibeChip.mini{ font-size:10px; opacity:0.85; }
.profileSheetMeta{
  color: var(--profileHeaderText, #fff);
  padding-bottom: 4px;
  text-shadow: var(--profileHeaderTextShadow, none);
  min-width: 0;
  display: flex;
  flex-direction: column;
  grid-column: 2;
  grid-row: 1;
  padding-right: 44px;
  justify-content: center;
  min-height: 96px;
}
.profileSheetNameRow{
  display:flex;
  gap:10px;
  align-items:center;
  flex-wrap:wrap;
}
.profileSheetMood{
  margin-top: 6px;
  font-size: 12px;
  opacity: .92;
  display:flex;
  align-items:center;
  gap:6px;
}
.profileSheetMood:empty{ display:none; }
#profileMood{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width: 100%; }
.profileSheetName{ font-size: 18px; font-weight: 800; letter-spacing: .2px; text-shadow: var(--profileHeaderTextShadow, none); }
.profileRoleChip{
  font-size: 11px;
  padding: 4px 8px;
  border-radius: 999px;
  border: 1px solid var(--profileHeaderPillBorder, rgba(255,255,255,.18));
  background: var(--profileHeaderPillBg, rgba(255,255,255,.08));
  color: var(--profileHeaderText, #fff);
  text-shadow: var(--profileHeaderTextShadow, none);
}
.profileSheetDetails{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-top:auto;
  order: 5;
}
.profileSheetSub{ order: 2; }
#profileSheetVibes{ order: 3; }
.profileSheetStats{ order: 4; }
.profileSheetNameRow{ order: 1; }
.profileDetail{
  padding:4px 8px;
  border-radius:12px;
  border:1px solid var(--profileHeaderPillBorder, rgba(255,255,255,.12));
  background: var(--profileHeaderPillBg, rgba(0,0,0,.28));
  font-size:12px;
  color: var(--profileHeaderText, #fff);
  text-shadow: var(--profileHeaderTextShadow, none);
}
.profileSheetSub{
  margin-top: 4px;
  font-size: 12px;
  opacity: .9;
  text-shadow: var(--profileHeaderTextShadow, none);
}
.profileSheetStats{
  margin-top: 6px;
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  opacity: .95;
}
.statPill{
  padding: 4px 8px;
  border-radius: 999px;
  border: 1px solid var(--profileHeaderPillBorder, rgba(255,255,255,.12));
  background: var(--profileHeaderPillBg, rgba(0,0,0,.25));
  font-size: 12px;
  color: var(--profileHeaderText, #fff);
  text-shadow: var(--profileHeaderTextShadow, none);
}
.profileHeaderActions{
  display: flex;
  gap: 6px;
  align-self: flex-start;
  position: absolute;
  top: 8px;
  right: 12px;
  margin-left: 0;
}
.profileHeaderActions .iconBtn{
  height: 30px;
  width: 30px;
  padding: 0;
  font-size: 16px;
}

.profileActions{ display:flex; flex-direction:column; gap:4px; margin:4px 0; }
.profileActionTabs{ width:100%; flex-wrap:nowrap; display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap:6px; margin:4px 0 2px; }
.profileCompactTabs .tab{
  min-height: 34px;
  flex: 1 1 auto;
  font-size: 12px;
  padding: 6px 8px;
}
.profileCompactTabs .tab:active{ transform: scale(0.98); }
.profileQuickActions{ 
  display:flex; 
  gap:8px; 
  align-items:center; 
  justify-content:flex-start; 
  flex-wrap:wrap; 
}
.quickActionGroup{ 
  display:flex; 
  gap:8px; 
  align-items:center; 
  flex-wrap:wrap; 
  width: 100%;
}
.quickActionGroup .badge{ height:100%; display:flex; align-items:center; justify-content:center; }
#profileQuickActions{
  padding: 8px 0 4px;
}
.profileInfoGrid{
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
  margin-top: 6px;
}
.profileInfoCard{
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.04);
  padding: 10px 12px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.profileInfoCard.profileInfoWide{
  grid-column: span 2;
}
.profileInfoCard .infoLabel{
  font-size: 11px;
  letter-spacing: .06em;
  text-transform: uppercase;
  color: var(--muted);
}
.profileInfoCard .infoValue{
  font-weight: 800;
  font-size: 14px;
}
.profileInfoCard .vibeRow{
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
.profileBioCard{
  margin-top: 12px;
}
.profileEditToggleRow{
  margin-top: 12px;
  display: flex;
  justify-content: flex-end;
}
.profileEditSection{
  margin-top: 10px;
}

.customizeShell{
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 4px;
}

/* Desktop: use the full width (cards left, active settings right) */
@media (min-width: 900px){
  /* Keep shelves spanning full width (no split columns) */
  .customizeShell{
    display: flex;
    flex-direction: column;
    gap: 14px;
    align-items: stretch;
  }
  .customizeBackBtn{ display:none; }
  .customizeCardGrid{
    grid-template-columns: repeat(3, minmax(220px, 1fr));
  }
  .customizeSubpages{ min-height: 560px; }
}
/* Sticky Text & Identity preview */
.textFxStickyPreview{
  position: sticky;
  top: 0;
  z-index: 2;
  margin: 6px 0 12px;
  padding: 10px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.28);
  backdrop-filter: blur(10px);
}

@media (min-width: 900px){
  #customizeTextPage{
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 12px;
  }
  #customizeTextPage .customizeHeader,
  #customizeTextPage .textFxStickyPreview,
  #customizeTextPage .customizeResetRow{
    grid-column: 1 / -1;
  }
}

.customizeTopBar{
  position: sticky;
  top: 0;
  z-index: 6;
  padding: 6px 0 2px;
  background: linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,0));
  backdrop-filter: blur(8px);
}
.customizeSearchWrap{
  width: 100%;
  display: flex;
  justify-content: center;
}
.customizeSearchWrap input{
  max-width: 520px;
}
.customizeCardGrid{
  width: 100%;
}

.customizeMergedSection{
  margin-top: 14px;
  padding-top: 12px;
  border-top: 1px solid rgba(255,255,255,.08);
}
.customizeSectionTitle{
  font-weight: 900;
  margin: 0 0 10px;
  opacity: .92;
}

/* Make preview compact + sticky in combined page */
.customizeChatPreview,
.textFxStickyPreview{
  position: sticky;
  top: 64px; /* sits below search + shelves */
  z-index: 3;
}

.customizeChatPreview .chatFxPreview{
  transform: scale(.92);
  transform-origin: top left;
}

.customizeTopBar input{
  width: 100%;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.08);
  background: var(--panel2);
  color: var(--text);
}
.customizeCardGrid{
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 12px;
}
.customizeCard{
  text-align: left;
  border-radius: 14px;
  padding: 12px;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.04);
  color: var(--text);
  display: flex;
  flex-direction: column;
  gap: 8px;
  transition: transform .12s ease, border-color .12s ease, background .12s ease;
}
.customizeCard:hover{
  transform: translateY(-1px);
  background: rgba(255,255,255,.06);
  border-color: rgba(255,255,255,.14);
}
.customizeCard .cardTitle{
  font-weight: 800;
  font-size: 14px;
}
.customizeCard .cardHint{
  font-size: 12px;
  color: var(--muted);
}
.customizeCard .cardPreview{
  height: 28px;
  border-radius: 10px;
  background: rgba(0,0,0,.25);
  border: 1px solid rgba(255,255,255,.08);
}
.customizeCard .profileEditPreview{
  background: linear-gradient(135deg, rgba(108, 92, 231, 0.3), rgba(108, 92, 231, 0.1));
  border-color: rgba(108, 92, 231, 0.3);
}
.customizeCard .couplesPreview{
  background: linear-gradient(135deg, rgba(255, 106, 43, 0.3), rgba(200, 50, 200, 0.3));
  border-color: rgba(255, 106, 43, 0.3);
}
.customizeSubpages{
  position: relative;
  min-height: 200px;
}
.customizeSubpage{
  display: none;
  opacity: 0;
  transform: translateX(12px);
  transition: opacity .18s ease, transform .18s ease;
}
.customizeSubpage.active{
  display: block;
  opacity: 1;
  transform: translateX(0);
}
.customizeHeader{
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}
.customizeHeader .title{
  font-size: 16px;
  font-weight: 800;
}
.customizeSection{
  margin-bottom: 12px;
}
.customizeSection > summary{
  cursor: pointer;
  font-weight: 700;
  margin-bottom: 8px;
}
.customizeResetRow{
  display: flex;
  justify-content: flex-end;
  margin-top: 8px;
}
.chatFxPreviewWrap{
  margin-top: 0;
}
.actionList{
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}
.customizeChatLayout{
  display:flex;
  flex-direction: column;
  gap: 12px;
  align-items: stretch;
}

.customizeChatControls{
  flex: 1;
  min-width: 0;
}
.customizeChatPreview{
  width: 100%;
  flex: 0 0 auto;
  position: sticky;
  top: 64px;
  align-self: stretch;
  border-radius: 14px;
  border: 1px solid var(--border);
  padding: 10px;
  background: rgba(0,0,0,.22);
  backdrop-filter: blur(10px);
}

@media (max-width: 760px){
  .customizeCardGrid{
    grid-template-columns: 1fr;
  }
  .profileInfoGrid{
    grid-template-columns: 1fr;
  }
  .profileInfoCard.profileInfoWide{
    grid-column: span 1;
  }
  .profileSections{
    gap: 10px;
  }
  .profileSection summary{
    padding: 10px 12px;
    font-size: 14px;
  }
  .profileSectionBody{
    padding: 10px 12px 12px;
  }
  .quickActionGroup{
  }
  .quickActionGroup .btn{
    flex: 1;
    min-width: 0;
  }
}

@media (max-width: 980px){
  .customizeChatLayout{
    flex-direction: column;
  }
  .customizeChatPreview{
    width: 100%;
    top: 0;
    z-index: 3;
    box-shadow: 0 6px 16px rgba(0,0,0,0.2);
  }
}

@media (prefers-reduced-motion: reduce){
  .customizeSubpage{
    transition: none;
  }
  .customizeCard{
    transition: none;
  }
}
#profileSheetStars{
  display: none !important;
}
#likeCount{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid var(--border);
  background: color-mix(in srgb, var(--panel) 85%, transparent);
  font-weight: 800;
  cursor: pointer;
  user-select:none;
}
#likeCount.active{
  background: color-mix(in srgb, var(--accent) 25%, var(--panel));
}
#likeCount[data-disabled="true"]{
  opacity: 0.6;
  cursor: default;
}

.profileSticky{
  position: sticky;
  top: 0;
  z-index: 2;
  background: var(--panel);
  padding-top: 4px;
  margin: 0 -12px;
  padding-left: 12px;
  padding-right: 12px;
  border-bottom: 1px solid rgba(255,255,255,.05);
}
.profileInfoList{
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.profileInfoRow{
  display: grid;
  grid-template-columns: 18px 1fr auto;
  gap: 10px;
  align-items: center;
  padding: 8px 10px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.06);
  background: rgba(255,255,255,.03);
}
.profileInfoRow .infoIcon{ font-size: 14px; opacity: .8; }
.profileInfoRow .infoLabel{ font-size: 12px; color: var(--muted); font-weight: 700; }
.profileInfoRow .infoValue{ font-size: 12px; font-weight: 800; }
.profileCustomEmpty .panelBox{ border-style: dashed; }

/* Memory timeline */
.memoryTimeline{ display:flex; flex-direction:column; gap:12px; }
.memoryFilters{ position:sticky; top:0; z-index:3; background:var(--panel2); border:1px solid var(--border); border-radius:12px; padding:8px; }
.memoryFilterRow{ display:flex; gap:8px; overflow-x:auto; padding-bottom:2px; }
.memoryFilterRow::-webkit-scrollbar{ height:4px; }
.memoryFilterChip{ border:1px solid var(--border); background:var(--panel); color:var(--text); border-radius:999px; padding:6px 12px; font-size:12px; white-space:nowrap; cursor:pointer; }
.memoryFilterChip.active{ background:var(--accent); color:var(--btnPrimaryText); border-color:transparent; }
.memoryFeatured{ display:flex; flex-direction:column; gap:8px; }
.memoryFeaturedRow{ display:grid; grid-auto-flow:column; grid-auto-columns:minmax(220px, 1fr); gap:10px; overflow-x:auto; padding-bottom:4px; }
.memoryTimelineList{ display:flex; flex-direction:column; gap:10px; }
.memoryCard{ display:grid; grid-template-columns:40px 1fr; gap:10px; align-items:flex-start; }
.memoryCardIcon{ width:36px; height:36px; border-radius:10px; display:grid; place-items:center; background:var(--panel); border:1px solid var(--border); font-size:18px; }
.memoryCardHeader{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
.memoryCardTitle{ font-weight:600; }
.memoryCardMeta{ font-size:12px; color:var(--muted); margin-top:2px; }
.memoryCardDesc{ font-size:13px; color:var(--text); margin-top:6px; }
.memoryPinBtn.active{ color:var(--accent); }
.memoryCard.compact .memoryCardDesc{ display:none; }
.memoryCard.compact .memoryCardMeta{ margin-top:0; }
.memoryEmptyState .panelBox{ border-style:dashed; }

.profileMenu{
  display: grid;
  gap: 10px;
  margin: 8px 0 10px;
}
.profileMenuRow{
  width: 100%;
  display: grid;
  grid-template-columns: 44px 1fr auto;
  grid-template-areas:
    "ico label badge"
    "ico hint badge";
  gap: 2px 10px;
  align-items: center;
  padding: 12px 12px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.04);
  color: #f2f2f2;
  text-align: left;
  transition: transform .12s ease, background .12s ease, border-color .12s ease;
}
.profileMenuRow:hover{
  transform: translateY(-1px);
  background: rgba(255,255,255,.06);
  border-color: rgba(255,255,255,.14);
}
.profileMenuRow:active{ transform: translateY(0px); }
.menuIcon{
  grid-area: ico;
  width: 34px; height: 34px;
  border-radius: 12px;
  display: grid;
  place-items: center;
  background: rgba(0,0,0,.25);
  border: 1px solid rgba(255,255,255,.10);
}
.menuIcon svg{ width: 18px; height: 18px; display:block; }
.menuLabel{ grid-area: label; font-weight: 800; }
.menuHint{ grid-area: hint; font-size: 12px; opacity: .85; }
.vipPill{
  grid-area: badge;
  font-size: 11px;
  padding: 5px 8px;
  border-radius: 999px;
  border: 1px solid rgba(90,170,255,.22);
  background: rgba(90,170,255,.14);
  color: #dfefff;
  align-self: start;
}

/* Smooth panel swap in the modal */
#modal .modalBody > div{ animation: profilePanelIn .18s ease both; }
@keyframes profilePanelIn{
  from { opacity: 0; transform: translateY(6px); }
  to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 760px){
  .profileSheetBg{ height: 100%; }
  .profileSheetContent{
    flex-direction: column;
    align-items: flex-start;
    padding: 10px;
  }
  .profileSheetAvatarCard{ width: 72px; height: 72px; border-radius: 14px; }
  .profileHeaderActions{ align-self: stretch; justify-content: flex-end; }
  .profileMenuRow{ grid-template-columns: 42px 1fr auto; }
  .profileMenu{ margin-bottom: calc(12px + env(safe-area-inset-bottom)); }
}

/* Ensure typing area never grows huge */
.typing, #typing{
  max-height: 22px;
  overflow: hidden;
  padding: 0 10px;
  margin: 0;
  font-size: 12px;
  line-height: 22px;
  pointer-events: none;
}

/* --- DM bubble overflow hardening --- */
.chat-dm .dmMessages{ overflow-x:hidden; }
.chat-dm .dmRow.msg--dm,
.chat-dm .dmBubbleWrap,
.chat-dm .dmBubble{
  min-width:0;
  box-sizing:border-box;
}
.chat-dm .dmBubble{
  max-width:100%;
  overflow-wrap:anywhere;
  word-break:break-word;
}

/* Hide typing overlay while keyboard is open (prevents large dark block on iOS) */
body.kb-open .typing,
body.kb-open #typing{ display:none !important; }

@keyframes msgArrival{
  from{ opacity:0; transform: translateY(-3px); }
  to{ opacity:1; transform: translateY(0); }
}
body.polish-pack.polish-animations .chat-main .msg-new .bubble,
body.polish-pack.polish-animations .chat-dm .msg-new .dmBubble{
  animation: msgArrival 160ms cubic-bezier(.22,.61,.36,1);
  transform-origin: center;
}
.anim-flip{
  transition: transform 180ms cubic-bezier(.22,.61,.36,1);
  will-change: transform;
}
@media (prefers-reduced-motion: reduce){
  body.polish-pack.polish-animations .chat-main .msg-new .bubble,
  body.polish-pack.polish-animations .chat-dm .msg-new .dmBubble{
    animation:none;
  }
}
@media (prefers-reduced-motion: reduce){
  .bubble,
  .dmBubble,
  .btn,
  .iconBtn,
  .anim-flip,
  #modal,
  #modal .modalCard,
  #modal .modalBody{
    transition:none;
  }
  .bubble,
  .dmBubble,
  #modal .modalCard,
  #modal .modalBody{
    transform:none;
    filter:none;
    opacity:1;
  }
}

@keyframes mentionJump{
  0%{ box-shadow: 0 0 0 0 color-mix(in srgb, var(--mentionBg) 65%, transparent); }
  45%{ box-shadow: 0 0 0 6px color-mix(in srgb, var(--mentionBg) 85%, transparent); }
  100%{ box-shadow: 0 0 0 0 transparent; }
}
.chat-main .msgItem.msg--main.msg-mention-hit .bubble{
  animation: mentionJump 1200ms ease;
}
@media (prefers-reduced-motion: reduce){
  .chat-main .msgItem.msg--main.msg-mention-hit .bubble{
    animation: none;
  }
}

/* === DM bubble sizing & alignment FIX === */
.chat-dm .dmRow.msg--dm{
  display:flex;
  width:100%;
}
.chat-dm .dmRow.msg--dm.self{
  justify-content:flex-end;
}
.chat-dm .dmRow.msg--dm:not(.self){
  justify-content:flex-start;
}
.chat-dm .dmBubbleWrap{
  flex:0 1 auto;
  min-width:0;
  max-width:66%;
}
.chat-dm .dmBubble{
  width:fit-content;
  max-width:100%;
}

/* Prevent sender bubbles from pushing off-screen */
.chat-dm .dmRow.msg--dm.self .dmBubbleWrap{
  margin-left:auto;
  margin-right:0;
}

/* === Desktop DM composer restore === */
@media (min-width: 900px){
  .dmComposer,
  #dmComposer,
  .dmPanel .dmComposer,
  #dmModal .dmComposer{
    display:flex !important;
    position:relative;
    bottom:auto;
    z-index:5;
  }

  /* Keep the main room composer pinned on desktop layouts */
  .chatMain,
  main.chatMain,
  .chat{
    display: grid;
    grid-template-rows: auto 1fr auto;
    height: 100%;
    min-height: 0;
  }
  .chat-main .msgs{
    min-height:0;
    overflow-y:auto;
  }
  .inputBar{
    position: relative;
    bottom: auto;
    z-index: 10;
  }
}

/* === DM polish: message grouping, tails, read receipts === */

/* tighter spacing for grouped messages (match main chat's compact feel)
   - remove container gap (which stacks with per-row margins)
   - use small per-row top margins so groups read cleanly without huge whitespace
*/
.chat-dm .dmMessages{ gap:0 !important; }

.chat-dm .dmRow.msg--dm.g-mid,
.chat-dm .dmRow.msg--dm.g-end{
  margin-top: var(--fx-dm-gap-tight, 1px);
}
.chat-dm .dmRow.msg--dm.g-start,
.chat-dm .dmRow.msg--dm.g-solo{
  margin-top: var(--fx-dm-gap, 6px);
}

/* Meta row spacing: align under bubble */
.chat-dm .dmMetaRow{
  display:flex;
  gap:8px;
  align-items:baseline;
  flex-wrap:wrap;
}
.chat-dm .dmMetaRow .reacts{
  display:inline-flex;
  gap:6px;
  margin-left:0px;
  align-items:center;
  flex-wrap:wrap;
}
.chat-dm .dmSeen{
  opacity: .75;
  font-size: 12px;
  margin-left: 6px;
}

/* DM read receipt: a small checkmark next to the timestamp on the last message read by the other person */
.chat-dm .dmReadTick{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size: 12px;
  line-height: 1;
  margin-left: 6px;
  opacity: .85;
}

/* Bubble "tail" only on end/solo messages (g-end / g-solo) */
.chat-dm .dmRow.msg--dm.g-solo .dmBubble,
.chat-dm .dmRow.msg--dm.g-end .dmBubble{
  position: relative;
}

/* left tail (incoming) */
.chat-dm .dmRow.msg--dm:not(.self).g-solo .dmBubble::after,
.chat-dm .dmRow.msg--dm:not(.self).g-end .dmBubble::after{
  content:"";
  position:absolute;
  left:-6px;
  bottom:10px;
  width:12px;
  height:12px;
  background: inherit;
  transform: rotate(45deg);
  border-radius: 3px;
}

/* right tail (self) */
.chat-dm .dmRow.msg--dm.self.g-solo .dmBubble::after,
.chat-dm .dmRow.msg--dm.self.g-end .dmBubble::after{
  content:"";
  position:absolute;
  right:-6px;
  bottom:10px;
  width:12px;
  height:12px;
  background: inherit;
  transform: rotate(45deg);
  border-radius: 3px;
}

/* When grouped, slightly flatten connecting corners */
.chat-dm .dmRow.msg--dm.g-mid .dmBubble,
.chat-dm .dmRow.msg--dm.g-end .dmBubble{
  border-top-left-radius: var(--fx-radius-grouped, 12px);
  border-top-right-radius: var(--fx-radius-grouped, 12px);
}
.chat-dm .dmRow.msg--dm.g-start .dmBubble,
.chat-dm .dmRow.msg--dm.g-mid .dmBubble{
  border-bottom-left-radius: var(--fx-radius-grouped, 12px);
  border-bottom-right-radius: var(--fx-radius-grouped, 12px);
}

/* Don't show tails when grouped mid/start */
.chat-dm .dmRow.msg--dm.g-start .dmBubble::after,
.chat-dm .dmRow.msg--dm.g-mid .dmBubble::after{
  content:none !important;
}

/* === FINAL DM CONSTRAINTS (prevents right overflow + keeps meta/reactions/seen visible) === */
.chat-dm .dmMessages{
  overflow-x:hidden;
  padding-left: 16px;
  padding-right: 16px;
  box-sizing:border-box;
}

.chat-dm .dmRow.msg--dm{
  width:100%;
  max-width:100%;
  display:flex;
  align-items:flex-start;
  gap:8px;
  box-sizing:border-box;
  min-width:0;
}

.chat-dm .dmRow.msg--dm.self{ justify-content:flex-end; }
.chat-dm .dmRow.msg--dm:not(.self){ justify-content:flex-start; }

.chat-dm .dmActionsRail{
  flex:0 0 auto;
  width:34px;
  min-width:34px;
}

.chat-dm .dmBubbleWrap{
  flex:0 1 auto;          /* critical: do NOT grow to full width */
  max-width:66%;          /* never exceed 2/3 of panel */
  min-width:0;
  display:flex;
  flex-direction:column;
}

.chat-dm .dmRow.msg--dm.self .dmBubbleWrap{
  margin-left:auto;       /* pin to right, expand left */
  align-items:flex-end;
}
.chat-dm .dmRow.msg--dm:not(.self) .dmBubbleWrap{
  margin-right:auto;
  align-items:flex-start;
}

.chat-dm .dmBubble{
  display:inline-block;
  width:fit-content;      /* size to content */
  max-width:100%;
}

.chat-dm .dmMetaRow{
  max-width:100%;
  min-width:0;
  overflow:hidden;
}

/* Ensure meta items (username/time/reactions/seen) never render off-panel */
.chat-dm .dmMetaRow > *{
  min-width:0;
  max-width:100%;
}

/* --- Desktop main composer: force visible and positioned correctly --- */
@media (min-width: 900px){
  .inputBar{
    display:flex !important;
    position: relative !important;
    left: auto !important;
    right: auto !important;
    bottom: auto !important;
    width: 100% !important;
    z-index: 140 !important;
    box-sizing: border-box;
  }
  main.chatMain, main{
    min-height:0;
  }
}

/* === Mobile DM overflow fix: prevent combined (actions + bubble) width from pushing right === */
.chat-dm .dmRow.msg--dm.self .dmBubbleWrap{
  margin-left: 0 !important;   /* rely on flex-end, not auto margins */
  margin-right: 0 !important;
}

/* On small screens, reduce paddings and gaps so bubble+actions always fit */
@media (max-width: 900px){
  .chat-dm .dmMessages{
    padding-left: 12px !important;
    padding-right: 12px !important;
  }
  .chat-dm .dmRow.msg--dm{
    gap: 6px !important;
  }
  .chat-dm .dmActionsRail{
    width: 30px !important;
    min-width: 30px !important;
  }
  .chat-dm .dmBubbleWrap{
    max-width: 66% !important;
  }
}

/* === MAIN CHAT: fix message area being constrained/cut off === */
/* Ensure the center chat column can actually give height to the scroll area */
.chat,
.chatMain,
main.chatMain,
main {
  min-height: 0;
}

/* The main chat area must be a column: top content + msgs (flex) + composer (fixed) */
.chatMain,
main.chatMain {
  display: flex;
  flex-direction: column;
  min-height: 0;
  height: 100%;
}

/* The message list is the scrollable region and should fill the available space */
.msgs {
  flex: 1 1 auto;
  min-height: 0;
  overflow-y: auto;
  justify-content: flex-start;
}

/* === FIX: hidden sticky bars should not reserve vertical space === */
.ytSticky.is-hidden{
  display:none !important;
}

/* === Fix: upload preview should not reserve space when not in use === */
#uploadPreview{ display:none; }

/* ================================
   Kick/Ban Restricted View + Appeals
================================== */
#restrictedView{
  min-height: 100vh;
  display: flex;
}
.restrictedShell{
  width: 100%;
  min-height: 100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding: 28px 16px;
}
.restrictedCard{
  width: min(560px, 100%);
  background: rgba(30,30,30,0.9);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 18px;
  padding: 22px 18px;
  box-shadow: 0 16px 60px rgba(0,0,0,0.45);
  text-align:center;
}
.restrictedIcon{
  font-size: 52px;
  margin-bottom: 10px;
}
.restrictedSub{
  opacity: 0.85;
  margin-top: 6px;
}
.restrictedTimer{
  margin-top: 18px;
  padding: 14px 12px;
  border-radius: 14px;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.07);
}
.restrictedTimerLabel{
  font-size: 12px;
  opacity: 0.75;
}
.restrictedTimerValue{
  font-variant-numeric: tabular-nums;
  font-size: 44px;
  letter-spacing: 1px;
  margin-top: 6px;
}
.restrictedReason{
  margin-top: 18px;
  text-align:left;
  padding: 14px 12px;
  border-radius: 14px;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.06);
}
.restrictedReasonText{
  margin-top: 8px;
  word-break: break-word;
}
.restrictedAppeal{
  margin-top: 18px;
  text-align:left;
  padding: 14px 12px;
  border-radius: 14px;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.06);
}
.restrictedAppealHeader{
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap:12px;
}
.appealThread{
  margin-top: 10px;
  max-height: 220px;
  overflow:auto;
  padding: 10px;
  border-radius: 12px;
  background: rgba(0,0,0,0.18);
  border: 1px solid rgba(255,255,255,0.05);
}
.appealMsgRow{
  padding: 8px 10px;
  border-radius: 12px;
  margin-bottom: 8px;
  background: rgba(255,255,255,0.04);
}
.appealMsgRow.admin{
  background: rgba(110,180,255,0.10);
  border: 1px solid rgba(110,180,255,0.14);
}
.appealMsgMeta{
  font-size: 11px;
  opacity: 0.7;
}
.appealMsgBody{
  margin-top: 4px;
  white-space: pre-wrap;
  word-break: break-word;
}
.appealComposer textarea{
  width: 100%;
  margin-top: 10px;
  resize: vertical;
  min-height: 88px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(0,0,0,0.22);
  color: inherit;
  padding: 10px 12px;
}
.msgline{
  font-size: 12px;
  opacity: 0.8;
}

/* Staff panel */
.appealsPanel{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  z-index: 9999;
  display:flex;
  flex-direction:column;
}
.appealsPanelHeader{
  padding: 12px 14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  background: rgba(20,20,20,0.92);
  border-bottom: 1px solid rgba(255,255,255,0.08);
}
.appealsPanelBody{
  flex: 1;
  display:flex;
  gap: 12px;
  padding: 12px;
  overflow:hidden;
}
.appealsList{
  width: min(360px, 42%);
  overflow:auto;
  border-radius: 14px;
  background: rgba(20,20,20,0.72);
  border: 1px solid rgba(255,255,255,0.08);
  padding: 10px;
}
.appealListItem{
  width:100%;
  text-align:left;
  padding: 12px 12px;
  border-radius: 14px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.06);
  color: inherit;
  cursor: pointer;
  margin-bottom: 10px;
}
.appealListItem:hover{
  background: rgba(255,255,255,0.06);
}
.appealsDetail{
  flex:1;
  overflow:auto;
  border-radius: 14px;
  background: rgba(20,20,20,0.72);
  border: 1px solid rgba(255,255,255,0.08);
  padding: 12px;
}
.appealsDetailTop{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 12px;
  margin-bottom: 10px;
}
.appealsDetail textarea{
  width: 100%;
  resize: vertical;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(0,0,0,0.22);
  color: inherit;
  padding: 10px 12px;
  margin-top: 10px;
}
.card{
  margin-top: 12px;
  padding: 12px;
  border-radius: 14px;
  background: rgba(0,0,0,0.16);
  border: 1px solid rgba(255,255,255,0.06);
}
.appealsModlogs .modlogRow{
  padding: 6px 0;
  border-bottom: 1px dashed rgba(255,255,255,0.08);
}
.appealsModlogs .modlogRow:last-child{
  border-bottom: none;
}

@media (max-width: 900px){
  .appealsPanelBody{
    flex-direction: column;
  }
  .appealsList{
    width: 100%;
    max-height: 40vh;
  }
  .appealsDetail{
    width: 100%;
  }
}

/* --- Role Debug panel ----------------------------------------------------- */
.roleDebugPanel{
  position: fixed;
  inset: 10px;
  z-index: 9999;
  background: rgba(10,10,12,.96);
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 16px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  backdrop-filter: blur(10px);
}
.roleDebugTabs{
  display:flex;
  gap:10px;
  padding: 10px 12px;
  border-bottom: 1px solid rgba(255,255,255,.08);
  flex-wrap: wrap;
}
.roleDebugBody{
  flex:1;
  overflow:auto;
  padding: 12px;
}
.roleDebugGrid{
  display:grid;
  grid-template-columns: 260px 1fr;
  gap: 12px;
  margin-top: 10px;
}
@media (max-width: 820px){
  .roleDebugPanel{ inset: 0; border-radius: 0; }
  .roleDebugGrid{ grid-template-columns: 1fr; }
}
.roleDebugList{
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 14px;
  overflow:auto;
  max-height: 70vh;
}
.roleDebugList .item{
  padding: 10px 12px;
  border-bottom: 1px solid rgba(255,255,255,.06);
  cursor:pointer;
}
.roleDebugList .item:hover{ background: rgba(255,255,255,.04); }
.roleDebugList .item.active{ background: rgba(255,255,255,.06); }
.roleDebugDetail{
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 14px;
  padding: 12px;
  min-height: 200px;
}
.roleDebugPerms{
  margin-top: 10px;
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.roleDebugPermGroup{
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 14px;
  padding: 10px;
}
.roleDebugPermGroup .groupTitle{
  font-weight: 700;
  margin-bottom: 6px;
}
.roleDebugPermRow{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 10px;
  padding: 6px 0;
  border-bottom: 1px solid rgba(255,255,255,.06);
}
.roleDebugPermRow:last-child{ border-bottom:none; }
.roleDebugPermRow .toggles{
  display:flex;
  gap: 6px;
}
.roleDebugPermRow label{
  display:flex;
  align-items:center;
  gap: 6px;
  font-size: 12px;
  opacity: .9;
}

/* Staff: Referrals + Role Debug panels (match Appeals panel layout) */
.referralsPanel,
.roleDebugPanel{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  z-index: 9999;
  display:flex;
  flex-direction:column;
}

/* Profile Info tab: no inline moderator tools; use full width */
#viewInfo .modalGrid{ grid-template-columns: 1fr; }
@media (min-width: 900px){
  #viewInfo .infoGrid{ grid-template-columns: repeat(3, 1fr); }
}

/* Toasts */
.toastStack{
  position: fixed;
  right: 16px;
  bottom: calc(16px + env(safe-area-inset-bottom, 0px));
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 10000;
  max-width: min(360px, 92vw);
  pointer-events: none;
}

/* Dice room: milestone/toast popups must never cover the composer/roll button.
   JS will set an exact `top` under the Luck bar; this is a safe CSS fallback. */
body.dice-room .toastStack{
  bottom: auto;
  top: calc(var(--topbarH, 56px) + 64px);
}
.toast{
  pointer-events: auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 10px 12px;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: var(--radiusMd);
  box-shadow: var(--shadowSm);
}
.toastMessage{ font-size: 13px; color: var(--text); }
.toastAction{ font-size: 12px; }
@media (max-width: 640px){
  .toastStack{ left: 12px; right: 12px; }
}

/* Comfort mode (reduced glow + motion) */
body.comfortMode .neonBrand{ text-shadow: none; }
body.comfortMode .chat-main .bubble,
body.comfortMode .chat-dm .dmBubble{
  --fx-glow: 0;
  --fx-text-glow: 0;
}
body.comfortMode .reactPill{ padding: 3px 6px; font-size: 11px; }
body.comfortMode #confettiLayer,
body.comfortMode #confettiLayer .confetti{ display: none; }
body.comfortMode .clReactBtn.pop,
body.comfortMode .faqReactionBtn.pop{ animation: none; }
body.comfortMode .presenceAura{ box-shadow: none !important; }
body.comfortMode .profileSheetOverlay,
body.comfortMode .chat-main .msg-new .bubble,
body.comfortMode .chat-dm .msg-new .dmBubble{
  animation-duration: 0.12s;
  transition-duration: 0.12s;
}
body.comfortMode[data-theme="Iris & Lola Neon"] .irisLolaHeart,
body.comfortMode[data-theme="Iris & Lola Neon"].iris-lola-together::before,
body.comfortMode[data-theme="Iris & Lola Neon"] .chat::before,
body.comfortMode[data-theme="Iris & Lola Neon"] .chat::after{
  animation: none !important;
  filter: none !important;
}

/* Inline staff actions overlay inside profile modal */
.inlineModalOverlay{ position:absolute; inset:0; background: color-mix(in srgb, var(--bg) 55%, transparent); display:none; align-items:center; justify-content:center; padding:14px; z-index: 5; }
.inlineModalOverlay.show{ display:flex; }
.inlineModalCard{ width: min(820px, calc(100% - 10px)); max-height: calc(100% - 10px); overflow:auto; -webkit-overflow-scrolling: touch; }
.inlineModalHeader{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px; }

/* ---- Couples (opt-in) */
.coupleBadge{
  margin-left:6px;
  font-size: 12px;
  line-height: 1;
  opacity: 0.95;
}

.coupleAura{
  position: relative;
}
.coupleAura::after{
  content:"";
  position:absolute;
  inset:-3px;
  border-radius: 999px;
  box-shadow: 0 0 10px rgba(200, 120, 255, 0.55), 0 0 18px rgba(120, 200, 255, 0.25);
  pointer-events:none;
  animation: couplePulse 2.2s ease-in-out infinite;
}
@keyframes couplePulse{
  0%,100%{ transform: scale(1); opacity: .55; }
  50%{ transform: scale(1.05); opacity: .85; }
}

.coupleChip{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding: 4px 8px;
  border-radius: 999px;
  font-size: 12px;
  opacity: 0.95;
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.10);
}
.coupleCardBody{
  display:flex;
  flex-direction:column;
  gap:8px;
  margin-top:6px;
}
.coupleCardHeader{
  display:flex;
  gap:12px;
  align-items:center;
}
.coupleCardAvatars{
  display:flex;
  gap:6px;
  align-items:center;
}
.coupleCardAvatars .avatarImg,
.coupleCardAvatars .avatarFallback{
  width:42px;
  height:42px;
  border-radius:999px;
  flex:0 0 auto;
}
.coupleCardMeta{
  display:flex;
  flex-direction:column;
  gap:4px;
}
.coupleCardTitleRow{
  display:flex;
  align-items:center;
  gap:6px;
  flex-wrap:wrap;
}
.coupleCardTitle{
  font-weight:600;
  font-size:14px;
}
.coupleCardSub{
  font-size:12px;
  opacity:0.78;
}
.coupleCardBio{
  font-size:12px;
  opacity:0.9;
  line-height:1.4;
}
.coupleBadge.small{
  margin-left:0;
  font-size:12px;
}

/* Simple switch for settings toggles */
.toggleRow{
  display:flex;
  align-items:center;
  gap:10px;
  margin-top:10px;
}
.toggleLabel{
  font-size: 13px;
  opacity: 0.92;
}

.switch{
  position: relative;
  display: inline-block;
  width: 38px;
  height: 22px;
  flex: 0 0 auto;
}
.switch input{
  opacity: 0;
  width: 0;
  height: 0;
}
.switch .slider{
  position:absolute;
  cursor:pointer;
  top:0; left:0; right:0; bottom:0;
  background: rgba(255,255,255,0.18);
  border: 1px solid rgba(255,255,255,0.18);
  transition: .2s;
  border-radius: 999px;
}
.switch .slider:before{
  position:absolute;
  content:"";
  height: 16px;
  width: 16px;
  left: 3px;
  bottom: 2px;
  background: rgba(255,255,255,0.92);
  transition: .2s;
  border-radius: 999px;
}
.switch input:checked + .slider{
  background: rgba(150, 90, 255, 0.35);
  border-color: rgba(150, 90, 255, 0.45);
}
.switch input:checked + .slider:before{
  transform: translateX(16px);
}

.couplesPendingRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding: 8px 0;
  border-top: 1px solid rgba(255,255,255,0.08);
}
.couplesPendingRow:first-child{ border-top: none; }
.couplesPendingLeft{
  font-size: 13px;
  opacity: 0.92;
}
.couplesPendingRight{
  display:flex;
  gap:8px;
  align-items:center;
}

/* Couples status row */
.couplesStatusRow select{padding:10px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.15);background:rgba(0,0,0,.25);color:inherit}
.couplesStatusRow input{min-width:0}

/* Couples: members list pairing polish */
.pillCount{
  display:inline-flex;
  min-width:18px;
  height:18px;
  padding:0 6px;
  border-radius:999px;
  align-items:center;
  justify-content:center;
  font-size:12px;
  line-height:18px;
  margin-left:6px;
  background:rgba(255,255,255,0.18);
  border:1px solid rgba(255,255,255,0.18);
}

.mItem.coupleGroupTop,
.mItem.coupleGroupBottom{
  position:relative;
}

.mItem.coupleGroupTop{
  border-top-left-radius:14px;
  border-top-right-radius:14px;
}
.mItem.coupleGroupBottom{
  border-bottom-left-radius:14px;
  border-bottom-right-radius:14px;
}

.mItem.coupleGroupTop::before,
.mItem.coupleGroupBottom::before{
  content:"";
  position:absolute;
  inset:-2px -6px;
  border-radius:16px;
  pointer-events:none;
  background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  opacity:0.85;
}

.mItem.coupleGroupBottom::before{
  opacity:0.55;
}

.mItem.coupleGroupTop::after{
  content:"";
  position:absolute;
  left:14px;
  right:14px;
  bottom:-1px;
  height:1px;
  background:rgba(255,255,255,0.10);
  pointer-events:none;
}

/* Shared aura */
.mItem.coupleAura .mAvatar{
  box-shadow:0 0 0 2px rgba(255,255,255,0.18), 0 0 12px rgba(255,255,255,0.16);
  border-radius:999px;
}

/* Heart hop (subtle) */
@keyframes coupleHopAnim{
  0%{ transform:translateY(0); }
  50%{ transform:translateY(-2px); }
  100%{ transform:translateY(0); }
}
.mItem.coupleHop .mAvatar{
  animation:coupleHopAnim 2.2s ease-in-out infinite;
}

/* Couples badge/mood */
.coupleBadge, .coupleMood{
  margin-right:6px;
  font-size:14px;
  opacity:0.95;
}

/* --- Room event banner --- */
.roomEventBanner{
  width: 100%;
  padding: 6px 10px;
  border-radius: 14px;
  margin: 6px 0 0 0;
  font-size: 13px;
  line-height: 1.2;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.12);
  backdrop-filter: blur(8px);
}
.roomEventBanner .meta{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
.roomEventBanner .tag{ font-weight:700; opacity:0.9; }
.roomEventBanner .count{ opacity:0.85; }

/* --- Owner panels --- */
.ownerPanel{
  position: fixed;
  inset: 0;
  z-index: 10000;
  display: flex;
  flex-direction: column;
  background: rgba(0,0,0,0.70);
  backdrop-filter: blur(10px);
  pointer-events: auto;
}
.ownerPanelHeader{
  display:flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
  padding: 14px 14px;
  border-bottom: 1px solid rgba(255,255,255,0.12);
}
.ownerPanelBody{
  padding: 14px;
  overflow: auto;
}
.flagsGrid{
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 10px;
}
.flagCard{
  padding: 12px;
  border-radius: 14px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.12);
}
.flagRow{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
.switch{
  width: 46px; height: 26px;
  border-radius: 26px;
  background: rgba(255,255,255,0.18);
  border: 1px solid rgba(255,255,255,0.20);
  position: relative;
  cursor: pointer;
}
.switch::after{
  content:"";
  width: 20px; height: 20px;
  border-radius: 20px;
  background: rgba(255,255,255,0.92);
  position:absolute;
  top: 2px; left: 3px;
  transition: transform 160ms ease;
}
.switch.on{ background: rgba(120,255,180,0.25); border-color: rgba(120,255,180,0.35); }
.switch.on::after{ transform: translateX(18px); }

.tableWrap{ overflow:auto; margin-top: 10px; }
.table{ width:100%; border-collapse: collapse; font-size: 12px; }
.table th, .table td{ text-align:left; padding: 8px 10px; border-bottom: 1px solid rgba(255,255,255,0.10); white-space: nowrap; }
.table th{ opacity: 0.9; font-weight: 700; }

/* --- Daily challenges --- */
.dailyList{ display:flex; flex-direction: column; gap: 10px; }
.dailyItem{
  padding: 12px;
  border-radius: 14px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.12);
  display:flex;
  justify-content: space-between;
  gap: 12px;
}
.dailyLeft .title{ font-weight: 700; }
.dailyLeft .small{ opacity: 0.85; }
.dailyRight{ display:flex; align-items:center; gap: 10px; flex-wrap: wrap; justify-content: flex-end; }
.badge{
  padding: 4px 8px;
  border-radius: 999px;
  font-size: 12px;
  background: rgba(255,255,255,0.10);
  border: 1px solid rgba(255,255,255,0.14);
}
.badge.done{ background: rgba(120,255,180,0.18); border-color: rgba(120,255,180,0.30); }

/* --- Ambient effects (very subtle; respects reduce motion in JS) --- */
body.ambientfx.ambient-main{ }
body.ambientfx.ambient-diceroom{ }
body.ambientfx.ambient-music{ }
body.ambientfx.ambient-nsfw{ }

/* --- Audio attachments (waveform player) --- */
.audioAttachment{
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:10px 12px;
  border-radius:14px;
  background: rgba(255,255,255,0.06);
  max-width: 360px;
}

.audioAttachment .audioPlayBtn{
  align-self:flex-start;
  width:42px;
  height:42px;
  border-radius:12px;
  border:0;
  cursor:pointer;
  font-size:18px;
}

.audioAttachment .audioWave{
  width:100%;
  min-width: 220px;
  max-width: 100%;
}

.audioAttachment .audioMeta{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  font-size:12px;
  opacity:0.9;
}

.audioAttachment .audioDownload{
  text-decoration:none;
  font-size:12px;
}

.audioAttachment.playing{
  transform: translateZ(0);
}

.audioAttachment .audioNative{
  width:100%;
}

/* === Media Bottom Sheet === */
.media-sheet-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.45);
  z-index: 9998;
  touch-action: none;
}

.media-sheet {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(
    180deg,
    var(--panel-bg, #111),
    var(--panel-bg-alt, #0b0b0b)
  );
  border-radius: 18px 18px 0 0;
  padding: 10px 16px 20px;
  z-index: 9999;
  transform: translateY(100%);
  transition: transform 0.28s cubic-bezier(.2,.8,.2,1);
  will-change: transform;
}

.media-sheet.show { transform: translateY(0); }

.media-sheet-handle {
  width: 42px;
  height: 4px;
  background: rgba(255,255,255,0.35);
  border-radius: 2px;
  margin: 8px auto 14px;
}

.media-sheet-btn {
  width: 100%;
  padding: 14px;
  margin-bottom: 10px;
  border-radius: 14px;
  background: rgba(255,255,255,0.06);
  color: #fff;
  border: none;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 16px;
}

.media-sheet-btn:active {
  background: rgba(255,255,255,0.12);
}

.media-icon { font-size: 20px; }

.media-sheet-cancel {
  width: 100%;
  padding: 14px;
  border-radius: 14px;
  background: rgba(255,80,80,0.15);
  color: #ff6b6b;
  border: none;
  font-size: 16px;
}

/* === Voice Recorder Modal === */
.voice-rec-backdrop{
  position:fixed; inset:0;
  background:rgba(0,0,0,.55);
  z-index: 9998;
}
.voice-rec-modal{
  position:fixed; inset:0;
  display:flex; align-items:flex-end; justify-content:center;
  padding:16px;
  z-index: 9999;
}
.voice-rec-modal.hidden,
.voice-rec-backdrop.hidden{ display:none; }

.voice-rec-card{
  width:min(520px, 100%);
  background: rgba(20,20,24,.98);
  border: 1px solid rgba(255,255,255,.12);
  border-radius: 16px;
  box-shadow: 0 12px 40px rgba(0,0,0,.55);
  overflow:hidden;
}
.voice-rec-head{
  display:flex; align-items:center; justify-content:space-between;
  padding:12px 14px;
  border-bottom: 1px solid rgba(255,255,255,.10);
}
.voice-rec-title{ font-weight:700; letter-spacing:.2px; }
.voice-rec-x{
  border:none; background:transparent;
  color: inherit;
  font-size:18px;
  padding:6px 10px;
  border-radius: 10px;
}
.voice-rec-x:active{ transform: scale(.98); }

.voice-rec-body{ padding: 14px; }
.voice-rec-status{
  display:flex; align-items:center; justify-content:space-between;
  gap:12px;
  padding:12px;
  border-radius: 14px;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.10);
}
.voice-rec-timer{ font-variant-numeric: tabular-nums; font-weight:700; }
.voice-rec-wave{
  flex:1;
  height: 10px;
  border-radius: 999px;
  background: rgba(255,255,255,.10);
  overflow:hidden;
  position: relative;
}
.voice-rec-wave::before{
  content:"";
  position:absolute; inset:0;
  transform: translateX(-60%);
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.50), transparent);
  animation: voiceWave 1.1s linear infinite;
  opacity: 0;
}
.voice-rec-wave.recording::before{ opacity: 1; }

@keyframes voiceWave{
  0%{ transform: translateX(-60%); }
  100%{ transform: translateX(60%); }
}

.voice-rec-audio{ width:100%; margin-top:12px; }
.voice-rec-audio.hidden{ display:none; }

.voice-rec-actions{
  display:flex; gap:10px; flex-wrap:wrap;
  margin-top:12px;
}
.voice-rec-actions .btn{ flex:1; min-width: 120px; }

@media (min-width: 720px){
  .voice-rec-modal{ align-items:center; }
}

/* Survival: prevent panels from running off-screen */
body.survival-room .survivalLogFeed{ max-height: calc(100vh - 220px); overflow:auto; }
body.survival-room .survivalArena{ max-height: calc(100vh - 160px); overflow:auto; }

/* =====================================================================

/* =====================================================================
   Iris & Lola Neon (SPACE REBUILD v3)
   Mystical green/purple space backdrop, subtle stars, occasional
   shooting-star streaks, and centered "I love you".
   iOS/Android safe: no BODY pseudo-elements.
   ===================================================================== */

/* Global page nebula */
body[data-theme="Iris & Lola Neon"]{
  background-color: #05000b !important;
  background-image:
    radial-gradient(900px 700px at 18% 18%, rgba(0,255,170,.14), rgba(0,255,170,0) 60%),
    radial-gradient(850px 620px at 82% 22%, rgba(171,85,255,.16), rgba(171,85,255,0) 62%),
    radial-gradient(700px 540px at 52% 78%, rgba(110,210,255,.08), rgba(110,210,255,0) 60%),
    radial-gradient(520px 420px at 18% 84%, rgba(0,255,170,.08), rgba(0,255,170,0) 62%),
    linear-gradient(180deg, #120018 0%, #05000b 100%) !important;
  background-repeat: no-repeat !important;
  background-size: 160vmax 160vmax, 150vmax 150vmax, 140vmax 140vmax, 120vmax 120vmax, cover !important;
  background-position: 18% 18%, 82% 22%, 52% 78%, 18% 84%, center !important;
  background-attachment: scroll !important;
  overflow-x: hidden;
}

/* Keep iOS stable: never use body pseudo-elements for this theme */
body[data-theme="Iris & Lola Neon"]::before,
body[data-theme="Iris & Lola Neon"]::after{
  content: none !important;
  display: none !important;
}

/* Let the nebula show through */
body[data-theme="Iris & Lola Neon"] #app{
  background: transparent !important;
}

/* Starfield + shooting stars (injected by app.js) */
body[data-theme="Iris & Lola Neon"] .irisLolaStarfield{
  opacity: .92 !important;
  filter: saturate(1.05) brightness(1.02);
}

body[data-theme="Iris & Lola Neon"] .irisLolaStar{
  height: max(1px, var(--size)) !important;
  width: calc(28px + (var(--size) * 10)) !important;
  background: linear-gradient(90deg,
    rgba(0,0,0,0),
    rgba(0,255,170,.24),
    rgba(171,85,255,.18),
    rgba(0,0,0,0)) !important;
  box-shadow:
    0 0 8px rgba(0,255,170,.10),
    0 0 14px rgba(171,85,255,.08);
}

/* Main chat area: soft glass + gentle neon outline */
body[data-theme="Iris & Lola Neon"] .chat{
  position: relative;
  isolation: isolate;
  background: rgba(10, 2, 16, 0.38) !important;
  border: 1px solid rgba(181, 93, 255, 0.14) !important;
  box-shadow:
    0 0 0 1px rgba(0, 255, 180, 0.08),
    0 0 18px rgba(0, 255, 180, 0.10),
    0 0 28px rgba(171, 85, 255, 0.08);
  overflow: hidden;
}

/* Nebula glow behind chat content */
body[data-theme="Iris & Lola Neon"] .chat::before{
  content: "" !important;
  display: block !important;
  position: absolute;
  inset: -18px;
  pointer-events: none;
  z-index: 0;
  background:
    radial-gradient(520px 420px at 22% 18%, rgba(0,255,170,.14), rgba(0,255,170,0) 62%),
    radial-gradient(560px 440px at 78% 28%, rgba(171,85,255,.16), rgba(171,85,255,0) 64%),
    radial-gradient(420px 340px at 48% 86%, rgba(130,220,255,.06), rgba(130,220,255,0) 62%),
    radial-gradient(2px 2px at 18% 26%, rgba(255,255,255,.10), rgba(0,0,0,0) 70%),
    radial-gradient(1.5px 1.5px at 68% 42%, rgba(255,255,255,.08), rgba(0,0,0,0) 70%),
    radial-gradient(2px 2px at 44% 78%, rgba(255,255,255,.06), rgba(0,0,0,0) 70%);
  filter: blur(2px) saturate(1.08);
  opacity: .85;
  animation: irisLolaNebulaDriftV3 28s ease-in-out infinite;
}

@keyframes irisLolaNebulaDriftV3{
  0%,100%{ transform: translate3d(0,0,0) scale(1.02); opacity: .78; }
  50%    { transform: translate3d(10px,-6px,0) scale(1.06); opacity: .92; }
}

/* Centered "I love you" in a cute handwritten vibe + green glow */
body[data-theme="Iris & Lola Neon"] .chat::after{
  content: "I love you" !important;
  display: block !important;
  position: absolute;
  left: 50%;
  top: 46%;
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 0;

  font-family: "Segoe Script", "Bradley Hand", "Snell Roundhand", "Apple Chancery", "Lucida Handwriting", cursive;
  font-weight: 650;
  letter-spacing: .02em;
  font-size: clamp(26px, 7vw, 54px);
  color: rgba(0,255,170,.92);
  text-shadow:
    0 0 10px rgba(0,255,170,.55),
    0 0 22px rgba(0,255,170,.32),
    0 0 38px rgba(171,85,255,.18);
  opacity: .86;
  animation: irisLolaLovePulseV3 2.9s ease-in-out infinite;
}

@keyframes irisLolaLovePulseV3{
  0%,100%{ opacity:.72; transform: translate(-50%, -50%) scale(.99); }
  50%    { opacity:1;   transform: translate(-50%, -50%) scale(1.03); }
}

/* Keep actual UI above backdrop layers */
body[data-theme="Iris & Lola Neon"] .topbar,
body[data-theme="Iris & Lola Neon"] .msgs,
body[data-theme="Iris & Lola Neon"] .composer,
body[data-theme="Iris & Lola Neon"] .chatInputWrap{
  position: relative;
  z-index: 1;
}

/* Cute, stable drawer accents (Rooms + Members): faint sparkles + a soft sweep */
body[data-theme="Iris & Lola Neon"] #roomsPanel,
body[data-theme="Iris & Lola Neon"] #membersPane{
  position: relative;
  background: rgba(8, 2, 16, .68) !important;
  backdrop-filter: blur(10px);
  box-shadow:
    0 0 0 1px rgba(0,255,170,.10),
    0 0 18px rgba(171,85,255,.10);
}

body[data-theme="Iris & Lola Neon"] #roomsPanel::before,
body[data-theme="Iris & Lola Neon"] #membersPane::before{
  content: "" !important;
  display: block !important;
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  opacity: .40;
  background-image:
    radial-gradient(circle, rgba(255,255,255,0.10) 0 1px, rgba(0,0,0,0) 2px);
  background-size: 42px 42px;
  background-position: 0 0;
  animation: irisLolaSparkleScrollV3 44s linear infinite;
}

body[data-theme="Iris & Lola Neon"] #roomsPanel::after,
body[data-theme="Iris & Lola Neon"] #membersPane::after{
  content: "" !important;
  display: block !important;
  position: absolute;
  left: -40%;
  top: -18%;
  width: 220%;
  height: 84px;
  pointer-events: none;
  z-index: 0;
  background: linear-gradient(90deg, rgba(0,0,0,0), rgba(0,255,170,0.10), rgba(180,90,255,0.08), rgba(0,0,0,0));
  opacity: .32;
  transform: rotate(-6deg);
  animation: irisLolaDrawerSweepV3 14s ease-in-out infinite;
}

@keyframes irisLolaSparkleScrollV3{
  0%{ transform: translate3d(0,0,0); }
  100%{ transform: translate3d(42px, 42px, 0); }
}

@keyframes irisLolaDrawerSweepV3{
  0%,100%{ transform: translateX(-6%) rotate(-6deg); opacity: .22; }
  50%    { transform: translateX(6%) rotate(-6deg);  opacity: .36; }
}

body[data-theme="Iris & Lola Neon"] #roomsPanel > *,
body[data-theme="Iris & Lola Neon"] #membersPane > *{
  position: relative;
  z-index: 1;
}

@media (max-width: 520px){
  body[data-theme="Iris & Lola Neon"] .chat::before{ inset:-10px; }
  body[data-theme="Iris & Lola Neon"] .chat::after{ top: 44%; }
}

@media (prefers-reduced-motion: reduce){
  body[data-theme="Iris & Lola Neon"] .chat::before,
  body[data-theme="Iris & Lola Neon"] .chat::after,
  body[data-theme="Iris & Lola Neon"] #roomsPanel::before,
  body[data-theme="Iris & Lola Neon"] #membersPane::before,
  body[data-theme="Iris & Lola Neon"] #roomsPanel::after,
  body[data-theme="Iris & Lola Neon"] #membersPane::after{
    animation: none !important;
  }
}

/* =====================================================================
   Iris & Lola Neon (SPACE REBUILD v3)
   Mystical green/purple space backdrop, subtle stars, occasional
   shooting-star streaks, and centered "I love you".
   iOS/Android safe: no BODY pseudo-elements.
   ===================================================================== */

/* Global page nebula */
body[data-theme="Iris & Lola Neon"]{
  background-color: #05000b !important;
  background-image:
    radial-gradient(900px 700px at 18% 18%, rgba(0,255,170,0.14), rgba(0,255,170,0) 60%),
    radial-gradient(850px 620px at 82% 22%, rgba(171,85,255,0.16), rgba(171,85,255,0) 62%),
    radial-gradient(700px 540px at 52% 78%, rgba(110,210,255,0.08), rgba(110,210,255,0) 60%),
    linear-gradient(180deg, #120018 0%, #05000b 100%) !important;
  background-repeat: no-repeat !important;
  background-size: 160vmax 160vmax, 155vmax 155vmax, 140vmax 140vmax, cover !important;
  background-position: 18% 18%, 82% 22%, 52% 78%, center !important;
  overflow-x: hidden;
}

/* Safety: never use body pseudos for this theme (keeps iOS stable) */
body[data-theme="Iris & Lola Neon"]::before,
body[data-theme="Iris & Lola Neon"]::after{
  content: none !important;
  display: none !important;
}

/* Let the space backdrop show through */
body[data-theme="Iris & Lola Neon"] #app{ background: transparent !important; }

/* Starfield + shooting stars are injected by app.js (ensureIrisLolaStarfield).
   Keep them subtle and not too busy. */
body[data-theme="Iris & Lola Neon"] .irisLolaStarfield{
  opacity: 0.85 !important;
  filter: saturate(1.05) brightness(1.02);
}

body[data-theme="Iris & Lola Neon"] .irisLolaStar{
  height: max(1px, var(--size)) !important;
  width: calc(26px + (var(--size) * 10)) !important;
  background: linear-gradient(90deg,
    rgba(0,0,0,0),
    rgba(0,255,170,0.22),
    rgba(171,85,255,0.18),
    rgba(0,0,0,0)) !important;
  box-shadow:
    0 0 8px rgba(0,255,170,0.10),
    0 0 14px rgba(171,85,255,0.08);
  opacity: 0;
}

/* Main chat surface: soft glass + gentle edge glow */
body[data-theme="Iris & Lola Neon"] .chat{
  position: relative;
  isolation: isolate;
  background: rgba(10, 2, 16, 0.38) !important;
  border: 1px solid rgba(171,85,255,0.14) !important;
  border-radius: 22px;
  overflow: hidden;
  backdrop-filter: blur(10px);
  box-shadow:
    0 0 0 1px rgba(0,255,170,0.08),
    0 12px 30px rgba(0,0,0,0.35),
    0 0 22px rgba(0,255,170,0.08),
    0 0 28px rgba(171,85,255,0.06) !important;
}

/* Nebula glow behind chat content */
body[data-theme="Iris & Lola Neon"] .chat::before{
  content: "" !important;
  display: block !important;
  position: absolute;
  inset: -28px;
  pointer-events: none;
  z-index: 0;
  background:
    radial-gradient(circle at 22% 26%, rgba(0,255,170,0.14), rgba(0,255,170,0) 55%),
    radial-gradient(circle at 74% 30%, rgba(171,85,255,0.16), rgba(171,85,255,0) 58%),
    radial-gradient(circle at 44% 82%, rgba(120,200,255,0.06), rgba(120,200,255,0) 60%),
    radial-gradient(circle at 38% 52%, rgba(255,255,255,0.05), rgba(255,255,255,0) 28%);
  filter: blur(12px) saturate(1.15);
  opacity: 0.92;
  animation: irisLolaNebulaDriftV3 26s ease-in-out infinite;
}

@keyframes irisLolaNebulaDriftV3{
  0%,100%{ transform: translate3d(0,0,0) scale(1.03); opacity: 0.82; }
  50%{ transform: translate3d(10px,-8px,0) scale(1.07); opacity: 0.98; }
}

/* Centered "I love you" in a cute handwritten font with green glow */
body[data-theme="Iris & Lola Neon"] .chat::after{
  content: "I love you" !important;
  display: block !important;
  position: absolute;
  left: 50%;
  top: 46%;
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 0;

  font-family: "Segoe Script", "Bradley Hand", "Snell Roundhand", "Apple Chancery", "Lucida Handwriting", cursive;
  font-weight: 650;
  letter-spacing: 0.02em;
  font-size: clamp(26px, 7vw, 54px);
  color: rgba(120,255,210,0.92);
  text-shadow:
    0 0 10px rgba(0,255,170,0.55),
    0 0 20px rgba(0,255,170,0.28),
    0 0 36px rgba(171,85,255,0.18);
  opacity: 0.78;
  animation: irisLolaLovePulseV3 3.4s ease-in-out infinite;
}

@keyframes irisLolaLovePulseV3{
  0%,100%{ opacity: 0.66; transform: translate(-50%, -50%) scale(0.99); }
  50%{ opacity: 0.92; transform: translate(-50%, -50%) scale(1.03); }
}

/* Keep actual UI above the theme layers */
body[data-theme="Iris & Lola Neon"] .topbar,
body[data-theme="Iris & Lola Neon"] .msgs,
body[data-theme="Iris & Lola Neon"] .composer,
body[data-theme="Iris & Lola Neon"] .chatInputWrap{
  position: relative;
  z-index: 1;
}

/* Cute, stable drawer accents: subtle sparkles + a gentle sweep */
body[data-theme="Iris & Lola Neon"] #roomsPanel,
body[data-theme="Iris & Lola Neon"] #membersPane{
  position: relative;
  background: rgba(8, 2, 16, 0.68) !important;
  backdrop-filter: blur(10px);
  box-shadow:
    0 0 0 1px rgba(0,255,170,0.10),
    0 0 18px rgba(171,85,255,0.10);
}

body[data-theme="Iris & Lola Neon"] #roomsPanel::before,
body[data-theme="Iris & Lola Neon"] #membersPane::before{
  content: "" !important;
  display: block !important;
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  opacity: 0.35;
  background-image:
    radial-gradient(circle, rgba(255,255,255,0.10) 0 1px, rgba(0,0,0,0) 2px);
  background-size: 42px 42px;
  background-position: 0 0;
  animation: irisLolaSparkleScrollV3 44s linear infinite;
}

@keyframes irisLolaSparkleScrollV3{
  0%{ transform: translate3d(0,0,0); }
  100%{ transform: translate3d(42px, 42px, 0); }
}

body[data-theme="Iris & Lola Neon"] #roomsPanel::after,
body[data-theme="Iris & Lola Neon"] #membersPane::after{
  content: "" !important;
  display: block !important;
  position: absolute;
  left: -40%;
  top: -20%;
  width: 220%;
  height: 80px;
  pointer-events: none;
  z-index: 0;
  background: linear-gradient(90deg, rgba(0,0,0,0), rgba(0,255,170,0.10), rgba(171,85,255,0.08), rgba(0,0,0,0));
  opacity: 0.30;
  transform: rotate(-6deg);
  animation: irisLolaDrawerSweepV3 14s ease-in-out infinite;
}

@keyframes irisLolaDrawerSweepV3{
  0%,100%{ transform: translateX(-6%) rotate(-6deg); opacity: 0.22; }
  50%{ transform: translateX(6%) rotate(-6deg); opacity: 0.38; }
}

body[data-theme="Iris & Lola Neon"] #roomsPanel > *,
body[data-theme="Iris & Lola Neon"] #membersPane > *{
  position: relative;
  z-index: 1;
}

@media (max-width: 520px){
  body[data-theme="Iris & Lola Neon"] .chat{ border-radius: 18px; }
  body[data-theme="Iris & Lola Neon"] .chat::after{ top: 44%; }
}

@media (prefers-reduced-motion: reduce){
  body[data-theme="Iris & Lola Neon"] .chat::before,
  body[data-theme="Iris & Lola Neon"] .chat::after,
  body[data-theme="Iris & Lola Neon"] #roomsPanel::before,
  body[data-theme="Iris & Lola Neon"] #membersPane::before,
  body[data-theme="Iris & Lola Neon"] #roomsPanel::after,
  body[data-theme="Iris & Lola Neon"] #membersPane::after{
    animation: none !important;
  }
}


/* =====================================================================
   Iris & Lola Neon (SPACE REBUILD v3)
   Mystical green/purple space backdrop, subtle stars, occasional
   shooting-star streaks, and centered "I love you".
   iOS/Android safe: no BODY pseudo-elements.
   ===================================================================== */

body[data-theme="Iris & Lola Neon"]{
  background-color: #05000b !important;
  background-image:
    radial-gradient(900px 700px at 18% 18%, rgba(0,255,170,0.14), rgba(0,255,170,0) 60%),
    radial-gradient(850px 620px at 82% 22%, rgba(171,85,255,0.16), rgba(171,85,255,0) 62%),
    radial-gradient(700px 540px at 52% 78%, rgba(110,210,255,0.08), rgba(110,210,255,0) 60%),
    radial-gradient(520px 420px at 18% 84%, rgba(0,255,170,0.08), rgba(0,255,170,0) 62%),
    linear-gradient(180deg, #120018 0%, #05000b 100%) !important;
  background-repeat: no-repeat !important;
  background-size: cover !important;
  background-attachment: scroll !important;
  overflow-x: hidden;
}

/* Keep iOS Safari happy: never use body pseudos for this theme */
body[data-theme="Iris & Lola Neon"]::before,
body[data-theme="Iris & Lola Neon"]::after{
  content: none !important;
  display: none !important;
}

/* Let nebula show through */
body[data-theme="Iris & Lola Neon"] #app{ background: transparent !important; }

/* Starfield + shooting stars (injected by app.js) */
body[data-theme="Iris & Lola Neon"] .irisLolaStarfield{
  opacity: 0.92 !important;
  filter: saturate(1.06) brightness(1.02);
}

body[data-theme="Iris & Lola Neon"] .irisLolaStar{
  height: max(1px, var(--size)) !important;
  width: calc(26px + (var(--size) * 10)) !important;
  background: linear-gradient(90deg,
    rgba(0,0,0,0),
    rgba(0,255,170,0.22),
    rgba(171,85,255,0.18),
    rgba(0,0,0,0)) !important;
  box-shadow:
    0 0 8px rgba(0,255,170,0.10),
    0 0 14px rgba(171,85,255,0.08);
  opacity: 0;
}

/* Main chat surface: subtle glass + glow */
body[data-theme="Iris & Lola Neon"] .chat{
  position: relative;
  isolation: isolate;
  background: rgba(10, 2, 16, 0.38) !important;
  border: 1px solid rgba(171,85,255,0.14) !important;
  border-radius: 22px;
  overflow: hidden;
  backdrop-filter: blur(10px);
  box-shadow:
    0 0 0 1px rgba(0,255,170,0.08),
    0 0 22px rgba(0,255,170,0.10),
    0 0 34px rgba(171,85,255,0.08),
    0 14px 34px rgba(0,0,0,0.35) !important;
}

/* Inner nebula behind messages */
body[data-theme="Iris & Lola Neon"] .chat::before{
  content: "" !important;
  display: block !important;
  position: absolute;
  inset: -20px;
  pointer-events: none;
  z-index: 0;
  background:
    radial-gradient(circle at 22% 26%, rgba(0,255,170,0.14), rgba(0,255,170,0) 55%),
    radial-gradient(circle at 74% 30%, rgba(171,85,255,0.16), rgba(171,85,255,0) 58%),
    radial-gradient(circle at 44% 80%, rgba(120,200,255,0.06), rgba(120,200,255,0) 60%),
    radial-gradient(circle at 30% 62%, rgba(255,255,255,0.04), rgba(0,0,0,0) 24%),
    radial-gradient(circle at 66% 58%, rgba(255,255,255,0.03), rgba(0,0,0,0) 22%);
  filter: blur(10px) saturate(1.15);
  opacity: 0.92;
  animation: irisLolaNebulaDriftV3 26s ease-in-out infinite;
}

@keyframes irisLolaNebulaDriftV3{
  0%,100%{ transform: translate3d(0,0,0) scale(1.02); opacity: 0.82; }
  50%{ transform: translate3d(8px,-6px,0) scale(1.06); opacity: 0.98; }
}

/* Centered "I love you" */
body[data-theme="Iris & Lola Neon"] .chat::after{
  content: "I love you" !important;
  display: block !important;
  position: absolute;
  left: 50%;
  top: 46%;
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 0;
  font-family: "Segoe Script", "Bradley Hand", "Snell Roundhand", "Apple Chancery", "Lucida Handwriting", cursive;
  font-weight: 600;
  letter-spacing: 0.02em;
  font-size: clamp(26px, 7vw, 54px);
  color: rgba(120,255,210,0.92);
  text-shadow:
    0 0 10px rgba(0,255,170,0.55),
    0 0 20px rgba(0,255,170,0.28),
    0 0 36px rgba(171,85,255,0.18);
  opacity: 0.78;
  animation: irisLolaLovePulseV3 3.2s ease-in-out infinite;
}

@keyframes irisLolaLovePulseV3{
  0%,100%{ opacity: 0.62; transform: translate(-50%, -50%) scale(0.99); }
  50%{ opacity: 0.92; transform: translate(-50%, -50%) scale(1.03); }
}

/* Keep actual chat UI above decorative layers */
body[data-theme="Iris & Lola Neon"] .topbar,
body[data-theme="Iris & Lola Neon"] .msgs,
body[data-theme="Iris & Lola Neon"] .composer,
body[data-theme="Iris & Lola Neon"] .chatInputWrap{
  position: relative;
  z-index: 1;
}

/* Drawers: subtle cute star speckles + soft sweep */
body[data-theme="Iris & Lola Neon"] #roomsPanel,
body[data-theme="Iris & Lola Neon"] #membersPane{
  position: relative;
  background: rgba(8, 2, 16, 0.68) !important;
  backdrop-filter: blur(10px);
  box-shadow:
    0 0 0 1px rgba(0,255,170,0.10),
    0 0 18px rgba(171,85,255,0.10);
}

body[data-theme="Iris & Lola Neon"] #roomsPanel::before,
body[data-theme="Iris & Lola Neon"] #membersPane::before{
  content: "" !important;
  display: block !important;
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  opacity: 0.55;
  background:
    radial-gradient(2px 2px at 12% 18%, rgba(255,255,255,0.22), rgba(255,255,255,0) 65%),
    radial-gradient(1.5px 1.5px at 38% 62%, rgba(0,255,170,0.16), rgba(0,255,170,0) 70%),
    radial-gradient(2px 2px at 72% 26%, rgba(171,85,255,0.18), rgba(171,85,255,0) 70%),
    radial-gradient(1.5px 1.5px at 86% 78%, rgba(255,255,255,0.16), rgba(255,255,255,0) 70%);
}

body[data-theme="Iris & Lola Neon"] #roomsPanel::after,
body[data-theme="Iris & Lola Neon"] #membersPane::after{
  content: "" !important;
  display: block !important;
  position: absolute;
  left: -40%;
  top: -20%;
  width: 220%;
  height: 80px;
  pointer-events: none;
  z-index: 0;
  background: linear-gradient(90deg, rgba(0,0,0,0), rgba(0,255,170,0.10), rgba(171,85,255,0.08), rgba(0,0,0,0));
  opacity: 0.35;
  transform: rotate(-6deg);
  animation: irisLolaDrawerSweepV3 14s ease-in-out infinite;
}

@keyframes irisLolaDrawerSweepV3{
  0%,100%{ transform: translateX(-6%) rotate(-6deg); opacity: 0.24; }
  50%{ transform: translateX(6%) rotate(-6deg); opacity: 0.40; }
}

body[data-theme="Iris & Lola Neon"] #roomsPanel > *,
body[data-theme="Iris & Lola Neon"] #membersPane > *{
  position: relative;
  z-index: 1;
}

@media (max-width: 520px){
  body[data-theme="Iris & Lola Neon"] .chat{ border-radius: 18px; }
  body[data-theme="Iris & Lola Neon"] .chat::after{ top: 44%; }
}

@media (prefers-reduced-motion: reduce){
  body[data-theme="Iris & Lola Neon"] .chat::before,
  body[data-theme="Iris & Lola Neon"] .chat::after,
  body[data-theme="Iris & Lola Neon"] #roomsPanel::after,
  body[data-theme="Iris & Lola Neon"] #membersPane::after{
    animation: none !important;
  }
}

/* =====================================================================
   Iris & Lola Neon (SPACE REBUILD v3)
   Mystical green/purple space backdrop, subtle stars, occasional
   shooting-star streaks, and centered "I love you".
   iOS/Android safe: no BODY pseudo-elements.
   ===================================================================== */

/* Global page nebula */
body[data-theme="Iris & Lola Neon"]{
  background-color: #05000b !important;
  background-image:
    radial-gradient(900px 700px at 18% 18%, rgba(0,255,170,0.14), rgba(0,255,170,0) 60%),
    radial-gradient(850px 620px at 82% 22%, rgba(171,85,255,0.16), rgba(171,85,255,0) 62%),
    radial-gradient(700px 540px at 52% 78%, rgba(110,210,255,0.08), rgba(110,210,255,0) 60%),
    radial-gradient(520px 420px at 18% 84%, rgba(0,255,170,0.08), rgba(0,255,170,0) 62%),
    linear-gradient(180deg, #120018 0%, #05000b 100%) !important;
  background-repeat: no-repeat !important;
  background-size: cover !important;
  background-attachment: scroll !important;
  overflow-x: hidden;
}

/* Safety: keep iOS stable (older experiments used body pseudos) */
body[data-theme="Iris & Lola Neon"]::before,
body[data-theme="Iris & Lola Neon"]::after{
  content: none !important;
  display: none !important;
}

/* Ensure app surfaces let the nebula show through */
body[data-theme="Iris & Lola Neon"] #app{
  background: transparent !important;
}

/* Starfield + shooting stars (injected by app.js) */
body[data-theme="Iris & Lola Neon"] .irisLolaStarfield{
  opacity: 0.92 !important;
  filter: saturate(1.08) brightness(1.02);
}

body[data-theme="Iris & Lola Neon"] .irisLolaStar{
  height: max(1px, var(--size)) !important;
  width: calc(26px + (var(--size) * 10)) !important;
  background: linear-gradient(90deg,
    rgba(0,0,0,0),
    rgba(0,255,170,0.22),
    rgba(171,85,255,0.18),
    rgba(0,0,0,0)) !important;
  opacity: 0;
  box-shadow:
    0 0 8px rgba(0,255,170,0.10),
    0 0 14px rgba(171,85,255,0.08);
}

/* Main chat glass + glow */
body[data-theme="Iris & Lola Neon"] .chat{
  position: relative;
  isolation: isolate;
  background: rgba(10, 2, 16, 0.38) !important;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(171,85,255,0.16) !important;
  box-shadow:
    0 0 0 1px rgba(0,255,170,0.08),
    0 0 18px rgba(0,255,170,0.08),
    0 0 28px rgba(171,85,255,0.06),
    0 14px 36px rgba(0,0,0,0.35) !important;
  overflow: hidden;
}

/* Soft nebula inside the chat area (behind content) */
body[data-theme="Iris & Lola Neon"] .chat::before{
  content: "" !important;
  display: block !important;
  position: absolute;
  inset: -18px;
  pointer-events: none;
  z-index: 0;
  background:
    radial-gradient(520px 420px at 22% 18%, rgba(0,255,170,0.14), rgba(0,255,170,0) 62%),
    radial-gradient(560px 440px at 78% 28%, rgba(171,85,255,0.16), rgba(171,85,255,0) 64%),
    radial-gradient(420px 340px at 48% 86%, rgba(130,220,255,0.06), rgba(130,220,255,0) 62%),
    radial-gradient(circle at 32% 64%, rgba(255,255,255,0.05), rgba(0,0,0,0) 28%),
    radial-gradient(circle at 64% 60%, rgba(255,255,255,0.04), rgba(0,0,0,0) 26%);
  opacity: 0.90;
  filter: blur(10px) saturate(1.12);
  animation: irisLolaNebulaDriftV3 26s ease-in-out infinite;
}

@keyframes irisLolaNebulaDriftV3{
  0%,100%{ transform: translate3d(0,0,0) scale(1.02); opacity: 0.82; }
  50%{ transform: translate3d(10px,-8px,0) scale(1.06); opacity: 0.98; }
}

/* Centered "I love you" */
body[data-theme="Iris & Lola Neon"] .chat::after{
  content: "I love you" !important;
  display: block !important;
  position: absolute;
  left: 50%;
  top: 46%;
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 0;

  font-family: "Segoe Script", "Bradley Hand", "Snell Roundhand", "Apple Chancery", "Lucida Handwriting", cursive;
  font-weight: 650;
  letter-spacing: 0.02em;
  font-size: clamp(26px, 7vw, 54px);
  color: rgba(120,255,210,0.92);
  text-shadow:
    0 0 10px rgba(0,255,170,0.55),
    0 0 22px rgba(0,255,170,0.32),
    0 0 38px rgba(171,85,255,0.18);
  opacity: 0.80;
  animation: irisLolaLovePulseV3 3.0s ease-in-out infinite;
}

@keyframes irisLolaLovePulseV3{
  0%,100%{ opacity: 0.66; transform: translate(-50%, -50%) scale(0.99); }
  50%{ opacity: 0.92; transform: translate(-50%, -50%) scale(1.03); }
}

/* Keep actual UI above decorative layers */
body[data-theme="Iris & Lola Neon"] .topbar,
body[data-theme="Iris & Lola Neon"] .msgs,
body[data-theme="Iris & Lola Neon"] .composer,
body[data-theme="Iris & Lola Neon"] .chatInputWrap{
  position: relative;
  z-index: 1;
}

/* Cute, stable drawer accents */
body[data-theme="Iris & Lola Neon"] #roomsPanel,
body[data-theme="Iris & Lola Neon"] #membersPane{
  position: relative;
  background: rgba(8, 2, 16, 0.68) !important;
  backdrop-filter: blur(10px);
  box-shadow:
    0 0 0 1px rgba(0,255,170,0.10),
    0 0 18px rgba(171,85,255,0.10);
}

body[data-theme="Iris & Lola Neon"] #roomsPanel::before,
body[data-theme="Iris & Lola Neon"] #membersPane::before{
  content: "" !important;
  display: block !important;
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  opacity: 0.55;
  background:
    radial-gradient(2px 2px at 12% 18%, rgba(255,255,255,0.22), rgba(255,255,255,0) 65%),
    radial-gradient(1.5px 1.5px at 38% 62%, rgba(0,255,170,0.16), rgba(0,255,170,0) 70%),
    radial-gradient(2px 2px at 72% 26%, rgba(171,85,255,0.18), rgba(171,85,255,0) 70%),
    radial-gradient(1.5px 1.5px at 86% 78%, rgba(255,255,255,0.16), rgba(255,255,255,0) 70%);
}

body[data-theme="Iris & Lola Neon"] #roomsPanel::after,
body[data-theme="Iris & Lola Neon"] #membersPane::after{
  content: "" !important;
  display: block !important;
  position: absolute;
  left: -40%;
  top: -20%;
  width: 220%;
  height: 80px;
  pointer-events: none;
  z-index: 0;
  background: linear-gradient(90deg, rgba(0,0,0,0), rgba(0,255,170,0.10), rgba(171,85,255,0.08), rgba(0,0,0,0));
  opacity: 0.35;
  transform: rotate(-6deg);
  animation: irisLolaDrawerSweepV3 14s ease-in-out infinite;
}

@keyframes irisLolaDrawerSweepV3{
  0%,100%{ transform: translateX(-6%) rotate(-6deg); opacity: 0.24; }
  50%{ transform: translateX(6%) rotate(-6deg); opacity: 0.40; }
}

body[data-theme="Iris & Lola Neon"] #roomsPanel > *,
body[data-theme="Iris & Lola Neon"] #membersPane > *{
  position: relative;
  z-index: 1;
}

@media (max-width: 520px){
  body[data-theme="Iris & Lola Neon"] .chat::after{ top: 44%; opacity: 0.86; }
  body[data-theme="Iris & Lola Neon"] .chat::before{ inset: -12px; }
}

@media (prefers-reduced-motion: reduce){
  body[data-theme="Iris & Lola Neon"] .chat::before,
  body[data-theme="Iris & Lola Neon"] .chat::after,
  body[data-theme="Iris & Lola Neon"] #roomsPanel::after,
  body[data-theme="Iris & Lola Neon"] #membersPane::after{
    animation: none !important;
  }
}

/* =====================================================================
   Iris & Lola Neon (SPACE REBUILD v3)
   Mystical green/purple space backdrop, subtle stars, occasional
   shooting-star streaks, and centered "I love you".
   iOS/Android safe: no BODY pseudo-elements.
   ===================================================================== */

/* Global page nebula */
body[data-theme="Iris & Lola Neon"]{
  background-color: #06010c !important;
  background-image:
    radial-gradient(circle at 16% 20%, rgba(0, 255, 170, 0.14) 0%, rgba(0, 255, 170, 0.06) 26%, rgba(6, 1, 12, 0) 62%),
    radial-gradient(circle at 80% 24%, rgba(180, 90, 255, 0.16) 0%, rgba(180, 90, 255, 0.06) 28%, rgba(6, 1, 12, 0) 66%),
    radial-gradient(circle at 46% 78%, rgba(110, 210, 255, 0.06) 0%, rgba(6, 1, 12, 0) 60%),
    radial-gradient(circle at 58% 44%, rgba(0, 255, 205, 0.05) 0%, rgba(6, 1, 12, 0) 55%),
    linear-gradient(180deg, #14001c 0%, #06010c 100%) !important;
  background-repeat: no-repeat !important;
  background-size: 160vmax 160vmax, 155vmax 155vmax, 150vmax 150vmax, 140vmax 140vmax, cover !important;
  background-position: 16% 20%, 80% 24%, 46% 78%, 58% 44%, center !important;
  overflow-x: hidden;
}

/* Keep iOS stable (disable any older BODY overlays) */
body[data-theme="Iris & Lola Neon"]::before,
body[data-theme="Iris & Lola Neon"]::after{
  content: none !important;
  display: none !important;
}

/* Ensure app surfaces do not paint over the nebula */
body[data-theme="Iris & Lola Neon"] #app{
  background: transparent !important;
}

/* Starfield + shooting stars are injected by app.js */
body[data-theme="Iris & Lola Neon"] .irisLolaStarfield{
  opacity: 0.85 !important;
  filter: saturate(1.05) brightness(1.02);
}

body[data-theme="Iris & Lola Neon"] .irisLolaStar{
  height: max(1px, var(--size)) !important;
  width: calc(26px + (var(--size) * 10)) !important;
  background: linear-gradient(90deg,
    rgba(0,0,0,0),
    rgba(0,255,170,0.22),
    rgba(180,90,255,0.18),
    rgba(0,0,0,0)) !important;
  box-shadow:
    0 0 8px rgba(0,255,170,0.10),
    0 0 14px rgba(180,90,255,0.08);
}

/* Chat: glassy space panel with soft edge glow */
body[data-theme="Iris & Lola Neon"] .chat{
  position: relative;
  isolation: isolate;
  background: rgba(10, 2, 16, 0.38) !important;
  border: 1px solid rgba(180, 90, 255, 0.16) !important;
  box-shadow:
    0 0 0 1px rgba(0, 255, 170, 0.08),
    0 0 18px rgba(0, 255, 170, 0.10),
    0 0 26px rgba(180, 90, 255, 0.08),
    0 12px 30px rgba(0, 0, 0, 0.35) !important;
  backdrop-filter: blur(10px);
  overflow: hidden;
}

/* Soft nebula glow inside chat (behind all content) */
body[data-theme="Iris & Lola Neon"] .chat::before{
  content: "" !important;
  display: block !important;
  position: absolute;
  inset: -22px;
  pointer-events: none;
  z-index: 0;
  background:
    radial-gradient(circle at 22% 22%, rgba(0, 255, 170, 0.16), rgba(0, 255, 170, 0) 58%),
    radial-gradient(circle at 76% 28%, rgba(180, 90, 255, 0.18), rgba(180, 90, 255, 0) 60%),
    radial-gradient(circle at 48% 84%, rgba(120, 210, 255, 0.06), rgba(120, 210, 255, 0) 62%),
    radial-gradient(circle at 38% 58%, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0) 34%);
  filter: blur(10px) saturate(1.12);
  opacity: 0.90;
  animation: irisLolaNebulaDriftV3 26s ease-in-out infinite;
}

@keyframes irisLolaNebulaDriftV3{
  0%, 100%{ transform: translate3d(0,0,0) scale(1.02); opacity: 0.82; }
  50%{ transform: translate3d(10px,-8px,0) scale(1.06); opacity: 0.98; }
}

/* Centered "I love you" (cute handwritten vibe) */
body[data-theme="Iris & Lola Neon"] .chat::after{
  content: "I love you" !important;
  display: block !important;
  position: absolute;
  left: 50%;
  top: 46%;
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 0;

  font-family: "Segoe Script", "Bradley Hand", "Snell Roundhand", "Apple Chancery", "Lucida Handwriting", cursive;
  font-weight: 650;
  letter-spacing: 0.02em;
  font-size: clamp(26px, 7vw, 54px);
  color: rgba(120, 255, 210, 0.92);
  text-shadow:
    0 0 10px rgba(0, 255, 170, 0.55),
    0 0 20px rgba(0, 255, 170, 0.28),
    0 0 36px rgba(180, 90, 255, 0.18);
  opacity: 0.78;
  animation: irisLolaLovePulseV3 3.4s ease-in-out infinite;
}

@keyframes irisLolaLovePulseV3{
  0%, 100%{ opacity: 0.66; transform: translate(-50%, -50%) scale(0.99); }
  50%{ opacity: 0.92; transform: translate(-50%, -50%) scale(1.03); }
}

/* Keep real UI above decorative layers */
body[data-theme="Iris & Lola Neon"] .topbar,
body[data-theme="Iris & Lola Neon"] .msgs,
body[data-theme="Iris & Lola Neon"] .composer,
body[data-theme="Iris & Lola Neon"] .chatInputWrap{
  position: relative;
  z-index: 1;
}

/* Drawers: subtle cute star speckles + gentle sweeping shimmer */
body[data-theme="Iris & Lola Neon"] #roomsPanel,
body[data-theme="Iris & Lola Neon"] #membersPane{
  position: relative;
  background: rgba(8, 2, 16, 0.68) !important;
  backdrop-filter: blur(10px);
  box-shadow:
    0 0 0 1px rgba(0, 255, 170, 0.10),
    0 0 18px rgba(180, 90, 255, 0.10);
}

body[data-theme="Iris & Lola Neon"] #roomsPanel::before,
body[data-theme="Iris & Lola Neon"] #membersPane::before{
  content: "" !important;
  display: block !important;
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  opacity: 0.42;
  background-image:
    radial-gradient(circle, rgba(255,255,255,0.12) 0 1px, rgba(0,0,0,0) 2px);
  background-size: 42px 42px;
  background-position: 0 0;
}

body[data-theme="Iris & Lola Neon"] #roomsPanel::after,
body[data-theme="Iris & Lola Neon"] #membersPane::after{
  content: "" !important;
  display: block !important;
  position: absolute;
  left: -40%;
  top: -20%;
  width: 220%;
  height: 80px;
  pointer-events: none;
  z-index: 0;
  background: linear-gradient(90deg, rgba(0,0,0,0), rgba(0,255,170,0.10), rgba(180,90,255,0.08), rgba(0,0,0,0));
  opacity: 0.35;
  transform: rotate(-6deg);
  animation: irisLolaDrawerSweepV3 14s ease-in-out infinite;
}

@keyframes irisLolaDrawerSweepV3{
  0%, 100%{ transform: translateX(-6%) rotate(-6deg); opacity: 0.24; }
  50%{ transform: translateX(6%) rotate(-6deg); opacity: 0.40; }
}

body[data-theme="Iris & Lola Neon"] #roomsPanel > *,
body[data-theme="Iris & Lola Neon"] #membersPane > *{
  position: relative;
  z-index: 1;
}

@media (max-width: 520px){
  body[data-theme="Iris & Lola Neon"] .chat::after{ top: 44%; }
}

@media (prefers-reduced-motion: reduce){
  body[data-theme="Iris & Lola Neon"] .chat::before,
  body[data-theme="Iris & Lola Neon"] .chat::after,
  body[data-theme="Iris & Lola Neon"] #roomsPanel::after,
  body[data-theme="Iris & Lola Neon"] #membersPane::after{
    animation: none !important;
  }
}

/* =====================================================================
   Iris & Lola Neon (SPACE REBUILD v3)
   Mystical green/purple space backdrop, subtle stars, occasional
   shooting-star streaks, and centered "I love you".
   iOS/Android safe: no BODY pseudo-elements.
   ===================================================================== */

/* Global page nebula */
body[data-theme="Iris & Lola Neon"]{
  background-color: #05000b !important;
  background-image:
    radial-gradient(900px 700px at 18% 18%, rgba(0,255,170,0.14), rgba(0,255,170,0) 60%),
    radial-gradient(850px 620px at 82% 22%, rgba(171,85,255,0.16), rgba(171,85,255,0) 62%),
    radial-gradient(700px 540px at 52% 78%, rgba(110,210,255,0.08), rgba(110,210,255,0) 60%),
    radial-gradient(520px 420px at 18% 84%, rgba(0,255,170,0.08), rgba(0,255,170,0) 62%),
    linear-gradient(180deg, #120018 0%, #05000b 100%) !important;
  background-repeat: no-repeat !important;
  background-size: cover !important;
  background-attachment: scroll !important;
  overflow-x: hidden;
}

/* Safety: do not use body pseudos (keeps iOS Safari stable) */
body[data-theme="Iris & Lola Neon"]::before,
body[data-theme="Iris & Lola Neon"]::after{
  content: none !important;
  display: none !important;
}

/* Ensure surfaces are transparent so nebula shows through */
body[data-theme="Iris & Lola Neon"] #app{
  background: transparent !important;
}

/* Starfield + shooting stars (injected by app.js) */
body[data-theme="Iris & Lola Neon"] .irisLolaStarfield{
  opacity: 0.9 !important;
  filter: saturate(1.05) brightness(1.03);
}

body[data-theme="Iris & Lola Neon"] .irisLolaStar{
  height: max(1px, var(--size)) !important;
  width: calc(26px + (var(--size) * 10)) !important;
  background: linear-gradient(90deg,
    rgba(0,0,0,0),
    rgba(0,255,170,0.22),
    rgba(171,85,255,0.18),
    rgba(0,0,0,0)) !important;
  box-shadow:
    0 0 8px rgba(0,255,170,0.10),
    0 0 14px rgba(171,85,255,0.08);
}

/* Main chat area: subtle glass + nebula glow */
body[data-theme="Iris & Lola Neon"] .chat{
  position: relative;
  isolation: isolate;
  background: rgba(10, 2, 16, 0.38) !important;
  border: 1px solid rgba(181, 93, 255, 0.14) !important;
  backdrop-filter: blur(10px);
  box-shadow:
    0 0 0 1px rgba(0,255,170,0.08),
    0 12px 30px rgba(0,0,0,0.35),
    0 0 22px rgba(171,85,255,0.08) !important;
  overflow: hidden;
}

body[data-theme="Iris & Lola Neon"] .chat::before{
  content: "" !important;
  display: block !important;
  position: absolute;
  inset: -18px;
  pointer-events: none;
  z-index: 0;
  background:
    radial-gradient(circle at 22% 26%, rgba(0,255,170,0.14), rgba(0,255,170,0) 56%),
    radial-gradient(circle at 74% 30%, rgba(171,85,255,0.16), rgba(171,85,255,0) 60%),
    radial-gradient(circle at 44% 80%, rgba(120,200,255,0.06), rgba(120,200,255,0) 60%);
  filter: blur(10px) saturate(1.15);
  opacity: 0.92;
  animation: irisLolaNebulaDriftV3 26s ease-in-out infinite;
}

@keyframes irisLolaNebulaDriftV3{
  0%,100%{ transform: translate3d(0,0,0) scale(1.02); opacity: 0.80; }
  50%{ transform: translate3d(8px,-6px,0) scale(1.06); opacity: 0.98; }
}

/* Centered "I love you" with green glow */
body[data-theme="Iris & Lola Neon"] .chat::after{
  content: "I love you" !important;
  display: block !important;
  position: absolute;
  left: 50%;
  top: 46%;
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 0;

  font-family: "Segoe Script", "Bradley Hand", "Snell Roundhand", "Apple Chancery", "Lucida Handwriting", cursive;
  font-weight: 650;
  letter-spacing: 0.02em;
  font-size: clamp(26px, 7vw, 54px);
  color: rgba(120, 255, 210, 0.92);
  text-shadow:
    0 0 10px rgba(0,255,170,0.55),
    0 0 20px rgba(0,255,170,0.28),
    0 0 36px rgba(171,85,255,0.18);
  opacity: 0.80;
  animation: irisLolaLovePulseV3 3.2s ease-in-out infinite;
}

@keyframes irisLolaLovePulseV3{
  0%,100%{ opacity: 0.66; transform: translate(-50%, -50%) scale(0.99); }
  50%{ opacity: 0.92; transform: translate(-50%, -50%) scale(1.03); }
}

/* Keep functional UI above decorative layers */
body[data-theme="Iris & Lola Neon"] .topbar,
body[data-theme="Iris & Lola Neon"] .msgs,
body[data-theme="Iris & Lola Neon"] .composer,
body[data-theme="Iris & Lola Neon"] .chatInputWrap{
  position: relative;
  z-index: 1;
}

/* Drawers: subtle starry accents (stable on mobile/desktop) */
body[data-theme="Iris & Lola Neon"] #roomsPanel,
body[data-theme="Iris & Lola Neon"] #membersPane{
  position: relative;
  background: rgba(8, 2, 16, 0.68) !important;
  backdrop-filter: blur(10px);
  box-shadow:
    0 0 0 1px rgba(0,255,170,0.10),
    0 0 18px rgba(171,85,255,0.10);
}

body[data-theme="Iris & Lola Neon"] #roomsPanel::before,
body[data-theme="Iris & Lola Neon"] #membersPane::before{
  content: "" !important;
  display: block !important;
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  opacity: 0.55;
  background:
    radial-gradient(2px 2px at 12% 18%, rgba(255,255,255,0.22), rgba(255,255,255,0) 65%),
    radial-gradient(1.5px 1.5px at 38% 62%, rgba(0,255,170,0.16), rgba(0,255,170,0) 70%),
    radial-gradient(2px 2px at 72% 26%, rgba(171,85,255,0.18), rgba(171,85,255,0) 70%),
    radial-gradient(1.5px 1.5px at 86% 78%, rgba(255,255,255,0.16), rgba(255,255,255,0) 70%);
}

body[data-theme="Iris & Lola Neon"] #roomsPanel::after,
body[data-theme="Iris & Lola Neon"] #membersPane::after{
  content: "" !important;
  display: block !important;
  position: absolute;
  left: -40%;
  top: -20%;
  width: 220%;
  height: 80px;
  pointer-events: none;
  z-index: 0;
  background: linear-gradient(90deg, rgba(0,0,0,0), rgba(0,255,170,0.10), rgba(171,85,255,0.08), rgba(0,0,0,0));
  opacity: 0.35;
  transform: rotate(-6deg);
  animation: irisLolaDrawerSweepV3 14s ease-in-out infinite;
}

@keyframes irisLolaDrawerSweepV3{
  0%,100%{ transform: translateX(-6%) rotate(-6deg); opacity: 0.24; }
  50%{ transform: translateX(6%) rotate(-6deg); opacity: 0.40; }
}

body[data-theme="Iris & Lola Neon"] #roomsPanel > *,
body[data-theme="Iris & Lola Neon"] #membersPane > *{
  position: relative;
  z-index: 1;
}

@media (max-width: 520px){
  body[data-theme="Iris & Lola Neon"] .chat::before{ inset: -12px; }
  body[data-theme="Iris & Lola Neon"] .chat::after{ top: 44%; }
}

@media (prefers-reduced-motion: reduce){
  body[data-theme="Iris & Lola Neon"] .chat::before,
  body[data-theme="Iris & Lola Neon"] .chat::after,
  body[data-theme="Iris & Lola Neon"] #roomsPanel::after,
  body[data-theme="Iris & Lola Neon"] #membersPane::after{
    animation: none !important;
  }
}


/* =====================================================================
   Iris & Lola Neon (SPACE REBUILD v3)
   Mystical green/purple space backdrop, subtle stars, occasional
   shooting-star streaks, and centered "I love you".
   iOS/Android safe: no BODY pseudo-elements.
   ===================================================================== */

/* Global page nebula */
body[data-theme="Iris & Lola Neon"]{
  background-color:#05000b !important;
  background-image:
    radial-gradient(900px 700px at 18% 18%, rgba(0,255,170,.14), rgba(0,255,170,0) 60%),
    radial-gradient(850px 620px at 82% 22%, rgba(171,85,255,.16), rgba(171,85,255,0) 62%),
    radial-gradient(700px 540px at 52% 78%, rgba(110,210,255,.08), rgba(110,210,255,0) 60%),
    radial-gradient(520px 420px at 18% 84%, rgba(0,255,170,.08), rgba(0,255,170,0) 62%),
    linear-gradient(180deg,#120018 0%,#05000b 100%) !important;
  background-repeat:no-repeat !important;
  background-size:cover !important;
  background-attachment:scroll !important;
  overflow-x:hidden;
}

/* Safety: never use body pseudos for this theme (keeps iOS stable) */
body[data-theme="Iris & Lola Neon"]::before,
body[data-theme="Iris & Lola Neon"]::after{
  content:none !important;
  display:none !important;
}

/* Keep main app shells transparent so nebula reads through */
body[data-theme="Iris & Lola Neon"] #app{ background:transparent !important; }

/* Starfield container (injected by app.js) */
body[data-theme="Iris & Lola Neon"] .irisLolaStarfield{
  opacity:.85 !important;
  filter:saturate(1.08) brightness(1.02);
}

/* Shooting stars (app.js uses .irisLolaStar nodes) */
body[data-theme="Iris & Lola Neon"] .irisLolaStar{
  height:max(1px,var(--size)) !important;
  width:calc(28px + (var(--size) * 12)) !important;
  border-radius:999px;
  background:linear-gradient(90deg,
    rgba(0,0,0,0),
    rgba(0,255,170,.24),
    rgba(171,85,255,.18),
    rgba(0,0,0,0)) !important;
  box-shadow:
    0 0 10px rgba(0,255,170,.10),
    0 0 18px rgba(171,85,255,.08);
  opacity:0;
}

/* Chat container: glassy, subtle glow */
body[data-theme="Iris & Lola Neon"] .chat{
  position:relative;
  isolation:isolate;
  background:rgba(10,2,16,.34) !important;
  backdrop-filter:blur(10px);
  border:1px solid rgba(171,85,255,.14) !important;
  border-radius:22px;
  box-shadow:
    0 0 0 1px rgba(0,255,170,.08),
    0 0 18px rgba(0,255,170,.08),
    0 0 28px rgba(171,85,255,.08);
  overflow:hidden;
}

/* Soft nebula wash behind chat content */
body[data-theme="Iris & Lola Neon"] .chat::before{
  content:"" !important;
  display:block !important;
  position:absolute;
  inset:-18px;
  pointer-events:none;
  z-index:0;
  background:
    radial-gradient(520px 420px at 22% 20%, rgba(0,255,170,.12), rgba(0,255,170,0) 62%),
    radial-gradient(560px 440px at 78% 28%, rgba(171,85,255,.12), rgba(171,85,255,0) 64%),
    radial-gradient(420px 340px at 48% 86%, rgba(130,220,255,.06), rgba(130,220,255,0) 62%);
  opacity:.85;
  filter:blur(0.2px);
  animation:irisLolaNebulaDriftV3 26s ease-in-out infinite;
}

@keyframes irisLolaNebulaDriftV3{
  0%,100%{ transform:translate3d(0,0,0) scale(1.02); opacity:.78; }
  50%{ transform:translate3d(8px,-6px,0) scale(1.06); opacity:.92; }
}

/* Centered "I love you" with green glow */
body[data-theme="Iris & Lola Neon"] .chat::after{
  content:"I love you" !important;
  display:block !important;
  position:absolute;
  left:50%;
  top:46%;
  transform:translate(-50%,-50%);
  pointer-events:none;
  z-index:0;
  font-family:"Segoe Script","Bradley Hand","Snell Roundhand","Apple Chancery","Lucida Handwriting",cursive;
  font-weight:650;
  letter-spacing:.02em;
  font-size:clamp(26px,7vw,54px);
  color:rgba(0,255,170,.90);
  text-shadow:
    0 0 10px rgba(0,255,170,.55),
    0 0 22px rgba(0,255,170,.28),
    0 0 38px rgba(171,85,255,.18);
  opacity:.80;
  animation:irisLolaLovePulseV3 3.2s ease-in-out infinite;
}

@keyframes irisLolaLovePulseV3{
  0%,100%{ opacity:.66; transform:translate(-50%,-50%) scale(.99); }
  50%{ opacity:.92; transform:translate(-50%,-50%) scale(1.03); }
}

/* Keep actual UI above decorative layers */
body[data-theme="Iris & Lola Neon"] .topbar,
body[data-theme="Iris & Lola Neon"] .msgs,
body[data-theme="Iris & Lola Neon"] .composer,
body[data-theme="Iris & Lola Neon"] .chatInputWrap{
  position:relative;
  z-index:1;
}

/* Cute, stable drawer accents (Rooms + Members) */
body[data-theme="Iris & Lola Neon"] #roomsPanel,
body[data-theme="Iris & Lola Neon"] #membersPane{
  position:relative;
  background:rgba(8,2,16,.68) !important;
  backdrop-filter:blur(10px);
  box-shadow:
    0 0 0 1px rgba(0,255,170,.10),
    0 0 18px rgba(171,85,255,.10);
}

body[data-theme="Iris & Lola Neon"] #roomsPanel::before,
body[data-theme="Iris & Lola Neon"] #membersPane::before{
  content:"" !important;
  display:block !important;
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:0;
  opacity:.50;
  background:
    radial-gradient(2px 2px at 12% 18%, rgba(255,255,255,.22), rgba(255,255,255,0) 65%),
    radial-gradient(1.5px 1.5px at 38% 62%, rgba(0,255,170,.16), rgba(0,255,170,0) 70%),
    radial-gradient(2px 2px at 72% 26%, rgba(171,85,255,.18), rgba(171,85,255,0) 70%),
    radial-gradient(1.5px 1.5px at 86% 78%, rgba(255,255,255,.16), rgba(255,255,255,0) 70%);
}

body[data-theme="Iris & Lola Neon"] #roomsPanel::after,
body[data-theme="Iris & Lola Neon"] #membersPane::after{
  content:"" !important;
  display:block !important;
  position:absolute;
  left:-40%;
  top:-20%;
  width:220%;
  height:80px;
  pointer-events:none;
  z-index:0;
  background:linear-gradient(90deg, rgba(0,0,0,0), rgba(0,255,170,.10), rgba(171,85,255,.08), rgba(0,0,0,0));
  opacity:.32;
  transform:rotate(-6deg);
  animation:irisLolaDrawerSweepV3 14s ease-in-out infinite;
}

@keyframes irisLolaDrawerSweepV3{
  0%,100%{ transform:translateX(-6%) rotate(-6deg); opacity:.22; }
  50%{ transform:translateX(6%) rotate(-6deg); opacity:.38; }
}

body[data-theme="Iris & Lola Neon"] #roomsPanel > *,
body[data-theme="Iris & Lola Neon"] #membersPane > *{
  position:relative;
  z-index:1;
}

@media (max-width:520px){
  body[data-theme="Iris & Lola Neon"] .chat{ border-radius:18px; }
  body[data-theme="Iris & Lola Neon"] .chat::after{ top:44%; opacity:.86; }
}

@media (prefers-reduced-motion: reduce){
  body[data-theme="Iris & Lola Neon"] .chat::before,
  body[data-theme="Iris & Lola Neon"] .chat::after,
  body[data-theme="Iris & Lola Neon"] #roomsPanel::after,
  body[data-theme="Iris & Lola Neon"] #membersPane::after{
    animation:none !important;
  }
}

/* =====================================================================
   MOBILE LAYOUT HARD FIX (prevents "half chat" by removing members pane
   from flex flow on small screens, regardless of earlier CSS ordering).
   This is intentionally last in the file so it always wins.
   ===================================================================== */
@media (max-width: 980px){
  /* Never reserve horizontal space for members on mobile */
  :root{ --membersW: 0px; }

  /* Force the main chat to occupy the full row */
  .layout{ position: relative; }
  main.chat{ flex: 1 1 auto !important; width: 100% !important; min-width: 0 !important; }

  /* Remove the members pane from the flex layout so it can't steal 50% width */
  .layout > .members{
    flex: 0 0 0px !important;
    width: 0px !important;
    min-width: 0px !important;
    padding: 0 !important;
    border-left: 0 !important;
    overflow: visible !important;
  }

  /* Render the members pane only as an off-canvas drawer */
  .members.drawer{
    display: block !important;
    position: fixed !important;
    top: var(--headerH, 54px) !important;
    right: 0 !important;
    height: calc(var(--vvhPx) - var(--headerH, 54px)) !important;
    width: min(86vw, 320px) !important;
    transform: translateX(105%) !important;
    transition: transform .18s ease !important;
    z-index: 160 !important;
    box-shadow: -12px 0 30px rgba(0,0,0,.55) !important;
    pointer-events: none;
  }
  .members.drawer.open{
    transform: translateX(0) !important;
    pointer-events: auto;
  }

  /* Channels: also off-canvas on mobile */
  .channels{
    position: fixed !important;
    top: var(--headerH, 54px) !important;
    left: 0 !important;
    height: calc(var(--vvhPx) - var(--headerH, 54px)) !important;
    width: min(86vw, 320px) !important;
    transform: translateX(-105%) !important;
    transition: transform .18s ease !important;
    z-index: 160 !important;
    box-shadow: 12px 0 30px rgba(0,0,0,.55) !important;
    pointer-events: none;
  }
  .channels.open{
    transform: translateX(0) !important;
    pointer-events: auto;
  }

  /* Overlay should sit above chat but below modals */
  .overlay{
    position: fixed;
    top: var(--headerH, 54px);
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 150;
  }
}

/* --------------------------------------------------------------------------
   Iris & Lola Neon — Add-ons v5 (Top 5 picks)
   These styles are appended at the very end so they win over older experiments.
-------------------------------------------------------------------------- */

/* Time-based sky tint vars (set by app.js): --irisLolaSkyA/B/C */
:root{
  --irisLolaSkyA: rgba(24,10,56,.60);
  --irisLolaSkyB: rgba(0,160,126,.38);
  --irisLolaSkyC: rgba(168,62,255,.20);
}

@keyframes irisLolaBreath{
  0%,100%{ filter: saturate(1) brightness(1); }
  50%{ filter: saturate(1.08) brightness(1.04); }
}

body[data-theme="Iris & Lola Neon"]{
  /* Soft, mystical space tint that shifts subtly through the day. */
  background:
    radial-gradient(1100px 700px at 18% 12%, var(--irisLolaSkyA), transparent 60%),
    radial-gradient(900px 600px at 82% 22%, var(--irisLolaSkyB), transparent 62%),
    radial-gradient(900px 700px at 55% 88%, var(--irisLolaSkyC), transparent 64%),
    linear-gradient(180deg, rgba(0,0,0,.92), rgba(0,0,0,.94)) !important;
  animation: irisLolaBreath 10s ease-in-out infinite;
}

body[data-theme="Iris & Lola Neon"] .chat{
  background: rgba(10, 2, 16, 0.42) !important;
}

body[data-theme="Iris & Lola Neon"] #roomsPanel,
body[data-theme="Iris & Lola Neon"] #membersPane,
body[data-theme="Iris & Lola Neon"] .modalCard,
body[data-theme="Iris & Lola Neon"] .panel,
body[data-theme="Iris & Lola Neon"] .sidebar,
body[data-theme="Iris & Lola Neon"] .listPanel{
  background: rgba(8, 2, 16, 0.78) !important;
  backdrop-filter: blur(10px);
}

/* Ensure the starfield sits behind chat content and is clipped to the chat area. */
body[data-theme="Iris & Lola Neon"] .chat{
  position: relative;
  overflow: hidden;
  isolation: isolate;
}
body[data-theme="Iris & Lola Neon"] .chat > *{
  position: relative;
  z-index: 1;
}
body[data-theme="Iris & Lola Neon"] .irisLolaStarfield{
  position: absolute;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}

/* Shooting star streaks spawned by app.js */
body[data-theme="Iris & Lola Neon"] .irisLolaShootingStar{
  position: absolute;
  left: var(--sx, 80%);
  top: var(--sy, 18%);
  width: var(--len, 120px);
  height: 2px;
  transform: rotate(-28deg);
  background: linear-gradient(90deg, rgba(0,0,0,0), rgba(120,255,210,.85), rgba(170,90,255,.55), rgba(0,0,0,0));
  filter: drop-shadow(0 0 10px rgba(80,255,200,.25));
  opacity: 0;
  animation: irisLolaShoot var(--sdur, 1200ms) ease-out forwards;
}

/* Perf: remove GPU-expensive filters */
body[data-theme="Iris & Lola Neon"].irisLolaPerf .irisLolaShootingStar{
  filter: none !important;
}
@keyframes irisLolaShoot{
  0%{ opacity:0; transform: translate3d(0,0,0) rotate(-28deg); }
  10%{ opacity:.95; }
  100%{ opacity:0; transform: translate3d(-240px, 210px, 0) rotate(-28deg); }
}

/* Constellation whispers (rare) */
body[data-theme="Iris & Lola Neon"] .irisLolaConstellationWhisper{
  position: absolute;
  inset: 0;
  pointer-events: none;
  opacity: 0;
  animation: irisLolaConstellation 1.25s ease-out forwards;
}
body[data-theme="Iris & Lola Neon"] .irisLolaConstellationLine{
  position: absolute;
  height: 1px;
  transform-origin: 0 50%;
  background: linear-gradient(90deg, rgba(0,0,0,0), rgba(120,255,210,.62), rgba(170,90,255,.36), rgba(0,0,0,0));
  filter: drop-shadow(0 0 6px rgba(120,255,210,.18));
}

body[data-theme="Iris & Lola Neon"].irisLolaPerf .irisLolaConstellationLine{
  filter: none !important;
}

body[data-theme="Iris & Lola Neon"].irisLolaPerf .irisLolaConstellationLine{
  filter: none !important;
}
@keyframes irisLolaConstellation{
  0%{ opacity:0; }
  25%{ opacity:.72; }
  85%{ opacity:.44; }
  100%{ opacity:0; }
}

/* Message-proximity glow (2s) */
body[data-theme="Iris & Lola Neon"].irisLolaProximityGlow .chat{
  box-shadow:
    0 0 0 1px rgba(120,255,210,.18),
    0 0 34px rgba(120,255,210,.10),
    0 0 44px rgba(170,90,255,.08) !important;
}
body[data-theme="Iris & Lola Neon"].irisLolaProximityGlow .msgs{
  filter: saturate(1.05) brightness(1.03);
}

/* Keep "I love you" synced with the breathing glow */
body[data-theme="Iris & Lola Neon"] .chat::after{
  animation-timing-function: ease-in-out !important;
}
body[data-theme="Iris & Lola Neon"] .chat::after,
body[data-theme="Iris & Lola Neon"] .chat::before{
  animation-duration: 10s !important;
}

/* Rare drawer easter sparkle */
body[data-theme="Iris & Lola Neon"] #roomsPanel,
body[data-theme="Iris & Lola Neon"] #membersPane{
  position: relative;
  overflow: hidden;
}
body[data-theme="Iris & Lola Neon"] .irisLolaDrawerEasterStar{
  position: absolute;
  left: var(--dx, 50%);
  top: var(--dy, 18%);
  width: 120px;
  height: 2px;
  transform: rotate(-22deg);
  background: linear-gradient(90deg, rgba(0,0,0,0), rgba(120,255,210,.9), rgba(170,90,255,.5), rgba(0,0,0,0));
  filter: drop-shadow(0 0 10px rgba(120,255,210,.24));
  opacity: 0;
  pointer-events: none;
  animation: irisLolaDrawerEaster 1.25s ease-out forwards;
}
@keyframes irisLolaDrawerEaster{
  0%{ opacity:0; transform: translate3d(20px,-10px,0) rotate(-22deg); }
  15%{ opacity:.95; }
  100%{ opacity:0; transform: translate3d(-120px,90px,0) rotate(-22deg); }
}

@media (prefers-reduced-motion: reduce){
  body[data-theme="Iris & Lola Neon"]{ animation: none !important; }
  body[data-theme="Iris & Lola Neon"] .irisLolaShootingStar,
  body[data-theme="Iris & Lola Neon"] .irisLolaConstellationWhisper,
  body[data-theme="Iris & Lola Neon"] .irisLolaDrawerEasterStar{ display: none !important; }
}


/* --- Survival Simulator: mention highlighting + arena map --- */
.chat-main .sys.sys-mention { box-shadow: 0 0 0 2px rgba(120, 255, 170, 0.25) inset; }

.survivalLogItem.mention-hit { box-shadow: 0 0 0 2px rgba(120, 255, 170, 0.22) inset; }
.survivalLogZoneTag{
  display:inline-flex;
  align-items:center;
  padding:2px 8px;
  border-radius:999px;
  font-size:12px;
  line-height:1.1;
  opacity:.9;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(0,0,0,.18);
  margin-right:6px;
}

.survivalMapWrap{
  display:flex;
  flex-direction:column;
  gap:10px;
  margin-bottom:10px;
}
.survivalMapGraphic{
  position:relative;
  width:100%;
  max-width:860px;
}
.survivalMapGraphic img{
  display:block;
  width:100%;
  height:auto;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
}
.survivalMapSvg{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  border-radius:14px;
  background:rgba(0,0,0,.18);
}
.survivalMapZone rect{
  fill:rgba(255,255,255,.06);
  stroke:rgba(255,255,255,.18);
  stroke-width:1.2;
}
.survivalMapZone:hover rect{
  fill:rgba(255,255,255,.09);
  stroke:rgba(160,255,200,.32);
}
.survivalMapZone.selected rect{
  fill:rgba(120,255,170,.10);
  stroke:rgba(120,255,170,.55);
}
.survivalMapLabel{
  font-size:12px;
  fill:rgba(255,255,255,.92);
}
.survivalMapStats{
  font-size:11px;
  fill:rgba(255,255,255,.72);
}
.survivalMapPip{
  fill:rgba(120,255,170,.65);
  opacity:.8;
}

.survivalZoneDetail{
  display:grid;
  grid-template-columns:repeat(2, minmax(0, 1fr));
  gap:10px;
}
@media (max-width: 720px){
  .survivalZoneDetail{ grid-template-columns:1fr; }
}
.survivalZoneSelectedHeader{
  grid-column:1/-1;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:8px 4px;
}
.survivalZoneSelectedTitle{ font-weight:700; }
.survivalZoneList{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  padding-top:8px;
}
.survivalZoneP{
  display:inline-flex;
  padding:3px 8px;
  border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.12);
  font-size:12px;
}
.survivalZoneP.dead{
  opacity:.55;
  text-decoration:line-through;
}

/* --- Chess */
.chessModal{
  position:fixed;
  inset:0;
  z-index:90;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:18px;
  background:rgba(0,0,0,.6);
  backdrop-filter:blur(6px);
}
.chessModal[hidden]{ display:none; }
.chessModalCard{
  width:min(980px, 96vw);
  max-height:92vh;
  background:rgba(18,18,20,.96);
  border:1px solid rgba(255,255,255,.12);
  border-radius:18px;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
.chessModalHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:16px 18px;
  border-bottom:1px solid rgba(255,255,255,.08);
}
.chessModalBody{
  display:grid;
  grid-template-columns:minmax(0, 1fr) minmax(240px, 300px);
  gap:18px;
  padding:18px;
  overflow:auto;
}
.chessBoardWrap{
  position:relative;
  width:100%;
  max-width:520px;
  margin:0 auto;
}
.chessBoard{
  display:grid;
  grid-template-columns:repeat(8, 1fr);
  border-radius:12px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.1);
}
.chessSquare{
  aspect-ratio:1/1;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:clamp(22px, 3vw, 36px);
  border:none;
  background:transparent;
  cursor:pointer;
  color:#f5f5f5;
  position:relative;
}

.chessSquare .chessPiece{
  width:78%;
  height:78%;
  object-fit:contain;
  pointer-events:none;
  user-select:none;
  -webkit-user-drag:none;
  position:relative;
  z-index:3;
}
.chessSquare.light{ background:#f0d9b5; color:#1a1a1a; }
.chessSquare.dark{ background:#b58863; color:#1a1a1a; }
.chessSquare.is-selected{
  outline:3px solid rgba(92,162,255,.8);
  outline-offset:-3px;
}
.chessSquare.is-legal::after{
  content:"";
  width:34%;
  height:34%;
  border-radius:50%;
  background:rgba(92,162,255,.45);
  position:absolute;
  inset:0;
  margin:auto;
  z-index:2;
  pointer-events:none;
}
.chessSquare.is-legal.is-capture::after{
  width:70%;
  height:70%;
  border:3px solid rgba(92,162,255,.8);
  background:transparent;
}
.chessPromotion{
  position:absolute;
  inset:auto 10px 10px 10px;
  background:rgba(10,10,12,.95);
  border:1px solid rgba(255,255,255,.12);
  border-radius:12px;
  padding:12px;
  display:flex;
  gap:10px;
  justify-content:center;
}
.chessPromotion button{
  border:none;
  background:rgba(255,255,255,.08);
  border-radius:8px;
  padding:8px 12px;
  font-size:20px;
  color:#fff;
  cursor:pointer;
  min-width:52px;
  min-height:52px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.chessPromotion button .chessPiece{
  width:34px;
  height:34px;
}
.chessSidePanel{
  display:flex;
  flex-direction:column;
  gap:12px;
}
.chessSeats{
  display:flex;
  flex-direction:column;
  gap:8px;
}
.chessSeat{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:10px 12px;
  border-radius:12px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.08);
  gap:10px;
}
.chessSeatMeta{
  display:flex;
  flex-direction:column;
  gap:4px;
}
.chessSeatLabel{ font-weight:600; }
.chessStatus{
  padding:12px;
  border-radius:12px;
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.08);
  min-height:70px;
}
.chessActions{
  display:grid;
  gap:8px;
}
.chessMeta{
  font-size:13px;
  color:rgba(255,255,255,.75);
}
.dmChessChallenge{
  padding:12px;
  margin:12px 12px 0;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(28,28,32,.8);
  display:flex;
  flex-direction:column;
  gap:8px;
}
.dmChessChallengeRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.dmChessChallengeActions{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.dmChessMessage{
  padding:10px 12px;
  border-radius:10px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.12);
  font-size:13px;
}
.dmChessChallengeTag{
  font-weight:600;
}
.leaderboardChessRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
}
.leaderboardChessMeta{
  font-size:12px;
  color:rgba(255,255,255,.65);
}
@media (max-width: 860px){
  .chessModalBody{
    grid-template-columns:1fr;
  }
  .chessBoardWrap{
    max-width:100%;
  }
}

/* Neon Modal Styles */
.neonModal {
  box-shadow: 0 0 20px rgba(138, 43, 226, 0.3);
  border: 1px solid rgba(138, 43, 226, 0.5);
  border-radius: 12px;
  overflow-y: auto;
  max-height: 85vh;
}

/* Edit Profile Layout */
.editProfileLayout {
  display: grid;
  grid-template-columns: 320px 1fr;
  gap: 20px;
  padding: 16px;
}

.editProfilePreview {
  position: sticky;
  top: 16px;
  height: fit-content;
}

.previewShell {
  background: var(--card-bg, rgba(255,255,255,0.05));
  border: 1px solid var(--border, rgba(255,255,255,0.1));
  border-radius: 12px;
  padding: 16px;
}

.profilePreviewCard {
  position: relative;
  border-radius: 8px;
  overflow: hidden;
  margin-bottom: 12px;
  min-height: 180px;
  background: var(--card-bg, rgba(0,0,0,0.3));
}

.profileBioPreview {
  padding: 12px;
  background: var(--card-bg, rgba(255,255,255,0.03));
  border-radius: 6px;
  min-height: 80px;
  font-size: 14px;
  color: var(--text-secondary, rgba(255,255,255,0.8));
  margin-bottom: 12px;
}

.previewActions {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.editProfileControls {
  flex: 1;
  overflow-y: auto;
  max-height: 70vh;
}

/* Couples Layout */
.couplesLayout {
  padding: 16px;
  overflow-y: auto;
  max-height: 75vh;
}

/* Toggle Label Improvements */
.toggleLabel strong {
  display: block;
  margin-bottom: 2px;
}

.toggleLabel .small {
  margin-top: 2px;
}

/* Responsive Edit Profile */
@media (max-width: 860px) {
  .editProfileLayout {
    grid-template-columns: 1fr;
  }
  
  .editProfilePreview {
    position: relative;
    top: 0;
  }
}

/* Card Preview Styles */
.profileEditPreview {
  background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(75, 0, 130, 0.2));
  border-radius: 6px;
  height: 60px;
}

.couplesPreview {
  background: linear-gradient(135deg, rgba(199, 21, 133, 0.2), rgba(138, 43, 226, 0.2));
  border-radius: 6px;
  height: 60px;
}
